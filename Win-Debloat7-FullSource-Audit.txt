
================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\.github\ISSUE_TEMPLATE\bug_report.yaml
================================================================================

name: Bug Report
description: Report a bug in Win-Debloat7
labels: [bug, triage]
body:
  - type: markdown
    attributes:
      value: |
        ## Before You Submit
        - Ensure you are running **PowerShell 7.5+**.
        - Verify the bug exists in the latest version (v1.1.0).

  - type: dropdown
    id: interface
    attributes:
      label: Interface
      options:
        - CLI (Interactive Menu)
        - GUI (Premium Dashboard)
        - Profile (Unattended)
    validations:
      required: true

  - type: textarea
    id: description
    attributes:
      label: Describe the Bug
      description: A clear description of what the bug is.
    validations:
      required: true

  - type: textarea
    id: reproduction
    attributes:
      label: Steps to Reproduce
      description: How can we reproduce this?
      placeholder: |
        1. Run `./Win-Debloat7.ps1`
        2. Select "Launch Premium GUI"
        3. Click "Quick Optimize"
        4. Describe crash/error
    validations:
      required: true

  - type: dropdown
    id: os
    attributes:
      label: Operating System
      options:
        - Windows 11 24H2
        - Windows 11 23H2
        - Windows 10 22H2
        - Other
    validations:
      required: true

  - type: input
    id: ps_version
    attributes:
      label: PowerShell Version
      description: Run `$PSVersionTable.PSVersion` and paste the result.
      placeholder: "7.5.0"
    validations:
      required: true

  - type: textarea
    id: logs
    attributes:
      label: Log Output
      description: |
        Please verify if there are logs in `$env:ProgramData\Win-Debloat7\Logs` and paste relevant lines here.
        Alternatively, paste the error message from the GUI status bar.
    validations:
      required: false


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\.github\ISSUE_TEMPLATE\feature_request.yaml
================================================================================

name: Feature Request
description: Suggest a new feature for Win-Debloat7
labels: [enhancement]
body:
  - type: dropdown
    id: category
    attributes:
      label: Category
      options:
        - Bloatware Removal
        - Privacy Tweak
        - Performance Tweak
        - GUI Improvement
        - New Software Package
        - Other
    validations:
      required: true

  - type: textarea
    id: problem
    attributes:
      label: Problem Statement
      description: What problem does this feature solve?
    validations:
      required: true

  - type: textarea
    id: solution
    attributes:
      label: Proposed Solution
      description: How would you like it to work?
    validations:
      required: true

  - type: textarea
    id: alternatives
    attributes:
      label: Alternatives Considered
      description: Any other approaches you've thought about?
    validations:
      required: false


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\.github\PULL_REQUEST_TEMPLATE.md
================================================================================

## Description
<!-- What does this PR do? -->

## Related Issue
<!-- Link to related issue, e.g., Fixes #123 -->

## Checklist
- [ ] Code runs on PowerShell 7.5+
- [ ] Logic respects YAML configuration (no hardcoded actions)
- [ ] `Write-Log` is used for all output
- [ ] **GUI Changes Verified**: Confirmed no UI freezing (used `$updateGui`)
- [ ] I have tested my changes locally

## Interface
- [ ] CLI
- [ ] GUI
- [ ] Core Module


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\build\Build.ps1
================================================================================

#Requires -Version 7.5

param(
    [string]$Version = "1.0.0",
    [string]$OutputDir = "$PSScriptRoot\..\dist"
)

$Root = Resolve-Path "$PSScriptRoot\.."
$DistPath = "$OutputDir\Win-Debloat7-v$Version"
$ZipPath = "$OutputDir\Win-Debloat7-v$Version.zip"

Write-Host "Starting Build for Win-Debloat7 v$Version..." -ForegroundColor Cyan

# 1. Clean Output Directory
if (Test-Path $OutputDir) {
    Remove-Item -Path $OutputDir -Recurse -Force
}
New-Item -Path $DistPath -ItemType Directory -Force | Out-Null

# 2. Copy Runtime Files
$Exclusions = @(".git", ".vs", ".vscode", "dist", "tests", "build", "*.zip", "*.md")
Write-Host "Copying files to $DistPath..." -ForegroundColor Gray

Get-ChildItem -Path $Root -Exclude $Exclusions | Copy-Item -Destination $DistPath -Recurse -Force

# 3. Create Zip
Write-Host "Creating Release Package: $ZipPath" -ForegroundColor Cyan
Compress-Archive -Path "$DistPath\*" -DestinationPath $ZipPath -Force

Write-Host "Build Complete!" -ForegroundColor Green
Write-Host "Artifact: $ZipPath" -ForegroundColor Gray


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\build\Sign-Scripts.ps1
================================================================================

#Requires -Version 7.5

param(
    [string]$CertificatePath,
    [string]$TargetDir = "$PSScriptRoot\..\Win-Debloat7"
)

if ([string]::IsNullOrEmpty($CertificatePath)) {
    Write-Host "No certificate provided. Skipping signing." -ForegroundColor Yellow
    exit 0
}

Write-Host "Signing scripts in $TargetDir..." -ForegroundColor Cyan

$files = Get-ChildItem -Path $TargetDir -Recurse -Include *.ps1, *.psm1, *.psd1

foreach ($f in $files) {
    Write-Host "Signing: $($f.Name)" -ForegroundColor Gray
    Set-AuthenticodeSignature -FilePath $f.FullName -Certificate (Get-PfxCertificate $CertificatePath) -TimestampServer "http://timestamp.digicert.com"
}

Write-Host "Signing Complete." -ForegroundColor Green


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\profiles\bloatware-list.yaml
================================================================================

# Win-Debloat7 Custom Bloatware List
# Add your own apps here if using "Custom" removal mode in a profile

# This file is an example - copy it and reference in your profile like:
# bloatware:
#   removal_mode: "Custom"
#   custom_list:
#     - "Microsoft.3DBuilder"
#     - "Microsoft.BingWeather"
#     # ...add your apps here

# ============================================
# EXAMPLE BLOATWARE LIST (Moderate Preset)
# ============================================

apps:
  # Microsoft Core Bloat
  - "Microsoft.3DBuilder"
  - "Microsoft.BingFinance"
  - "Microsoft.BingNews"
  - "Microsoft.BingSports"
  - "Microsoft.BingWeather"
  - "Microsoft.GetHelp"
  - "Microsoft.Getstarted"
  - "Microsoft.Microsoft3DViewer"
  - "Microsoft.MicrosoftOfficeHub"
  - "Microsoft.MicrosoftSolitaireCollection"
  - "Microsoft.MixedReality.Portal"
  - "Microsoft.OneConnect"
  - "Microsoft.People"
  - "Microsoft.PowerAutomateDesktop"
  - "Microsoft.Print3D"
  - "Microsoft.SkypeApp"
  - "Microsoft.Todos"
  - "Microsoft.WindowsAlarms"
  - "Microsoft.WindowsFeedbackHub"
  - "Microsoft.WindowsMaps"
  - "Microsoft.WindowsSoundRecorder"
  - "Microsoft.XboxApp"
  - "Microsoft.YourPhone"
  - "Microsoft.ZuneMusic"
  - "Microsoft.ZuneVideo"
  
  # 25H2 / Newer Bloat
  - "Microsoft.Copilot"
  - "MicrosoftWindows.Client.CoPilot"
  - "MicrosoftWindows.Client.WebExperience"
  - "Microsoft.OutlookForWindows"
  - "Microsoft.Windows.DevHome"
  - "Clipchamp.Clipchamp"
  
  # Third Party Preinstalls
  - "Disney"
  - "SpotifyAB.SpotifyMusic"
  - "PandoraMedia"
  - "AmazonVideo.PrimeVideo"
  - "Netflix"
  - "Facebook"
  - "Instagram"
  - "Twitter"
  - "TikTok"
  - "CandyCrush"
  - "BubbleWitch"
  - "FarmVille"

# ============================================
# APPS TO PRESERVE (Always keep these)
# ============================================

preserve:
  - "Microsoft.WindowsStore"         # Required for app updates
  - "Microsoft.WindowsTerminal"      # Useful terminal
  - "Microsoft.WindowsCalculator"    # Basic utility
  - "Microsoft.Photos"               # Photo viewer
  - "Microsoft.MSPaint"              # Paint
  - "Microsoft.Notepad"              # Notepad


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\profiles\essentials.yaml
================================================================================

# Win-Debloat7 Essentials Profile
# One-click installation of recommended apps after debloating

metadata:
  name: "Essentials"
  version: "1.0.0"
  author: "Win-Debloat7 Team"
  description: "Post-debloat essentials installer. Installs recommended browsers, runtimes, utilities, and drivers."
  target_os: [ "Windows 10", "Windows 11" ]
  min_build: 19045

# No bloatware removal - this profile is for installation only
bloatware:
  removal_mode: "None"

# Minimal privacy changes
privacy:
  telemetry_level: "Basic"
  disable_advertising_id: true

# Default performance
performance:
  power_plan: "Balanced"

# Software installation via Winget
software:
  package_manager: "Winget"
  
  # Core Essentials - Install These First
  install_list:
    # Runtimes (Required by many apps)
    - "Microsoft.DotNet.DesktopRuntime.8"
    - "Microsoft.VCRedist.2015+.x64"
    - "Microsoft.VCRedist.2015+.x86"
    
    # Browser
    - "Mozilla.Firefox"
    
    # Archive Utility
    - "7zip.7zip"
    
    # File Search
    - "voidtools.Everything"
    
    # Terminal
    - "Microsoft.WindowsTerminal"
    
    # PowerShell 7
    - "Microsoft.PowerShell"
    
    # Media Player
    - "VideoLAN.VLC"
    
    # Screenshot Tool
    - "ShareX.ShareX"
    
    # Password Manager
    - "Bitwarden.Bitwarden"
    
    # PDF Reader
    - "SumatraPDF.SumatraPDF"
    
    # Text Editor
    - "Notepad++.Notepad++"

# Network configuration (for DNS privacy)
network:
  dns_servers: [ "1.1.1.1", "1.0.0.1" ]
  disable_ipv6: false


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\profiles\gaming.yaml
================================================================================

metadata:
  name: "Gaming"
  version: "1.0.0"
  author: "Win-Debloat7 Team"
  description: "Maximum performance for gamers. Aggressive bloatware removal with gaming-friendly settings."
  target_os: [ "Windows 10", "Windows 11" ]
  min_build: 19045

bloatware:
  removal_mode: "Aggressive"
  # Apps to explicitly PRESERVE even in Aggressive mode
  exclude_list:
    - "Microsoft.WindowsStore"
    - "Microsoft.WindowsTerminal"
    - "Microsoft.XboxGamingOverlay"    # Keep for Game Bar if desired
    - "Microsoft.XboxIdentityProvider" # Required for Xbox Live

privacy:
  telemetry_level: "Security"
  disable_advertising_id: true
  disable_activity_history: true
  disable_location_tracking: true
  disable_copilot: true
  disable_recall: true

performance:
  power_plan: "Ultimate"
  visual_effects: "Performance"
  disable_game_bar: false             # Keep Game Bar for recording
  disable_background_apps: true

network:
  dns_servers: [ "1.1.1.1", "1.0.0.1" ]
  disable_ipv6: false


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\profiles\moderate.yaml
================================================================================

metadata:
  name: "Moderate"
  version: "1.0.0"
  author: "Win-Debloat7 Team"
  description: "Recommended balance of performance and functionality. Removes obvious bloat but keeps useful apps."
  target_os: [ "Windows 10", "Windows 11" ]
  min_build: 19045

bloatware:
  removal_mode: "Moderate"
  # Apps to explicitly PRESERVE even if removal_mode is Aggressive
  exclude_list:
    - "Microsoft.WindowsCalculator"
    - "Microsoft.WindowsStore"
    - "Microsoft.WindowsTerminal"
    - "Microsoft.XboxApp"

privacy:
  telemetry_level: "Basic"
  disable_advertising_id: true
  disable_activity_history: true
  disable_location_tracking: false
  disable_copilot: true
  disable_recall: true

performance:
  power_plan: "Balanced"
  visual_effects: "Appearance"
  disable_game_bar: false
  disable_background_apps: true

network:
  dns_servers: [ "1.1.1.1", "8.8.8.8" ]
  disable_ipv6: false

software:
  package_manager: "Winget"
  install_list:
    - "Microsoft.PowerShell"
    - "Microsoft.VisualStudioCode"
    - "7zip.7zip"


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\profiles\schema.yaml
================================================================================

# Win-Debloat7 Profile Schema
# Defines the structure and valid values for configuration profiles

metadata:
  name: string
  version: string
  author: string
  description: string
  target_os: [ "Windows 10", "Windows 11" ]
  min_build: integer

bloatware:
  removal_mode: [ "Conservative", "Moderate", "Aggressive", "Custom" ]
  custom_list: list<string>
  exclude_list: list<string>

privacy:
  telemetry_level: [ "Security", "Basic", "Full" ]
  disable_advertising_id: boolean
  disable_activity_history: boolean
  disable_location_tracking: boolean
  disable_copilot: boolean
  disable_recall: boolean

performance:
  power_plan: [ "Balanced", "HighPerformance", "Ultimate" ]
  visual_effects: [ "Appearance", "Performance", "Custom" ]
  disable_game_bar: boolean
  disable_background_apps: boolean

network:
  dns_servers: list<string>
  disable_ipv6: boolean

software:
  package_manager: [ "Winget", "Chocolatey" ]
  install_list: list<string>
  uninstall_list: list<string>


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\src\core\Config.psm1
================================================================================

<#
.SYNOPSIS
    Configuration management module for Win-Debloat7
    
.DESCRIPTION
    Handles YAML profile loading, validation and schema checking.
    Uses PowerShell 7.5 best practices with user consent for dependencies.
    
.NOTES
    Module: Win-Debloat7.Core.Config
    Version: 1.1.0
    
.LINK
    https://learn.microsoft.com/en-us/powershell/scripting/whats-new/what-s-new-in-powershell-75
#>

#Requires -Version 7.5

using namespace System.Management.Automation

Import-Module "$PSScriptRoot\Logger.psm1" -Force

# Schema definition for validation (SEC-004 fix)
$Script:ProfileSchema = @{
    Required             = @('metadata')
    MetadataRequired     = @('name', 'version')
    ValidSections        = @('metadata', 'bloatware', 'privacy', 'performance', 'network', 'software')
    ValidTelemetryLevels = @('Security', 'Basic', 'Full')
    ValidPowerPlans      = @('Balanced', 'HighPerformance', 'Ultimate')
    ValidRemovalModes    = @('None', 'Conservative', 'Moderate', 'Aggressive', 'Custom')
}

<#
.SYNOPSIS
    Imports and validates a Win-Debloat7 configuration profile.
    
.DESCRIPTION
    Loads a YAML configuration file, validates against the schema,
    and returns a structured configuration object.
    
.PARAMETER Path
    Full path to the YAML profile file.
    
.PARAMETER SkipDependencyCheck
    If specified, skips the dependency check for powershell-yaml.
    
.OUTPUTS
    [psobject] The validated configuration object.
    
.EXAMPLE
    $config = Import-WinDebloat7Config -Path "profiles/moderate.yaml"
#>
function Import-WinDebloat7Config {
    [CmdletBinding()]
    [OutputType([psobject])]
    param(
        [Parameter(Mandatory)]
        [ValidateScript({ Test-Path $_ -PathType Leaf })]
        [string]$Path,
        
        [switch]$SkipDependencyCheck
    )
    
    Write-Log -Message "Loading profile: $Path" -Level Info
    
    # Check for powershell-yaml module with user consent (SEC-001 fix)
    if (-not $SkipDependencyCheck) {
        if (-not (Get-Module -ListAvailable -Name "powershell-yaml")) {
            Write-Log -Message "Module 'powershell-yaml' not found." -Level Warning
            
            # Prompt for user consent - security best practice
            $response = Read-Host "Install 'powershell-yaml' from PowerShell Gallery? [Y/N]"
            
            if ($response -match '^[Yy]') {
                try {
                    Write-Log -Message "Installing 'powershell-yaml' via PSResourceGet..." -Level Info
                    # PS 7.5+ prefers Install-PSResource over Install-Module
                    Install-PSResource -Name "powershell-yaml" -Scope CurrentUser -TrustRepository -ErrorAction Stop
                    Import-Module "powershell-yaml" -ErrorAction Stop
                    Write-Log -Message "Successfully installed 'powershell-yaml'." -Level Success
                }
                catch {
                    Write-Log -Message "Failed to install 'powershell-yaml'. Error: $($_.Exception.Message)" -Level Error
                    throw "Dependency 'powershell-yaml' is missing and installation failed."
                }
            }
            else {
                throw "Dependency 'powershell-yaml' is required. Please install it manually: Install-PSResource powershell-yaml"
            }
        }
        else {
            Import-Module "powershell-yaml" -ErrorAction Stop
        }
    }
    
    try {
        $Content = Get-Content $Path -Raw -ErrorAction Stop
        $Config = $Content | ConvertFrom-Yaml -ErrorAction Stop
        
        # Schema Validation (SEC-004 fix)
        $validationErrors = @()
        
        # 1. Check required sections
        if (-not $Config.metadata) {
            $validationErrors += "Missing required 'metadata' section"
        }
        else {
            foreach ($field in $Script:ProfileSchema.MetadataRequired) {
                if (-not $Config.metadata.$field) {
                    $validationErrors += "Missing required metadata field: '$field'"
                }
            }
        }
        
        # 2. Validate telemetry level if specified
        if ($Config.privacy -and $Config.privacy.telemetry_level) {
            if ($Config.privacy.telemetry_level -notin $Script:ProfileSchema.ValidTelemetryLevels) {
                $validationErrors += "Invalid telemetry_level: '$($Config.privacy.telemetry_level)'. Valid: $($Script:ProfileSchema.ValidTelemetryLevels -join ', ')"
            }
        }
        
        # 3. Validate power plan if specified
        if ($Config.performance -and $Config.performance.power_plan) {
            if ($Config.performance.power_plan -notin $Script:ProfileSchema.ValidPowerPlans) {
                $validationErrors += "Invalid power_plan: '$($Config.performance.power_plan)'. Valid: $($Script:ProfileSchema.ValidPowerPlans -join ', ')"
            }
        }
        
        # 4. Validate removal mode if specified
        if ($Config.bloatware -and $Config.bloatware.removal_mode) {
            if ($Config.bloatware.removal_mode -notin $Script:ProfileSchema.ValidRemovalModes) {
                $validationErrors += "Invalid removal_mode: '$($Config.bloatware.removal_mode)'. Valid: $($Script:ProfileSchema.ValidRemovalModes -join ', ')"
            }
        }
        
        # Report validation errors
        if ($validationErrors.Count -gt 0) {
            foreach ($err in $validationErrors) {
                Write-Log -Message "Validation Error: $err" -Level Error
            }
            throw "Profile validation failed with $($validationErrors.Count) error(s)"
        }
        
        Write-Log -Message "Profile loaded: $($Config.metadata.name) v$($Config.metadata.version)" -Level Success
        return $Config
        
    }
    catch {
        Write-Log -Message "Failed to load profile: $($_.Exception.Message)" -Level Error
        throw
    }
}

<#
.SYNOPSIS
    Validates a configuration against the schema.
    
.PARAMETER Config
    The configuration object to validate.
    
.OUTPUTS
    [bool] True if valid, false otherwise.
#>
function Test-WinDebloat7Config {
    [CmdletBinding()]
    [OutputType([bool])]
    param(
        [Parameter(Mandatory)]
        [psobject]$Config
    )
    
    try {
        if (-not $Config.metadata) { return $false }
        if (-not $Config.metadata.name) { return $false }
        if (-not $Config.metadata.version) { return $false }
        return $true
    }
    catch {
        return $false
    }
}

Export-ModuleMember -Function Import-WinDebloat7Config, Test-WinDebloat7Config


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\src\core\Logger.psm1
================================================================================

<#
.SYNOPSIS
    Centralized logging module for Win-Debloat7
    
.DESCRIPTION
    Provides structured logging to console and file with Win-Debloat7 branding colors.
    Includes log rotation and size management (SEC-008 fix).
    
.NOTES
    Module: Win-Debloat7.Core.Logger
    Version: 1.1.0
    
.LINK
    https://learn.microsoft.com/en-us/powershell/scripting/whats-new/what-s-new-in-powershell-75
#>

#Requires -Version 7.5

using namespace System.Management.Automation

class LogEntry {
    [datetime]$Timestamp
    [string]$Level
    [string]$Message
    [string]$Component
}

# Define Branding Colors
$Script:LogColors = @{
    Info    = "Gray"
    Success = "Green"
    Warning = "Yellow"
    Error   = "Red"
    Debug   = "DarkGray"
    Header  = "Blue"
}

$Script:LogFile = $null
$Script:MaxLogSizeBytes = 10MB
$Script:MaxLogFiles = 5

<#
.SYNOPSIS
    Initializes the logging system.
    
.PARAMETER Path
    Directory path for log files.
    
.PARAMETER MaxSizeBytes
    Maximum log file size before rotation. Default: 10MB.
    
.PARAMETER MaxFiles
    Maximum number of rotated log files to keep. Default: 5.
#>
function Start-WD7Logging {
    [CmdletBinding(SupportsShouldProcess)]
    [OutputType([void])]
    param(
        [ValidateNotNullOrEmpty()]
        [string]$Path = "$env:ProgramData\Win-Debloat7\Logs",
        
        [int]$MaxSizeBytes = 10MB,
        
        [int]$MaxFiles = 5
    )
    
    $Script:MaxLogSizeBytes = $MaxSizeBytes
    $Script:MaxLogFiles = $MaxFiles
    
    if (-not (Test-Path $Path)) {
        New-Item -Path $Path -ItemType Directory -Force | Out-Null
    }
    
    $timestamp = Get-Date -Format "yyyyMMdd-HHmmss"
    $Script:LogFile = "$Path\Win-Debloat7-$timestamp.log"
    
    # Clean old logs (SEC-008 fix: Log rotation)
    try {
        $existingLogs = Get-ChildItem -Path $Path -Filter "Win-Debloat7-*.log" -ErrorAction Stop | 
        Sort-Object CreationTime -Descending
        
        if ($existingLogs.Count -gt $Script:MaxLogFiles) {
            $toDelete = $existingLogs | Select-Object -Skip $Script:MaxLogFiles
            $toDelete | Remove-Item -Force -ErrorAction SilentlyContinue
        }
    }
    catch {
        # Non-fatal - continue without cleanup
        Write-Verbose "Log cleanup skipped: $($_.Exception.Message)"
    }
    
    Write-Log -Message "Logging started: $Script:LogFile" -Level Info
}

<#
.SYNOPSIS
    Writes a log message to console and file.
    
.PARAMETER Message
    The message to log.
    
.PARAMETER Level
    Log level: Info, Success, Warning, Error, Debug.
    
.PARAMETER Component
    Optional component name for categorization.
#>
function Write-Log {
    [CmdletBinding()]
    [OutputType([void])]
    param(
        [Parameter(Mandatory)]
        [ValidateNotNullOrEmpty()]
        [string]$Message,
        
        [ValidateSet("Info", "Success", "Warning", "Error", "Debug")]
        [string]$Level = "Info",
        
        [string]$Component
    )
    
    $timestamp = Get-Date -Format "HH:mm:ss"
    $color = $Script:LogColors[$Level]
    
    # Console Output
    $prefix = "[$timestamp] [$Level]"
    if ($Component) { $prefix += " [$Component]" }
    
    Write-Host "$prefix " -NoNewline -ForegroundColor DarkGray
    Write-Host $Message -ForegroundColor $color
    
    # File Output
    if ($Script:LogFile) {
        # Check file size and rotate if needed (SEC-008 fix)
        if (Test-Path $Script:LogFile) {
            $fileInfo = Get-Item $Script:LogFile
            if ($fileInfo.Length -gt $Script:MaxLogSizeBytes) {
                $basePath = Split-Path $Script:LogFile -Parent
                $timestamp = Get-Date -Format "yyyyMMdd-HHmmss"
                $Script:LogFile = "$basePath\Win-Debloat7-$timestamp.log"
            }
        }
        
        try {
            "$timestamp [$Level] $Message" | Out-File -FilePath $Script:LogFile -Append -Encoding utf8
        }
        catch {
            # Silent fail for log writes - don't disrupt main operation
            Write-Verbose "Log write failed: $($_.Exception.Message)"
        }
    }
}

<#
.SYNOPSIS
    Gets the current log file path.
#>
function Get-WD7LogPath {
    [CmdletBinding()]
    [OutputType([string])]
    param()
    
    return $Script:LogFile
}

Export-ModuleMember -Function Start-WD7Logging, Write-Log, Get-WD7LogPath


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\src\core\Registry.psm1
================================================================================

<#
.SYNOPSIS
    Registry management utilities for Win-Debloat7
    
.DESCRIPTION
    Provides shared registry manipulation functions with proper error handling,
    ACL validation, and PowerShell 7.5 best practices.
    
.NOTES
    Module: Win-Debloat7.Core.Registry
    Version: 1.0.0
    
.LINK
    https://learn.microsoft.com/en-us/powershell/scripting/whats-new/what-s-new-in-powershell-75
#>

#Requires -Version 7.5

using namespace System.Management.Automation
using namespace System.Security.AccessControl

Import-Module "$PSScriptRoot\Logger.psm1" -Force

<#
.SYNOPSIS
    Sets a registry key value with proper validation and error handling.
    
.DESCRIPTION
    Creates the registry path if it doesn't exist and sets the specified value.
    Includes ACL validation to ensure we have write permissions before attempting changes.
    
.PARAMETER Path
    The full registry path (e.g., HKLM:\SOFTWARE\MyApp)
    
.PARAMETER Name
    The registry value name
    
.PARAMETER Value
    The value to set
    
.PARAMETER Type
    The registry value type (DWord, String, QWord, Binary, MultiString, ExpandString)
    
.OUTPUTS
    [bool] Returns $true if successful, $false otherwise
    
.EXAMPLE
    Set-RegistryKey -Path "HKCU:\SOFTWARE\Test" -Name "MySetting" -Value 1
#>
function Set-RegistryKey {
    [CmdletBinding(SupportsShouldProcess)]
    [OutputType([bool])]
    param(
        [Parameter(Mandatory)]
        [ValidateNotNullOrEmpty()]
        [string]$Path,
        
        [Parameter(Mandatory)]
        [ValidateNotNullOrEmpty()]
        [string]$Name,
        
        [Parameter(Mandatory)]
        [AllowNull()]
        $Value,
        
        [ValidateSet("DWord", "String", "QWord", "Binary", "MultiString", "ExpandString")]
        [string]$Type = "DWord"
    )
    
    try {
        # Validate and create path if needed
        if (-not (Test-Path $Path)) {
            if ($PSCmdlet.ShouldProcess($Path, "Create Registry Key")) {
                New-Item -Path $Path -Force -ErrorAction Stop | Out-Null
                Write-Log -Message "Created registry path: $Path" -Level Debug
            }
        }
        
        # Validate we have write access (SEC-002 fix)
        $acl = Get-Acl -Path $Path -ErrorAction Stop
        $currentUser = [System.Security.Principal.WindowsIdentity]::GetCurrent()
        $hasWriteAccess = $false
        
        foreach ($accessRule in $acl.Access) {
            if ($accessRule.IdentityReference.Value -match "Administrators|SYSTEM|$($currentUser.Name)") {
                if ($accessRule.RegistryRights -band [System.Security.AccessControl.RegistryRights]::SetValue) {
                    $hasWriteAccess = $true
                    break
                }
            }
        }
        
        if (-not $hasWriteAccess) {
            Write-Log -Message "Insufficient permissions to modify: $Path" -Level Warning
            # Continue anyway as admin - the write will fail if truly blocked
        }
        
        # Set the value
        if ($PSCmdlet.ShouldProcess("$Path\$Name", "Set Value to $Value ($Type)")) {
            Set-ItemProperty -Path $Path -Name $Name -Value $Value -Type $Type -Force -ErrorAction Stop
            Write-Log -Message "Set registry: $Path\$Name = $Value" -Level Debug
            return $true
        }
        
        return $false
    }
    catch {
        # SEC-003 fix: Proper error logging instead of silent suppression
        Write-Log -Message "Failed to set registry '$Path\$Name': $($_.Exception.Message)" -Level Error
        return $false
    }
}

<#
.SYNOPSIS
    Gets a registry key value with error handling.
    
.PARAMETER Path
    The full registry path
    
.PARAMETER Name
    The registry value name
    
.PARAMETER DefaultValue
    Value to return if the key doesn't exist
    
.OUTPUTS
    The registry value or default value
#>
function Get-RegistryKey {
    [CmdletBinding()]
    [OutputType([object])]
    param(
        [Parameter(Mandatory)]
        [ValidateNotNullOrEmpty()]
        [string]$Path,
        
        [Parameter(Mandatory)]
        [ValidateNotNullOrEmpty()]
        [string]$Name,
        
        $DefaultValue = $null
    )
    
    try {
        if (Test-Path $Path) {
            $value = Get-ItemPropertyValue -Path $Path -Name $Name -ErrorAction Stop
            return $value
        }
        return $DefaultValue
    }
    catch {
        Write-Log -Message "Registry key not found: $Path\$Name" -Level Debug
        return $DefaultValue
    }
}

<#
.SYNOPSIS
    Tests if a registry key/value exists.
    
.PARAMETER Path
    The full registry path
    
.PARAMETER Name
    Optional: The registry value name. If omitted, tests only the path.
    
.OUTPUTS
    [bool] True if exists, false otherwise
#>
function Test-RegistryKey {
    [CmdletBinding()]
    [OutputType([bool])]
    param(
        [Parameter(Mandatory)]
        [ValidateNotNullOrEmpty()]
        [string]$Path,
        
        [string]$Name
    )
    
    if (-not (Test-Path $Path)) {
        return $false
    }
    
    if ([string]::IsNullOrEmpty($Name)) {
        return $true
    }
    
    try {
        $null = Get-ItemPropertyValue -Path $Path -Name $Name -ErrorAction Stop
        return $true
    }
    catch {
        return $false
    }
}

<#
.SYNOPSIS
    Exports registry keys for backup purposes.
    
.PARAMETER Path
    The registry path to export
    
.PARAMETER OutputPath
    File path to save the export
    
.OUTPUTS
    [bool] True if successful
#>
function Export-RegistryKey {
    [CmdletBinding(SupportsShouldProcess)]
    [OutputType([bool])]
    param(
        [Parameter(Mandatory)]
        [ValidateNotNullOrEmpty()]
        [string]$Path,
        
        [Parameter(Mandatory)]
        [ValidateNotNullOrEmpty()]
        [string]$OutputPath
    )
    
    try {
        if (-not (Test-Path $Path)) {
            Write-Log -Message "Registry path does not exist: $Path" -Level Warning
            return $false
        }
        
        if ($PSCmdlet.ShouldProcess($Path, "Export Registry")) {
            # Use reg.exe for reliable export
            $regPath = $Path -replace '^HKLM:\\', 'HKEY_LOCAL_MACHINE\' -replace '^HKCU:\\', 'HKEY_CURRENT_USER\'
            $result = reg export $regPath $OutputPath /y 2>&1
            
            if ($LASTEXITCODE -eq 0) {
                Write-Log -Message "Exported registry: $Path -> $OutputPath" -Level Success
                return $true
            }
            else {
                Write-Log -Message "Failed to export registry: $result" -Level Error
                return $false
            }
        }
        
        return $false
    }
    catch {
        Write-Log -Message "Registry export failed: $($_.Exception.Message)" -Level Error
        return $false
    }
}

Export-ModuleMember -Function Set-RegistryKey, Get-RegistryKey, Test-RegistryKey, Export-RegistryKey


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\src\core\State.psm1
================================================================================

<#
.SYNOPSIS
    State management and snapshot module for Win-Debloat7
    
.DESCRIPTION
    Handles creating system snapshots and restoring system state.
    Uses PowerShell 7.5 ConvertTo-CliXml for robust serialization.
    
.NOTES
    Module: Win-Debloat7.Core.State
    Version: 1.1.0
    
.LINK
    https://learn.microsoft.com/en-us/powershell/scripting/whats-new/what-s-new-in-powershell-75
#>

#Requires -Version 7.5

using namespace System.Management.Automation
using namespace System.Collections.Generic
using namespace System.Security.Cryptography

Import-Module "$PSScriptRoot\Logger.psm1" -Force
Import-Module "$PSScriptRoot\Registry.psm1" -Force

class SystemSnapshot {
    [string]$Id
    [datetime]$Timestamp
    [string]$Name
    [string]$Description
    [hashtable]$Registry
    [array]$Services
    [string]$Version = "1.1.0"
}

# Cache for version info (PERF-001 fix)
$Script:CachedVersionInfo = $null

<#
.SYNOPSIS
    Creates a new system snapshot for restoration purposes.
    
.DESCRIPTION
    Captures current system state including services and registry keys.
    Uses CLIXML serialization for reliable data preservation.
    
.PARAMETER Name
    A friendly name for the snapshot.
    
.PARAMETER Description
    Optional description of the snapshot.
    
.PARAMETER Encrypt
    If specified, encrypts the snapshot using DPAPI.
    
.OUTPUTS
    [SystemSnapshot] The created snapshot object.
    
.EXAMPLE
    New-WinDebloat7Snapshot -Name "Pre-Optimization"
#>
function New-WinDebloat7Snapshot {
    [CmdletBinding(SupportsShouldProcess)]
    [OutputType([SystemSnapshot])]
    param(
        [ValidateNotNullOrEmpty()]
        [string]$Name = "Auto-Snapshot",
        
        [string]$Description,
        
        [switch]$Encrypt
    )
    
    Write-Log -Message "Creating system snapshot: $Name" -Level Info
    
    $snapshot = [SystemSnapshot]::new()
    $snapshot.Id = [guid]::NewGuid().ToString()
    $snapshot.Timestamp = Get-Date
    $snapshot.Name = $Name
    $snapshot.Description = $Description
    
    # 1. Capture Services (PERF-002 fix: Filter to relevant services)
    $relevantServicePatterns = @(
        'DiagTrack', 'Telemetry', 'BITS', 'wuauserv', 'UsoSvc',
        'Xbox*', 'Copilot', 'Connected*', 'dmwappushservice'
    )
    
    $serviceFilter = { 
        $svc = $_.Name
        $relevantServicePatterns | Where-Object { $svc -like $_ } 
    }
    
    try {
        $snapshot.Services = @(
            Get-Service | Where-Object $serviceFilter | 
            Select-Object Name, Status, StartType, DisplayName
        )
        Write-Log -Message "Captured $($snapshot.Services.Count) relevant services" -Level Debug
    }
    catch {
        Write-Log -Message "Failed to capture services: $($_.Exception.Message)" -Level Warning
        $snapshot.Services = @()
    }
    
    # 2. Capture Critical Registry Keys
    $criticalRegistryPaths = @(
        "HKLM:\SOFTWARE\Policies\Microsoft\Windows\DataCollection",
        "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\AdvertisingInfo",
        "HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsCopilot"
    )
    
    $snapshot.Registry = @{}
    foreach ($regPath in $criticalRegistryPaths) {
        if (Test-Path $regPath) {
            try {
                $props = Get-ItemProperty -Path $regPath -ErrorAction Stop
                $snapshot.Registry[$regPath] = $props
            }
            catch {
                Write-Log -Message "Could not capture registry: $regPath" -Level Debug
            }
        }
    }
    
    # Save to disk
    $basePath = "$env:ProgramData\Win-Debloat7\Snapshots\$($snapshot.Id)"
    
    try {
        if ($PSCmdlet.ShouldProcess($basePath, "Create Snapshot")) {
            New-Item -Path $basePath -ItemType Directory -Force | Out-Null
            
            # Use PS 7.5 ConvertTo-CliXml for robust serialization
            $cliXml = $snapshot | ConvertTo-CliXml
            
            if ($Encrypt) {
                # SEC-005 fix: Encrypt snapshot using DPAPI
                $bytes = [System.Text.Encoding]::UTF8.GetBytes($cliXml)
                $encrypted = [System.Security.Cryptography.ProtectedData]::Protect(
                    $bytes, $null, [System.Security.Cryptography.DataProtectionScope]::CurrentUser
                )
                [System.IO.File]::WriteAllBytes("$basePath\snapshot.encrypted", $encrypted)
                Write-Log -Message "Snapshot saved (encrypted): $($snapshot.Id)" -Level Success
            }
            else {
                $cliXml | Out-File -FilePath "$basePath\snapshot.clixml" -Encoding UTF8
                Write-Log -Message "Snapshot saved: $($snapshot.Id)" -Level Success
            }
        }
    }
    catch {
        Write-Log -Message "Failed to save snapshot: $($_.Exception.Message)" -Level Error
        throw
    }
    
    return $snapshot
}

<#
.SYNOPSIS
    Restores a previously created system snapshot.
    
.PARAMETER SnapshotId
    The unique ID of the snapshot to restore.
    
.OUTPUTS
    [void]
#>
function Restore-WinDebloat7Snapshot {
    [CmdletBinding(SupportsShouldProcess, ConfirmImpact = 'High')]
    [OutputType([void])]
    param(
        [Parameter(Mandatory)]
        [ValidateNotNullOrEmpty()]
        [string]$SnapshotId
    )
    
    $basePath = "$env:ProgramData\Win-Debloat7\Snapshots\$SnapshotId"
    $clixmlPath = "$basePath\snapshot.clixml"
    $encryptedPath = "$basePath\snapshot.encrypted"
    
    # Try to load snapshot
    $snapshot = $null
    
    if (Test-Path $clixmlPath) {
        try {
            $content = Get-Content $clixmlPath -Raw
            $snapshot = $content | ConvertFrom-CliXml
        }
        catch {
            Write-Log -Message "Failed to load snapshot: $($_.Exception.Message)" -Level Error
            throw "Snapshot ID not found or corrupted: $SnapshotId"
        }
    }
    elseif (Test-Path $encryptedPath) {
        try {
            $encrypted = [System.IO.File]::ReadAllBytes($encryptedPath)
            $decrypted = [System.Security.Cryptography.ProtectedData]::Unprotect(
                $encrypted, $null, [System.Security.Cryptography.DataProtectionScope]::CurrentUser
            )
            $clixml = [System.Text.Encoding]::UTF8.GetString($decrypted)
            $snapshot = $clixml | ConvertFrom-CliXml
        }
        catch {
            Write-Log -Message "Failed to decrypt snapshot: $($_.Exception.Message)" -Level Error
            throw "Snapshot decryption failed for: $SnapshotId"
        }
    }
    else {
        throw "Snapshot ID not found: $SnapshotId"
    }
    
    Write-Log -Message "Restoring Snapshot: $($snapshot.Name) ($($snapshot.Timestamp))" -Level Info
    
    $successCount = 0
    $failCount = 0
    
    # 1. Restore Services
    foreach ($svc in $snapshot.Services) {
        try {
            $current = Get-Service -Name $svc.Name -ErrorAction SilentlyContinue
            if ($current -and $current.StartType -ne $svc.StartType) {
                if ($PSCmdlet.ShouldProcess($svc.Name, "Restore Service to $($svc.StartType)")) {
                    Write-Log -Message "Restoring Service: $($svc.Name) to $($svc.StartType)" -Level Info
                    Set-Service -Name $svc.Name -StartupType $svc.StartType -ErrorAction Stop
                    $successCount++
                }
            }
        }
        catch {
            Write-Log -Message "Failed to restore service $($svc.Name): $($_.Exception.Message)" -Level Warning
            $failCount++
        }
    }
    
    # 2. Restore Registry
    foreach ($regPath in $snapshot.Registry.Keys) {
        $regData = $snapshot.Registry[$regPath]
        if ($regData) {
            foreach ($prop in $regData.PSObject.Properties) {
                if ($prop.Name -notmatch '^PS') {
                    # Skip PS* internal properties
                    if (Set-RegistryKey -Path $regPath -Name $prop.Name -Value $prop.Value) {
                        $successCount++
                    }
                    else {
                        $failCount++
                    }
                }
            }
        }
    }
    
    Write-Log -Message "Restore completed: $successCount succeeded, $failCount failed" -Level $(if ($failCount -eq 0) { "Success" } else { "Warning" })
}

<#
.SYNOPSIS
    Lists all available snapshots.
    
.OUTPUTS
    [SystemSnapshot[]] Array of snapshot objects.
#>
function Get-WinDebloat7Snapshot {
    [CmdletBinding()]
    [OutputType([SystemSnapshot[]])]
    param()
    
    $basePath = "$env:ProgramData\Win-Debloat7\Snapshots"
    
    if (-not (Test-Path $basePath)) {
        return @()
    }
    
    $snapshots = @(
        Get-ChildItem $basePath -Directory | ForEach-Object {
            $clixmlPath = Join-Path $_.FullName "snapshot.clixml"
            $encryptedPath = Join-Path $_.FullName "snapshot.encrypted"
            
            if (Test-Path $clixmlPath) {
                try {
                    $content = Get-Content $clixmlPath -Raw
                    $content | ConvertFrom-CliXml
                }
                catch {
                    Write-Log -Message "Could not read snapshot: $($_.FullName)" -Level Debug
                }
            }
            elseif (Test-Path $encryptedPath) {
                # Return metadata only for encrypted snapshots
                [PSCustomObject]@{
                    Id        = $_.Name
                    Name      = "(Encrypted)"
                    Timestamp = $_.CreationTime
                    Encrypted = $true
                }
            }
        }
    )
    
    return $snapshots
}

Export-ModuleMember -Function New-WinDebloat7Snapshot, Restore-WinDebloat7Snapshot, Get-WinDebloat7Snapshot


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\src\core\SystemState.psm1
================================================================================

<#
.SYNOPSIS
    System State Inspection Module
    
.DESCRIPTION
    Reads current system configuration to determine the state of various tweaks.
    Used by the GUI to synchronize checkboxes with actual system state.
    
.NOTES
    Module: Win-Debloat7.Core.SystemState
    Version: 1.0.0
#>

#Requires -Version 7.5
#Requires -RunAsAdministrator

using namespace System.Management.Automation

Import-Module "$PSScriptRoot\Registry.psm1" -Force

function Get-WinDebloat7SystemState {
    [CmdletBinding()]
    [OutputType([psobject])]
    param()
    
    $state = [pscustomobject]@{
        # Customization
        DarkTheme        = (Get-RegistryKey "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Themes\Personalize" "AppsUseLightTheme") -eq 0
        ActivityHistory  = (Get-RegistryKey "HKLM:\SOFTWARE\Policies\Microsoft\Windows\System" "PublishUserActivities") -ne 0
        BackgroundApps   = (Get-RegistryKey "HKCU:\Software\Microsoft\Windows\CurrentVersion\BackgroundAccessApplications" "GlobalUserDisabled") -ne 1
        ClipboardHistory = (Get-RegistryKey "HKCU:\Software\Microsoft\Clipboard" "EnableClipboardHistory") -eq 1
        Hibernate        = (Get-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\Power" -Name "HibernateEnabled" -ErrorAction SilentlyContinue).HibernateEnabled -eq 1
        
        # Privacy
        Telemetry        = (Get-RegistryKey "HKLM:\SOFTWARE\Policies\Microsoft\Windows\DataCollection" "AllowTelemetry") -ne 0
        Location         = (Get-RegistryKey "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\location" "Value") -ne "Deny"
        Copilot          = (Get-RegistryKey "HKCU:\Software\Policies\Microsoft\Windows\WindowsCopilot" "TurnOffWindowsCopilot") -ne 1
        Recall           = (Get-RegistryKey "HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsAI" "DisableAIDataAnalysis") -ne 1
        
        # Performance / Gaming
        GameMode         = (Get-RegistryKey "HKCU:\Software\Microsoft\GameBar" "AllowAutoGameMode") -ne 0
        GameBar          = (Get-RegistryKey "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\GameDVR" "AppCaptureEnabled") -ne 0
        
        # Gaming Optimizations
        GamingNetwork    = (Get-RegistryKey "HKLM:\SOFTWARE\Microsoft\MSMQ\Parameters" "TCPNoDelay") -eq 1
        GamingInput      = (Get-RegistryKey "HKCU:\Control Panel\Mouse" "MouseSpeed") -eq "0"
        GamingMMCSS      = (Get-RegistryKey "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile" "SystemResponsiveness") -eq 0
        UltimatePlan     = (powercfg /getactivescheme) -match "e9a42b02-d5df-448d-aa00-03f14749eb61"
        
        # Updates
        WindowsUpdate    = (Get-RegistryKey "HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU" "NoAutoUpdate") -ne 1
        IPv6             = (Get-RegistryKey "HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip6\Parameters" "DisabledComponents") -ne 255
    }
    
    return $state
}

Export-ModuleMember -Function Get-WinDebloat7SystemState


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\src\modules\Bloatware\Bloatware.psm1
================================================================================

<#
.SYNOPSIS
    Bloatware management module for Win-Debloat7
    
.DESCRIPTION
    Handles identification and removal of pre-installed Windows apps (UWP).
    Uses PowerShell 7.5 best practices with proper error handling.
    
.NOTES
    Module: Win-Debloat7.Modules.Bloatware
    Version: 1.1.0
    
.LINK
    https://learn.microsoft.com/en-us/powershell/scripting/whats-new/what-s-new-in-powershell-75
#>

#Requires -Version 7.5
#Requires -RunAsAdministrator

using namespace System.Management.Automation
using namespace System.Collections.Generic

Import-Module "$PSScriptRoot\..\..\core\Logger.psm1" -Force

#region Bloatware Definitions
$Script:BloatwareApps = @(
    # Microsoft Core Bloat
    "Microsoft.3DBuilder", "Microsoft.BingFinance", "Microsoft.BingNews", "Microsoft.BingSports", 
    "Microsoft.BingWeather", "Microsoft.GetHelp", "Microsoft.Getstarted", "Microsoft.Microsoft3DViewer",
    "Microsoft.MicrosoftOfficeHub", "Microsoft.MicrosoftSolitaireCollection", "Microsoft.MixedReality.Portal",
    "Microsoft.OneConnect", "Microsoft.People", "Microsoft.PowerAutomateDesktop", "Microsoft.Print3D",
    "Microsoft.SkypeApp", "Microsoft.Todos", "Microsoft.WindowsAlarms", "Microsoft.WindowsFeedbackHub",
    "Microsoft.WindowsMaps", "Microsoft.WindowsSoundRecorder", "Microsoft.XboxApp", "Microsoft.YourPhone",
    "Microsoft.ZuneMusic", "Microsoft.ZuneVideo",
    
    # 25H2 / Newer Bloat
    "Microsoft.Copilot", "MicrosoftWindows.Client.CoPilot", "MicrosoftWindows.Client.WebExperience", 
    "Microsoft.OutlookForWindows", "Microsoft.Windows.DevHome", "Clipchamp.Clipchamp",
    
    # Third Party
    "Disney", "SpotifyAB.SpotifyMusic", "PandoraMedia", "AmazonVideo.PrimeVideo", "Netflix",
    "Facebook", "Instagram", "Twitter", "TikTok", "CandyCrush", "BubbleWitch", "FarmVille"
)
#endregion

<#
.SYNOPSIS
    Gets the list of bloatware apps that can be removed.
    
.OUTPUTS
    [string[]] Array of app package names.
#>
function Get-WinDebloat7BloatwareList {
    [CmdletBinding()]
    [OutputType([string[]])]
    param()
    
    return $Script:BloatwareApps
}

<#
.SYNOPSIS
    Removes bloatware applications based on configuration.
    
.DESCRIPTION
    Removes UWP apps from the current user and all users,
    plus removes provisioned packages to prevent reinstallation.
    
.PARAMETER Config
    The configuration object loaded from a YAML profile.
    
.OUTPUTS
    [void]
    
.EXAMPLE
    Remove-WinDebloat7Bloatware -Config $config
#>
function Remove-WinDebloat7Bloatware {
    [CmdletBinding(SupportsShouldProcess, ConfirmImpact = 'High')]
    [OutputType([void])]
    param(
        [Parameter(Mandatory)]
        [ValidateNotNull()]
        [psobject]$Config
    )
    
    # Validate config has bloatware section
    if (-not $Config.bloatware) {
        Write-Log -Message "No bloatware configuration found in profile." -Level Warning
        return
    }
    
    $removalMode = $Config.bloatware.removal_mode
    $excludeList = $Config.bloatware.exclude_list ?? @()
    
    Write-Log -Message "Starting Bloatware Removal (Mode: $removalMode)" -Level Info
    
    if ($removalMode -eq "None") {
        Write-Log -Message "Removal Mode is None. Skipping." -Level Warning
        return
    }

    # Performance: Fetch all packages ONCE instead of loop-by-loop (already optimized)
    Write-Log -Message "Scanning installed packages (this may take a moment)..." -Level Info
    
    try {
        $currentPackages = Get-AppxPackage -AllUsers -ErrorAction Stop
        $provisionedPackages = Get-AppxProvisionedPackage -Online -ErrorAction Stop
    }
    catch {
        Write-Log -Message "Failed to enumerate packages: $($_.Exception.Message)" -Level Error
        return
    }
    
    # Track results
    $successCount = 0
    $failCount = 0
    $skippedCount = 0
    
    # Determine which apps to target (custom_list or built-in)
    $targetApps = if ($Config.bloatware.custom_list -and $Config.bloatware.custom_list.Count -gt 0) {
        Write-Log -Message "Using custom bloatware list from profile ($($Config.bloatware.custom_list.Count) apps)" -Level Info
        $Config.bloatware.custom_list
    }
    else {
        $Script:BloatwareApps
    }
    
    $total = $targetApps.Count
    $current = 0
    
    # Build regex pattern for matching (PERF-003 fix: Pre-build pattern)
    $excludePattern = if ($excludeList.Count -gt 0) {
        ($excludeList | ForEach-Object { [regex]::Escape($_) }) -join '|'
    }
    else { $null }
    
    # Process List
    foreach ($targetApp in $targetApps) {
        $current++
        $percentComplete = [math]::Round(($current / $total) * 100)
        Write-Progress -Activity "Removing Bloatware" -Status "Processing $targetApp" -PercentComplete $percentComplete
        
        # Check Exclusions
        if ($excludePattern -and $targetApp -match $excludePattern) {
            Write-Log -Message "Skipping preserved app: $targetApp" -Level Info
            $skippedCount++
            continue
        }
        
        # Alternative: Check array membership for exact matches
        if ($excludeList -contains $targetApp) {
            Write-Log -Message "Skipping preserved app: $targetApp" -Level Info
            $skippedCount++
            continue
        }
        
        # Check if installed (In-Memory Filter)
        $matchesInstalled = $currentPackages | Where-Object { $_.Name -like "*$targetApp*" }
        $matchesProvisioned = $provisionedPackages | Where-Object { $_.DisplayName -like "*$targetApp*" }
        
        if ($matchesInstalled -or $matchesProvisioned) {
            if ($PSCmdlet.ShouldProcess($targetApp, "Remove")) {
                Write-Log -Message "Removing: $targetApp" -Level Info
                
                # Remove Installed Package (SEC-003 fix: Proper error handling)
                if ($matchesInstalled) {
                    try {
                        $matchesInstalled | Remove-AppxPackage -AllUsers -ErrorAction Stop
                    }
                    catch {
                        Write-Log -Message "Failed to remove installed package '$targetApp': $($_.Exception.Message)" -Level Warning
                        $failCount++
                        continue
                    }
                }
                    
                # Remove Provisioned Package
                if ($matchesProvisioned) {
                    try {
                        $matchesProvisioned | Remove-AppxProvisionedPackage -Online -AllUsers -ErrorAction Stop
                    }
                    catch {
                        # Non-fatal for provisioned - may already be removed
                        Write-Log -Message "Could not remove provisioned '$targetApp': $($_.Exception.Message)" -Level Debug
                    }
                }
                    
                Write-Log -Message "Removed: $targetApp" -Level Success
                $successCount++
            }
        }
    }
    
    Write-Progress -Activity "Removing Bloatware" -Completed
    
    # Summary
    Write-Log -Message "Bloatware removal complete: $successCount removed, $skippedCount preserved, $failCount failed" -Level $(if ($failCount -eq 0) { "Success" } else { "Warning" })
}

Export-ModuleMember -Function Get-WinDebloat7BloatwareList, Remove-WinDebloat7Bloatware


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\src\modules\Drivers\Drivers.psm1
================================================================================

<#
.SYNOPSIS
    Driver update module for Win-Debloat7
    
.DESCRIPTION
    Handles driver enumeration, status checking, and updates via
    Windows Update, Winget, or Snappy Driver Installer.
    
.NOTES
    Module: Win-Debloat7.Modules.Drivers
    Version: 1.0.0
    
.LINK
    https://learn.microsoft.com/powershell/scripting/whats-new/what-s-new-in-powershell-75
#>

#Requires -Version 7.5
#Requires -RunAsAdministrator

using namespace System.Management.Automation

Import-Module "$PSScriptRoot\..\..\core\Logger.psm1" -Force

#region Driver Status

<#
.SYNOPSIS
    Gets the status of installed drivers.
    
.DESCRIPTION
    Queries Win32_PnPSignedDriver for all signed drivers and
    identifies potential outdated drivers based on date.
    
.PARAMETER Category
    Filter by driver category (Display, Network, Audio, etc.)
    
.OUTPUTS
    [psobject[]] Array of driver information objects.
    
.EXAMPLE
    Get-WinDebloat7DriverStatus -Category "Display"
#>
function Get-WinDebloat7DriverStatus {
    [CmdletBinding()]
    [OutputType([psobject[]])]
    param(
        [ValidateSet("All", "Display", "Network", "Audio", "USB", "Storage", "System")]
        [string]$Category = "All"
    )
    
    Write-Log -Message "Scanning installed drivers..." -Level Info
    
    try {
        $drivers = Get-CimInstance -ClassName Win32_PnPSignedDriver -ErrorAction Stop |
        Where-Object { $null -ne $_.DriverName } |
        Select-Object @{N = 'DeviceName'; E = { $_.DeviceName } },
        @{N = 'DriverVersion'; E = { $_.DriverVersion } },
        @{N = 'DriverDate'; E = { $_.DriverDate } },
        @{N = 'Manufacturer'; E = { $_.Manufacturer } },
        @{N = 'DeviceClass'; E = { $_.DeviceClass } },
        @{N = 'InfName'; E = { $_.InfName } },
        @{N = 'IsSigned'; E = { $_.IsSigned } }
        
        # Filter by category if specified
        if ($Category -ne "All") {
            $classFilter = switch ($Category) {
                "Display" { "Display" }
                "Network" { "Net" }
                "Audio" { "MEDIA|AudioEndpoint" }
                "USB" { "USB" }
                "Storage" { "DiskDrive|SCSIAdapter|hdc" }
                "System" { "System" }
            }
            $drivers = $drivers | Where-Object { $_.DeviceClass -match $classFilter }
        }
        
        # Calculate age and flag outdated drivers (>1 year old)
        $oneYearAgo = (Get-Date).AddYears(-1)
        $drivers = $drivers | ForEach-Object {
            $_ | Add-Member -NotePropertyName "IsOutdated" -NotePropertyValue ($_.DriverDate -lt $oneYearAgo) -PassThru
        }
        
        $outdatedCount = ($drivers | Where-Object { $_.IsOutdated }).Count
        Write-Log -Message "Found $($drivers.Count) drivers ($outdatedCount potentially outdated)" -Level Info
        
        return $drivers
    }
    catch {
        Write-Log -Message "Failed to enumerate drivers: $($_.Exception.Message)" -Level Error
        return @()
    }
}

<#
.SYNOPSIS
    Gets detected GPU information.
    
.OUTPUTS
    [psobject] GPU information including vendor
#>
function Get-WinDebloat7GPUInfo {
    [CmdletBinding()]
    [OutputType([psobject])]
    param()
    
    try {
        $gpu = Get-CimInstance -ClassName Win32_VideoController | Select-Object -First 1
        
        $vendor = switch -Regex ($gpu.Name) {
            "NVIDIA" { "NVIDIA" }
            "AMD|Radeon" { "AMD" }
            "Intel" { "Intel" }
            default { "Unknown" }
        }
        
        return [pscustomobject]@{
            Name          = $gpu.Name
            Vendor        = $vendor
            DriverVersion = $gpu.DriverVersion
            DriverDate    = $gpu.DriverDate
            AdapterRAM    = [math]::Round($gpu.AdapterRAM / 1GB, 2)
        }
    }
    catch {
        Write-Log -Message "Failed to get GPU info: $($_.Exception.Message)" -Level Warning
        return $null
    }
}

#endregion

#region Driver Updates

<#
.SYNOPSIS
    Updates drivers using Windows Update.
    
.DESCRIPTION
    Uses the PSWindowsUpdate module to scan for and install driver updates
    from Windows Update.
    
.PARAMETER AcceptAll
    Automatically accept all driver updates without prompting.
#>
function Update-DriversViaWindowsUpdate {
    [CmdletBinding(SupportsShouldProcess)]
    [OutputType([void])]
    param(
        [switch]$AcceptAll
    )
    
    # Check for PSWindowsUpdate module
    if (-not (Get-Module -ListAvailable -Name PSWindowsUpdate)) {
        Write-Log -Message "PSWindowsUpdate module not found." -Level Warning
        
        $response = Read-Host "Install PSWindowsUpdate module? [Y/N]"
        if ($response -match '^[Yy]') {
            try {
                Install-PSResource -Name PSWindowsUpdate -Scope CurrentUser -TrustRepository -ErrorAction Stop
                Import-Module PSWindowsUpdate -ErrorAction Stop
            }
            catch {
                Write-Log -Message "Failed to install PSWindowsUpdate: $($_.Exception.Message)" -Level Error
                return
            }
        }
        else {
            return
        }
    }
    
    Import-Module PSWindowsUpdate -ErrorAction Stop
    
    Write-Log -Message "Scanning Windows Update for driver updates..." -Level Info
    
    try {
        # Get driver updates
        $updates = Get-WindowsUpdate -Category "Drivers" -ErrorAction Stop
        
        if ($updates.Count -eq 0) {
            Write-Log -Message "No driver updates available from Windows Update." -Level Info
            return
        }
        
        Write-Host "`nAvailable Driver Updates:" -ForegroundColor Cyan
        $updates | ForEach-Object { 
            Write-Host "  - $($_.Title)" -ForegroundColor White 
        }
        
        if (-not $AcceptAll) {
            $confirm = Read-Host "`nInstall $($updates.Count) driver updates? [Y/N]"
            if ($confirm -notmatch '^[Yy]') { return }
        }
        
        if ($PSCmdlet.ShouldProcess("$($updates.Count) drivers", "Install via Windows Update")) {
            Write-Log -Message "Installing driver updates via Windows Update..." -Level Info
            Install-WindowsUpdate -Category "Drivers" -AcceptAll -IgnoreReboot -ErrorAction Stop
            Write-Log -Message "Driver updates installed successfully." -Level Success
        }
    }
    catch {
        Write-Log -Message "Windows Update driver installation failed: $($_.Exception.Message)" -Level Error
    }
}

<#
.SYNOPSIS
    Updates GPU drivers via Winget.
    
.DESCRIPTION
    Detects GPU vendor and installs appropriate driver/software package.
#>
function Update-GPUDriverViaWinget {
    [CmdletBinding(SupportsShouldProcess)]
    [OutputType([void])]
    param()
    
    # Check for Winget
    try { $null = Get-Command winget -ErrorAction Stop }
    catch {
        Write-Log -Message "Winget not available for GPU driver installation." -Level Warning
        return
    }
    
    $gpu = Get-WinDebloat7GPUInfo
    if (-not $gpu) {
        Write-Log -Message "Could not detect GPU." -Level Warning
        return
    }
    
    Write-Log -Message "Detected GPU: $($gpu.Name) ($($gpu.Vendor))" -Level Info
    
    $packages = switch ($gpu.Vendor) {
        "NVIDIA" { 
            @(
                @{ Name = "GeForce Experience"; Id = "NVIDIA.GeForceExperience" }
                @{ Name = "NVIDIA App"; Id = "NVIDIA.NVIDIAApp" }
            )
        }
        "AMD" {
            @(
                @{ Name = "AMD Software: Adrenalin Edition"; Id = "AMD.RyzenMaster" }
            )
        }
        "Intel" {
            @(
                @{ Name = "Intel Driver & Support Assistant"; Id = "Intel.IntelDriverAndSupportAssistant" }
            )
        }
        default {
            Write-Log -Message "Unknown GPU vendor - cannot auto-update drivers." -Level Warning
            return
        }
    }
    
    Write-Host "`nGPU Driver Options for $($gpu.Vendor):" -ForegroundColor Cyan
    $i = 1
    foreach ($pkg in $packages) {
        Write-Host "  [$i] $($pkg.Name)" -ForegroundColor White
        $i++
    }
    Write-Host "  [S] Skip GPU driver update" -ForegroundColor Gray
    
    $sel = Read-Host "Select option"
    if ($sel -match '^[Ss]$') { return }
    
    $selectedPkg = $packages[[int]$sel - 1]
    if ($selectedPkg) {
        if ($PSCmdlet.ShouldProcess($selectedPkg.Name, "Install via Winget")) {
            Write-Log -Message "Installing $($selectedPkg.Name)..." -Level Info
            $result = winget install $selectedPkg.Id --accept-source-agreements --accept-package-agreements 2>&1
            
            if ($LASTEXITCODE -eq 0) {
                Write-Log -Message "$($selectedPkg.Name) installed/updated successfully." -Level Success
            }
            else {
                Write-Log -Message "Installation result: $result" -Level Warning
            }
        }
    }
}

<#
.SYNOPSIS
    Opens Snappy Driver Installer Origin for comprehensive driver updates.
    
.DESCRIPTION
    SDIO is a portable, open-source driver updater with offline driver packs.
    This function downloads and launches SDIO if not present.
#>
function Start-SnappyDriverInstaller {
    [CmdletBinding(SupportsShouldProcess)]
    [OutputType([void])]
    param()
    
    $sdioPath = "$env:ProgramData\Win-Debloat7\Tools\SDIO"
    $sdioExe = "$sdioPath\SDIO_x64_R2408.exe"
    
    # Check if already downloaded
    if (-not (Test-Path $sdioExe)) {
        Write-Log -Message "Snappy Driver Installer Origin not found. Downloading..." -Level Info
        
        try {
            New-Item -Path $sdioPath -ItemType Directory -Force | Out-Null
            
            # SDIO download URL (check for latest version yourself)
            $sdioUrl = "https://www.glenn.delahoy.com/downloads/sdio/SDIO_1.12.18.781.zip"
            $zipPath = "$env:TEMP\sdio.zip"
            
            if ($PSCmdlet.ShouldProcess("SDIO", "Download and extract")) {
                Invoke-WebRequest -Uri $sdioUrl -OutFile $zipPath -ErrorAction Stop
                Expand-Archive -Path $zipPath -DestinationPath $sdioPath -Force
                Remove-Item $zipPath -Force -ErrorAction SilentlyContinue
                
                # Find the exe
                $sdioExe = Get-ChildItem $sdioPath -Filter "SDIO*.exe" -Recurse | Select-Object -First 1 -ExpandProperty FullName
            }
        }
        catch {
            Write-Log -Message "Failed to download SDIO: $($_.Exception.Message)" -Level Error
            Write-Log -Message "Download manually from: https://www.glenn.delahoy.com/snappy-driver-installer-origin/" -Level Info
            return
        }
    }
    
    if (Test-Path $sdioExe) {
        Write-Log -Message "Launching Snappy Driver Installer Origin..." -Level Info
        if ($PSCmdlet.ShouldProcess("SDIO", "Launch")) {
            Start-Process -FilePath $sdioExe
        }
    }
    else {
        Write-Log -Message "SDIO executable not found." -Level Error
    }
}

<#
.SYNOPSIS
    Main driver update function with multiple options.
    
.DESCRIPTION
    Provides interactive driver update experience with multiple sources:
    - Windows Update
    - GPU drivers via Winget
    - Snappy Driver Installer Origin
    
.PARAMETER Method
    Update method: WindowsUpdate, GPU, SDIO, or Interactive (menu).
#>
function Update-WinDebloat7Drivers {
    [CmdletBinding(SupportsShouldProcess)]
    [OutputType([void])]
    param(
        [ValidateSet("WindowsUpdate", "GPU", "SDIO", "Interactive")]
        [string]$Method = "Interactive"
    )
    
    switch ($Method) {
        "WindowsUpdate" { Update-DriversViaWindowsUpdate }
        "GPU" { Update-GPUDriverViaWinget }
        "SDIO" { Start-SnappyDriverInstaller }
        "Interactive" {
            Write-Host "`n" -ForegroundColor Cyan
            Write-Host "         Driver Update Center              " -ForegroundColor Cyan
            Write-Host "" -ForegroundColor Cyan
            
            # Show current driver status
            $gpu = Get-WinDebloat7GPUInfo
            if ($gpu) {
                Write-Host "`nCurrent GPU: $($gpu.Name)" -ForegroundColor White
                Write-Host "Driver Version: $($gpu.DriverVersion)" -ForegroundColor Gray
            }
            
            $outdated = (Get-WinDebloat7DriverStatus | Where-Object { $_.IsOutdated }).Count
            Write-Host "Potentially Outdated Drivers: $outdated" -ForegroundColor $(if ($outdated -gt 5) { "Yellow" } else { "Gray" })
            
            Write-Host "`nUpdate Options:" -ForegroundColor Cyan
            Write-Host "  [1] Windows Update - Official Microsoft drivers" -ForegroundColor White
            Write-Host "  [2] GPU Driver - NVIDIA/AMD/Intel via Winget" -ForegroundColor White
            Write-Host "  [3] Snappy Driver Installer - Comprehensive offline drivers" -ForegroundColor White
            Write-Host "  [4] View All Drivers" -ForegroundColor White
            Write-Host "  [B] Back" -ForegroundColor Gray
            
            $choice = Read-Host "`nSelect option"
            
            switch ($choice) {
                "1" { Update-DriversViaWindowsUpdate }
                "2" { Update-GPUDriverViaWinget }
                "3" { Start-SnappyDriverInstaller }
                "4" {
                    $drivers = Get-WinDebloat7DriverStatus
                    $drivers | Sort-Object DeviceClass | Format-Table DeviceName, DriverVersion, IsOutdated -AutoSize | Out-Host
                    Read-Host "Press Enter to continue..."
                }
            }
        }
    }
}

#endregion

Export-ModuleMember -Function @(
    'Get-WinDebloat7DriverStatus',
    'Get-WinDebloat7GPUInfo',
    'Update-WinDebloat7Drivers'
)


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\src\modules\Network\Network.psm1
================================================================================

<#
.SYNOPSIS
    Network configuration module for Win-Debloat7
    
.DESCRIPTION
    Handles DNS configuration, IPv6 management, and network privacy settings.
    Supports multiple DNS providers with easy switching.
    
.NOTES
    Module: Win-Debloat7.Modules.Network
    Version: 1.0.0
    
.LINK
    https://learn.microsoft.com/powershell/scripting/whats-new/what-s-new-in-powershell-75
#>

#Requires -Version 7.5
#Requires -RunAsAdministrator

using namespace System.Management.Automation

Import-Module "$PSScriptRoot\..\..\core\Logger.psm1" -Force

#region DNS Providers

$Script:DNSProviders = @{
    Cloudflare = @{
        Name          = "Cloudflare (Privacy-Focused)"
        IPv4Primary   = "1.1.1.1"
        IPv4Secondary = "1.0.0.1"
        IPv6Primary   = "2606:4700:4700::1111"
        IPv6Secondary = "2606:4700:4700::1001"
    }
    Google     = @{
        Name          = "Google Public DNS"
        IPv4Primary   = "8.8.8.8"
        IPv4Secondary = "8.8.4.4"
        IPv6Primary   = "2001:4860:4860::8888"
        IPv6Secondary = "2001:4860:4860::8844"
    }
    Quad9      = @{
        Name          = "Quad9 (Security-Focused)"
        IPv4Primary   = "9.9.9.9"
        IPv4Secondary = "149.112.112.112"
        IPv6Primary   = "2620:fe::fe"
        IPv6Secondary = "2620:fe::9"
    }
    AdGuard    = @{
        Name          = "AdGuard DNS (Ad-Blocking)"
        IPv4Primary   = "94.140.14.14"
        IPv4Secondary = "94.140.15.15"
        IPv6Primary   = "2a10:50c0::ad1:ff"
        IPv6Secondary = "2a10:50c0::ad2:ff"
    }
    OpenDNS    = @{
        Name          = "OpenDNS (Cisco)"
        IPv4Primary   = "208.67.222.222"
        IPv4Secondary = "208.67.220.220"
        IPv6Primary   = "2620:119:35::35"
        IPv6Secondary = "2620:119:53::53"
    }
    NextDNS    = @{
        Name          = "NextDNS (Customizable)"
        IPv4Primary   = "45.90.28.0"
        IPv4Secondary = "45.90.30.0"
        IPv6Primary   = "2a07:a8c0::"
        IPv6Secondary = "2a07:a8c1::"
    }
}

#endregion

#region DNS Configuration

<#
.SYNOPSIS
    Sets DNS servers on all network adapters.
    
.PARAMETER Provider
    DNS provider preset: Cloudflare, Google, Quad9, AdGuard, OpenDNS, NextDNS.
    
.PARAMETER CustomPrimary
    Custom primary DNS server (use with -Provider Custom).
    
.PARAMETER CustomSecondary
    Custom secondary DNS server (use with -Provider Custom).
    
.PARAMETER IncludeIPv6
    Also set IPv6 DNS servers.
    
.EXAMPLE
    Set-WinDebloat7DNS -Provider Cloudflare
    
.EXAMPLE
    Set-WinDebloat7DNS -Provider Custom -CustomPrimary "1.2.3.4" -CustomSecondary "5.6.7.8"
#>
function Set-WinDebloat7DNS {
    [CmdletBinding(SupportsShouldProcess)]
    [OutputType([void])]
    param(
        [Parameter(Mandatory)]
        [ValidateSet("Cloudflare", "Google", "Quad9", "AdGuard", "OpenDNS", "NextDNS", "Custom", "Reset")]
        [string]$Provider,
        
        [string]$CustomPrimary,
        [string]$CustomSecondary,
        
        [switch]$IncludeIPv6
    )
    
    # Get active network adapters
    $adapters = Get-NetAdapter | Where-Object { $_.Status -eq "Up" }
    
    if ($adapters.Count -eq 0) {
        Write-Log -Message "No active network adapters found." -Level Warning
        return
    }
    
    Write-Log -Message "Configuring DNS on $($adapters.Count) adapter(s)..." -Level Info
    
    # Determine DNS servers
    if ($Provider -eq "Reset") {
        # Reset to DHCP
        foreach ($adapter in $adapters) {
            if ($PSCmdlet.ShouldProcess($adapter.Name, "Reset DNS to DHCP")) {
                try {
                    Set-DnsClientServerAddress -InterfaceIndex $adapter.ifIndex -ResetServerAddresses
                    Write-Log -Message "Reset DNS on $($adapter.Name) to DHCP" -Level Success
                }
                catch {
                    Write-Log -Message "Failed to reset DNS on $($adapter.Name): $($_.Exception.Message)" -Level Error
                }
            }
        }
        return
    }
    elseif ($Provider -eq "Custom") {
        if (-not $CustomPrimary) {
            Write-Log -Message "Custom provider requires -CustomPrimary parameter." -Level Error
            return
        }
        $primary = $CustomPrimary
        $secondary = $CustomSecondary
        $providerName = "Custom"
    }
    else {
        $dns = $Script:DNSProviders[$Provider]
        $primary = $dns.IPv4Primary
        $secondary = $dns.IPv4Secondary
        $providerName = $dns.Name
    }
    
    $dnsServers = @($primary)
    if ($secondary) { $dnsServers += $secondary }
    
    foreach ($adapter in $adapters) {
        if ($PSCmdlet.ShouldProcess($adapter.Name, "Set DNS to $providerName")) {
            try {
                Set-DnsClientServerAddress -InterfaceIndex $adapter.ifIndex -ServerAddresses $dnsServers
                Write-Log -Message "Set DNS on $($adapter.Name) to $providerName ($($dnsServers -join ', '))" -Level Success
                
                # IPv6 if requested
                if ($IncludeIPv6 -and $Provider -ne "Custom") {
                    $dns = $Script:DNSProviders[$Provider]
                    $ipv6Servers = @($dns.IPv6Primary, $dns.IPv6Secondary)
                    try {
                        Set-DnsClientServerAddress -InterfaceIndex $adapter.ifIndex -ServerAddresses ($dnsServers + $ipv6Servers)
                        Write-Log -Message "Added IPv6 DNS servers" -Level Debug
                    }
                    catch {
                        Write-Log -Message "Failed to set IPv6 DNS: $($_.Exception.Message)" -Level Warning
                    }
                }
            }
            catch {
                Write-Log -Message "Failed to set DNS on $($adapter.Name): $($_.Exception.Message)" -Level Error
            }
        }
    }
    
    # Flush DNS cache
    Write-Log -Message "Flushing DNS cache..." -Level Info
    Clear-DnsClientCache
    Write-Log -Message "DNS configuration complete." -Level Success
}

<#
.SYNOPSIS
    Gets the list of available DNS providers.
    
.OUTPUTS
    [hashtable] DNS provider configurations.
#>
function Get-WinDebloat7DNSProviders {
    [CmdletBinding()]
    [OutputType([hashtable])]
    param()
    
    return $Script:DNSProviders
}

#endregion

#region IPv6 Management

<#
.SYNOPSIS
    Disables IPv6 on all network adapters.
    
.DESCRIPTION
    Disables IPv6 binding on all adapters. Some privacy tools recommend this
    to prevent IPv6 leaks, though it may break some network features.
#>
function Disable-WinDebloat7IPv6 {
    [CmdletBinding(SupportsShouldProcess, ConfirmImpact = 'High')]
    [OutputType([void])]
    param()
    
    Write-Log -Message "Disabling IPv6 on all adapters..." -Level Info
    
    $adapters = Get-NetAdapter
    $successCount = 0
    
    foreach ($adapter in $adapters) {
        if ($PSCmdlet.ShouldProcess($adapter.Name, "Disable IPv6")) {
            try {
                Disable-NetAdapterBinding -Name $adapter.Name -ComponentID ms_tcpip6 -ErrorAction Stop
                Write-Log -Message "Disabled IPv6 on $($adapter.Name)" -Level Success
                $successCount++
            }
            catch {
                Write-Log -Message "Failed to disable IPv6 on $($adapter.Name): $($_.Exception.Message)" -Level Warning
            }
        }
    }
    
    Write-Log -Message "IPv6 disabled on $successCount adapter(s)." -Level Success
}

<#
.SYNOPSIS
    Enables IPv6 on all network adapters.
#>
function Enable-WinDebloat7IPv6 {
    [CmdletBinding(SupportsShouldProcess)]
    [OutputType([void])]
    param()
    
    Write-Log -Message "Enabling IPv6 on all adapters..." -Level Info
    
    $adapters = Get-NetAdapter
    
    foreach ($adapter in $adapters) {
        if ($PSCmdlet.ShouldProcess($adapter.Name, "Enable IPv6")) {
            try {
                Enable-NetAdapterBinding -Name $adapter.Name -ComponentID ms_tcpip6 -ErrorAction Stop
                Write-Log -Message "Enabled IPv6 on $($adapter.Name)" -Level Success
            }
            catch {
                Write-Log -Message "Failed to enable IPv6 on $($adapter.Name): $($_.Exception.Message)" -Level Warning
            }
        }
    }
}

#endregion

#region Network Status

<#
.SYNOPSIS
    Gets the current network configuration status.
    
.OUTPUTS
    [psobject[]] Network adapter status objects.
#>
function Get-WinDebloat7NetworkStatus {
    [CmdletBinding()]
    [OutputType([psobject[]])]
    param()
    
    $adapters = Get-NetAdapter | Where-Object { $_.Status -eq "Up" }
    
    $results = foreach ($adapter in $adapters) {
        $dnsServers = (Get-DnsClientServerAddress -InterfaceIndex $adapter.ifIndex -AddressFamily IPv4).ServerAddresses
        $ipv6Enabled = (Get-NetAdapterBinding -Name $adapter.Name -ComponentID ms_tcpip6).Enabled
        
        # Try to identify DNS provider
        $provider = "Unknown"
        foreach ($providerName in $Script:DNSProviders.Keys) {
            $p = $Script:DNSProviders[$providerName]
            if ($dnsServers -contains $p.IPv4Primary) {
                $provider = $providerName
                break
            }
        }
        if ($dnsServers.Count -eq 0) { $provider = "DHCP" }
        
        [pscustomobject]@{
            Adapter     = $adapter.Name
            Status      = $adapter.Status
            DNSServers  = $dnsServers -join ", "
            DNSProvider = $provider
            IPv6Enabled = $ipv6Enabled
        }
    }
    
    return $results
}

<#
.SYNOPSIS
    Applies network settings from a profile configuration.
    
.PARAMETER Config
    The configuration object loaded from a YAML profile.
#>
function Set-WinDebloat7Network {
    [CmdletBinding(SupportsShouldProcess)]
    [OutputType([void])]
    param(
        [Parameter(Mandatory)]
        [psobject]$Config
    )
    
    if (-not $Config.network) {
        Write-Log -Message "No network configuration in profile." -Level Info
        return
    }
    
    # DNS Configuration
    if ($Config.network.dns_servers -and $Config.network.dns_servers.Count -gt 0) {
        $primary = $Config.network.dns_servers[0]
        $secondary = if ($Config.network.dns_servers.Count -gt 1) { $Config.network.dns_servers[1] } else { $null }
        
        # Check if it matches a known provider
        $matchedProvider = $null
        foreach ($providerName in $Script:DNSProviders.Keys) {
            if ($Script:DNSProviders[$providerName].IPv4Primary -eq $primary) {
                $matchedProvider = $providerName
                break
            }
        }
        
        if ($matchedProvider) {
            Set-WinDebloat7DNS -Provider $matchedProvider
        }
        else {
            Set-WinDebloat7DNS -Provider Custom -CustomPrimary $primary -CustomSecondary $secondary
        }
    }
    
    # IPv6
    if ($Config.network.disable_ipv6 -eq $true) {
        Disable-WinDebloat7IPv6
    }
}

#endregion

Export-ModuleMember -Function @(
    'Set-WinDebloat7DNS',
    'Get-WinDebloat7DNSProviders',
    'Disable-WinDebloat7IPv6',
    'Enable-WinDebloat7IPv6',
    'Get-WinDebloat7NetworkStatus',
    'Set-WinDebloat7Network'
)


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\src\modules\Performance\Gaming.psm1
================================================================================

<#
.SYNOPSIS
    Gaming optimization module for Win-Debloat7
    
.DESCRIPTION
    Advanced low-level optimizations for gaming and esports performance.
    Enhances network latency (TCPNoDelay), input lag (Mouse Acceleration),
    and system responsiveness (MMCSS).
    
.NOTES
    Module: Win-Debloat7.Modules.Performance.Gaming
    Version: 1.0.0
    
.LINK
    https://learn.microsoft.com/en-us/powershell/scripting/whats-new/what-s-new-in-powershell-75
#>

#Requires -Version 7.5
#Requires -RunAsAdministrator

using namespace System.Management.Automation

Import-Module "$PSScriptRoot\..\..\core\Logger.psm1" -Force
Import-Module "$PSScriptRoot\..\..\core\Registry.psm1" -Force

#region Gaming Optimizations

<#
.SYNOPSIS
    Applies strict gaming-focused optimizations.
    
.DESCRIPTION
    Configures critical low-latency settings:
    - TCPNoDelay (Nagle's Algorithm)
    - SystemResponsiveness
    - Multimedia Class Scheduler (MMCSS)
    - Mouse Acceleration (1:1 Input)
    
.PARAMETER EnableNetworkOptimization
    Disables Nagle's Algorithm and throttles network for gaming.
    
.PARAMETER EnableInputOptimization
    Disables Windows mouse acceleration for raw input.
    
.PARAMETER EnableMultimediaOptimization
    Prioritizes 'Games' profile in MMCSS.
#>
function Set-WinDebloat7Gaming {
    [CmdletBinding(SupportsShouldProcess, ConfirmImpact = 'Medium')]
    [OutputType([void])]
    param(
        [switch]$EnableNetworkOptimization,
        [switch]$EnableInputOptimization,
        [switch]$EnableMultimediaOptimization
    )
    
    Write-Log -Message "Applying Gaming Optimizations..." -Level Info
    $successCount = 0
    $failCount = 0
    
    # 1. Network Optimizations (Nagle's Fix)
    if ($EnableNetworkOptimization) {
        Write-Log -Message "Optimizing Network for Gaming (Low Latency)" -Level Info
        
        # Get active NICs
        $nics = Get-NetAdapter | Where-Object { $_.Status -eq "Up" }
        foreach ($nic in $nics) {
            # TCPNoDelay / TcpAckFrequency
            # Find registry key for this interface
            $regPath = "HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\Interfaces\$($nic.InterfaceGuid)"
            
            $results = @(
                (Set-RegistryKey -Path $regPath -Name "TcpAckFrequency" -Value 1 -Type DWord),
                (Set-RegistryKey -Path $regPath -Name "TCPNoDelay" -Value 1 -Type DWord),
                (Set-RegistryKey -Path "HKLM:\SOFTWARE\Microsoft\MSMQ\Parameters" -Name "TCPNoDelay" -Value 1 -Type DWord)
            )
            $successCount += ($results | Where-Object { $_ }).Count
        }
    }
    
    # 2. Input Optimizations (Mouse Accel)
    if ($EnableInputOptimization) {
        Write-Log -Message "Disabling Mouse Acceleration (1:1 Input)" -Level Info
        
        $results = @(
            (Set-RegistryKey -Path "HKCU:\Control Panel\Mouse" -Name "MouseSpeed" -Value "0" -Type String),
            (Set-RegistryKey -Path "HKCU:\Control Panel\Mouse" -Name "MouseThreshold1" -Value "0" -Type String),
            (Set-RegistryKey -Path "HKCU:\Control Panel\Mouse" -Name "MouseThreshold2" -Value "0" -Type String)
        )
        $successCount += ($results | Where-Object { $_ }).Count
    }
    
    # 3. Multimedia Class Scheduler (MMCSS)
    if ($EnableMultimediaOptimization) {
        Write-Log -Message "Tuning MMCSS for Gaming Priority" -Level Info
        
        $results = @(
            # Prioritize 'Games' profile
            (Set-RegistryKey -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile\Tasks\Games" -Name "GPU Priority" -Value 8 -Type DWord),
            (Set-RegistryKey -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile\Tasks\Games" -Name "Priority" -Value 6 -Type DWord),
            (Set-RegistryKey -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile\Tasks\Games" -Name "Scheduling Category" -Value "High" -Type String),
            (Set-RegistryKey -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile\Tasks\Games" -Name "SFIO Priority" -Value "High" -Type String),
            
            # Global System Profile
            (Set-RegistryKey -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile" -Name "SystemResponsiveness" -Value 0 -Type DWord)
        )
        $successCount += ($results | Where-Object { $_ }).Count
    }
    
    Write-Log -Message "Gaming optimizations applied: $successCount settings changed." -Level Success
}

Export-ModuleMember -Function Set-WinDebloat7Gaming


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\src\modules\Performance\Performance.psm1
================================================================================

<#
.SYNOPSIS
    Performance optimization module for Win-Debloat7
    
.DESCRIPTION
    Manages power plans, visual effects, and system responsiveness settings.
    Uses PowerShell 7.5 best practices with named constants and proper error handling.
    
.NOTES
    Module: Win-Debloat7.Modules.Performance
    Version: 1.1.0
    
.LINK
    https://learn.microsoft.com/en-us/powershell/scripting/whats-new/what-s-new-in-powershell-75
#>

#Requires -Version 7.5
#Requires -RunAsAdministrator

using namespace System.Management.Automation

Import-Module "$PSScriptRoot\..\..\core\Logger.psm1" -Force
Import-Module "$PSScriptRoot\..\..\core\Registry.psm1" -Force

#region Constants (CQ-006 fix: Named constants instead of magic GUIDs)
$Script:PowerPlanGUIDs = @{
    Balanced        = '381b4222-f694-41f0-9685-ff5bb260df2e'
    HighPerformance = '8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c'
    Ultimate        = 'e9a42b02-d5df-448d-aa00-03f14749eb61'
    PowerSaver      = 'a1841308-3541-4fab-bc81-f71556f20b4a'
}
#endregion

<#
.SYNOPSIS
    Applies performance settings based on configuration profile.
    
.DESCRIPTION
    Configures Windows performance settings including power plans,
    visual effects, Game Bar, and background apps.
    
.PARAMETER Config
    The configuration object loaded from a YAML profile.
    
.OUTPUTS
    [void]
    
.EXAMPLE
    Set-WinDebloat7Performance -Config $config
#>
function Set-WinDebloat7Performance {
    [CmdletBinding(SupportsShouldProcess, ConfirmImpact = 'Medium')]
    [OutputType([void])]
    param(
        [Parameter(Mandatory)]
        [ValidateNotNull()]
        [psobject]$Config
    )
    
    # Validate config has performance section
    if (-not $Config.performance) {
        Write-Log -Message "No performance configuration found in profile." -Level Warning
        return
    }
    
    $plan = $Config.performance.power_plan
    Write-Log -Message "Applying Performance Settings (Plan: $plan)" -Level Info
    
    $successCount = 0
    $failCount = 0
    $totalSteps = 5
    $currentStep = 0
    
    # 1. Power Plans (using named constants)
    $currentStep++
    Write-Progress -Activity "Applying Performance Settings" -Status "Configuring Power Plan: $plan" -PercentComplete (($currentStep / $totalSteps) * 100)
    try {
        switch ($plan) {
            "HighPerformance" {
                $guid = $Script:PowerPlanGUIDs.HighPerformance
                if ($PSCmdlet.ShouldProcess("Power Plan", "Set to High Performance")) {
                    $result = powercfg -SetActive $guid 2>&1
                    if ($LASTEXITCODE -eq 0) {
                        Write-Log -Message "Power Plan set to High Performance" -Level Success
                        $successCount++
                    }
                    else {
                        Write-Log -Message "Failed to set power plan: $result" -Level Error
                        $failCount++
                    }
                }
            }
            "Ultimate" {
                $guid = $Script:PowerPlanGUIDs.Ultimate
                if ($PSCmdlet.ShouldProcess("Power Plan", "Set to Ultimate Performance")) {
                    # Duplicate Ultimate Performance scheme if not exists
                    $existingPlans = powercfg -list 2>&1
                    if ($existingPlans -notmatch $guid) {
                        powercfg -DuplicateScheme $guid 2>&1 | Out-Null
                    }
                    $result = powercfg -SetActive $guid 2>&1
                    if ($LASTEXITCODE -eq 0) {
                        Write-Log -Message "Power Plan set to Ultimate Performance" -Level Success
                        $successCount++
                    }
                    else {
                        Write-Log -Message "Failed to set power plan: $result" -Level Error
                        $failCount++
                    }
                }
            }
            "Balanced" {
                $guid = $Script:PowerPlanGUIDs.Balanced
                if ($PSCmdlet.ShouldProcess("Power Plan", "Set to Balanced")) {
                    powercfg -SetActive $guid 2>&1 | Out-Null
                    Write-Log -Message "Power Plan set to Balanced" -Level Success
                    $successCount++
                }
            }
            default {
                Write-Log -Message "Unknown power plan: $plan" -Level Warning
            }
        }
    }
    catch {
        Write-Log -Message "Power plan configuration failed: $($_.Exception.Message)" -Level Error
        $failCount++
    }
    
    # 2. Visual Effects (Registry)
    if ($Config.performance.visual_effects -eq "Performance") {
        $currentStep++
        Write-Progress -Activity "Applying Performance Settings" -Status "Optimizing Visual Effects" -PercentComplete (($currentStep / $totalSteps) * 100)
        Write-Log -Message "Optimizing Visual Effects for Performance" -Level Info
        
        $results = @(
            # Reduce Menu Delay
            (Set-RegistryKey -Path "HKCU:\Control Panel\Desktop" -Name "MenuShowDelay" -Value "1" -Type String),
            # Disable Animation
            (Set-RegistryKey -Path "HKCU:\Control Panel\Desktop\WindowMetrics" -Name "MinAnimate" -Value "0" -Type String)
        )
        
        $successCount += ($results | Where-Object { $_ }).Count
        $failCount += ($results | Where-Object { -not $_ }).Count
    }
    
    # 3. Game Mode & DVR
    if ($Config.performance.disable_game_bar) {
        $currentStep++
        Write-Progress -Activity "Applying Performance Settings" -Status "Disabling Game Bar" -PercentComplete (($currentStep / $totalSteps) * 100)
        Write-Log -Message "Disabling Game Bar" -Level Info
        
        $results = @(
            (Set-RegistryKey -Path "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\GameDVR" -Name "AppCaptureEnabled" -Value 0),
            (Set-RegistryKey -Path "HKCU:\System\GameConfigStore" -Name "GameDVR_Enabled" -Value 0)
        )
        
        $successCount += ($results | Where-Object { $_ }).Count
        $failCount += ($results | Where-Object { -not $_ }).Count
    }
    
    # 4. Background Apps
    if ($Config.performance.disable_background_apps) {
        $currentStep++
        Write-Progress -Activity "Applying Performance Settings" -Status "Disabling Background Apps" -PercentComplete (($currentStep / $totalSteps) * 100)
        Write-Log -Message "Disabling Background Apps" -Level Info
        
        $results = @(
            (Set-RegistryKey -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\BackgroundAccessApplications" -Name "GlobalUserDisabled" -Value 1),
            (Set-RegistryKey -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\AppPrivacy" -Name "LetAppsRunInBackground" -Value 2)
        )
        
        $successCount += ($results | Where-Object { $_ }).Count
        $failCount += ($results | Where-Object { -not $_ }).Count
    }
    
    # 5. Network Throttling
    $currentStep++
    Write-Progress -Activity "Applying Performance Settings" -Status "Disabling Network Throttling" -PercentComplete (($currentStep / $totalSteps) * 100)
    Write-Log -Message "Disabling Network Throttling" -Level Info
    if (Set-RegistryKey -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile" -Name "NetworkThrottlingIndex" -Value 0xffffffff) {
        $successCount++
    }
    else {
        $failCount++
    }
    
    Write-Progress -Activity "Applying Performance Settings" -Completed
    
    # Summary
    Write-Log -Message "Performance settings applied: $successCount succeeded, $failCount failed" -Level $(if ($failCount -eq 0) { "Success" } else { "Warning" })
}

Export-ModuleMember -Function Set-WinDebloat7Performance


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\src\modules\Privacy\Hosts.psm1
================================================================================

<#
.SYNOPSIS
    Hosts file management module for Win-Debloat7
    
.DESCRIPTION
    Manages Windows hosts file to block telemetry endpoints at DNS level.
    Includes backup/restore functionality and curated blocklist.
    
.NOTES
    Module: Win-Debloat7.Modules.Privacy.Hosts
    Version: 1.0.0
    
.LINK
    https://learn.microsoft.com/powershell/scripting/whats-new/what-s-new-in-powershell-75
#>

#Requires -Version 7.5
#Requires -RunAsAdministrator

using namespace System.Management.Automation

Import-Module "$PSScriptRoot\..\..\core\Logger.psm1" -Force

#region Blocked Domains

$Script:HostsFilePath = "$env:SystemRoot\System32\drivers\etc\hosts"
$Script:BackupPath = "$env:ProgramData\Win-Debloat7\Backups"
$Script:BlockMarkerStart = "# >>> Win-Debloat7 Telemetry Block Start <<<"
$Script:BlockMarkerEnd = "# >>> Win-Debloat7 Telemetry Block End <<<"

# Curated list of telemetry domains to block
$Script:TelemetryDomains = @(
    # Microsoft Telemetry Core
    "vortex.data.microsoft.com"
    "vortex-win.data.microsoft.com"
    "telecommand.telemetry.microsoft.com"
    "telecommand.telemetry.microsoft.com.nsatc.net"
    "oca.telemetry.microsoft.com"
    "oca.telemetry.microsoft.com.nsatc.net"
    "sqm.telemetry.microsoft.com"
    "sqm.telemetry.microsoft.com.nsatc.net"
    "watson.telemetry.microsoft.com"
    "watson.telemetry.microsoft.com.nsatc.net"
    "redir.metaservices.microsoft.com"
    "choice.microsoft.com"
    "choice.microsoft.com.nsatc.net"
    "df.telemetry.microsoft.com"
    "reports.wes.df.telemetry.microsoft.com"
    "wes.df.telemetry.microsoft.com"
    "services.wes.df.telemetry.microsoft.com"
    "sqm.df.telemetry.microsoft.com"
    "telemetry.microsoft.com"
    "watson.ppe.telemetry.microsoft.com"
    "telemetry.appex.bing.net"
    "telemetry.urs.microsoft.com"
    "telemetry.appex.bing.net:443"
    "settings-sandbox.data.microsoft.com"
    "settings-win.data.microsoft.com"
    "statsfe2.ws.microsoft.com"
    "statsfe1.ws.microsoft.com"
    "statsfe2.update.microsoft.com.akadns.net"
    
    # Cortana & Search
    "www.bing.com"  # Comment out if you use Bing
    # "search.msn.com"  # Breaks some search features
    
    # Advertising
    "ads.msn.com"
    "ads1.msads.net"
    "ads1.msn.com"
    "a.ads1.msn.com"
    "a.ads2.msn.com"
    "adnexus.net"
    "adnxs.com"
    "az361816.vo.msecnd.net"
    "az512334.vo.msecnd.net"
    
    # Windows Spotlight & Tips
    "arc.msn.com"
    "g.msn.com"
    "ris.api.iris.microsoft.com"
    
    # Location Tracking
    "inference.location.live.net"
    "location-inference-westus.cloudapp.net"
    
    # Error Reporting (comment if you want crash reports)
    # "watson.live.com"
    # "watson.microsoft.com"
    
    # Feedback Hub
    "feedback.windows.com"
    "feedback.microsoft-hohm.com"
    "feedback.search.microsoft.com"
)

#endregion

#region Hosts Functions

<#
.SYNOPSIS
    Backs up the current hosts file.
    
.OUTPUTS
    [string] Path to the backup file.
#>
function Backup-HostsFile {
    [CmdletBinding(SupportsShouldProcess)]
    [OutputType([string])]
    param()
    
    if (-not (Test-Path $Script:BackupPath)) {
        New-Item -Path $Script:BackupPath -ItemType Directory -Force | Out-Null
    }
    
    $timestamp = Get-Date -Format "yyyyMMdd-HHmmss"
    $backupFile = "$Script:BackupPath\hosts-backup-$timestamp"
    
    if ($PSCmdlet.ShouldProcess($Script:HostsFilePath, "Backup to $backupFile")) {
        try {
            Copy-Item -Path $Script:HostsFilePath -Destination $backupFile -Force
            Write-Log -Message "Hosts file backed up to: $backupFile" -Level Success
            return $backupFile
        }
        catch {
            Write-Log -Message "Failed to backup hosts file: $($_.Exception.Message)" -Level Error
            return $null
        }
    }
}

<#
.SYNOPSIS
    Adds telemetry blocking entries to the hosts file.
    
.DESCRIPTION
    Appends entries to block known telemetry domains. Creates a backup first.
    Entries are marked so they can be cleanly removed later.
    
.PARAMETER SkipBackup
    Skip creating a backup (not recommended).
#>
function Add-WinDebloat7HostsBlock {
    [CmdletBinding(SupportsShouldProcess, ConfirmImpact = 'High')]
    [OutputType([void])]
    param(
        [switch]$SkipBackup
    )
    
    # Check if already blocked
    $currentContent = Get-Content $Script:HostsFilePath -Raw -ErrorAction SilentlyContinue
    if ($currentContent -match [regex]::Escape($Script:BlockMarkerStart)) {
        Write-Log -Message "Telemetry blocks already present in hosts file." -Level Info
        return
    }
    
    # Backup
    if (-not $SkipBackup) {
        $backup = Backup-HostsFile
        if (-not $backup) {
            Write-Log -Message "Aborting - backup failed." -Level Error
            return
        }
    }
    
    Write-Log -Message "Adding telemetry blocks to hosts file..." -Level Info
    
    # Build block content
    $blockContent = @()
    $blockContent += ""
    $blockContent += $Script:BlockMarkerStart
    $blockContent += "# Added by Win-Debloat7 on $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')"
    $blockContent += "# To remove: Run Remove-WinDebloat7HostsBlock or delete this section"
    $blockContent += ""
    
    foreach ($domain in $Script:TelemetryDomains) {
        $blockContent += "0.0.0.0 $domain"
    }
    
    $blockContent += ""
    $blockContent += $Script:BlockMarkerEnd
    
    if ($PSCmdlet.ShouldProcess($Script:HostsFilePath, "Add $($Script:TelemetryDomains.Count) blocked domains")) {
        try {
            Add-Content -Path $Script:HostsFilePath -Value ($blockContent -join "`n") -Encoding UTF8
            
            # Flush DNS cache
            Clear-DnsClientCache
            
            Write-Log -Message "Added $($Script:TelemetryDomains.Count) telemetry blocks to hosts file." -Level Success
        }
        catch {
            Write-Log -Message "Failed to modify hosts file: $($_.Exception.Message)" -Level Error
        }
    }
}

<#
.SYNOPSIS
    Removes Win-Debloat7 telemetry blocks from hosts file.
#>
function Remove-WinDebloat7HostsBlock {
    [CmdletBinding(SupportsShouldProcess)]
    [OutputType([void])]
    param()
    
    Write-Log -Message "Removing telemetry blocks from hosts file..." -Level Info
    
    try {
        $content = Get-Content $Script:HostsFilePath -Raw
        
        # Check if blocks exist
        if ($content -notmatch [regex]::Escape($Script:BlockMarkerStart)) {
            Write-Log -Message "No Win-Debloat7 blocks found in hosts file." -Level Info
            return
        }
        
        # Remove the blocked section
        $pattern = "$([regex]::Escape($Script:BlockMarkerStart))[\s\S]*?$([regex]::Escape($Script:BlockMarkerEnd))"
        $newContent = $content -replace $pattern, ""
        
        # Clean up extra blank lines
        $newContent = $newContent -replace "(\r?\n){3,}", "`n`n"
        
        if ($PSCmdlet.ShouldProcess($Script:HostsFilePath, "Remove telemetry blocks")) {
            Set-Content -Path $Script:HostsFilePath -Value $newContent.Trim() -Encoding UTF8
            
            # Flush DNS cache
            Clear-DnsClientCache
            
            Write-Log -Message "Telemetry blocks removed from hosts file." -Level Success
        }
    }
    catch {
        Write-Log -Message "Failed to modify hosts file: $($_.Exception.Message)" -Level Error
    }
}

<#
.SYNOPSIS
    Gets the current status of hosts file blocking.
    
.OUTPUTS
    [psobject] Status object.
#>
function Get-WinDebloat7HostsStatus {
    [CmdletBinding()]
    [OutputType([psobject])]
    param()
    
    $content = Get-Content $Script:HostsFilePath -Raw -ErrorAction SilentlyContinue
    
    $isBlocked = $content -match [regex]::Escape($Script:BlockMarkerStart)
    
    $blockedCount = 0
    if ($isBlocked) {
        $blockedCount = ([regex]::Matches($content, "^0\.0\.0\.0 ", [System.Text.RegularExpressions.RegexOptions]::Multiline)).Count
    }
    
    # Get last backup
    $lastBackup = Get-ChildItem "$Script:BackupPath\hosts-backup-*" -ErrorAction SilentlyContinue | 
    Sort-Object LastWriteTime -Descending | 
    Select-Object -First 1
    
    return [pscustomobject]@{
        HostsFilePath           = $Script:HostsFilePath
        TelemetryBlocked        = $isBlocked
        BlockedDomainCount      = $blockedCount
        AvailableDomainsToBlock = $Script:TelemetryDomains.Count
        LastBackup              = $lastBackup.FullName
        LastBackupDate          = $lastBackup.LastWriteTime
    }
}

<#
.SYNOPSIS
    Gets the list of domains that will be blocked.
    
.OUTPUTS
    [string[]] Array of domain names.
#>
function Get-WinDebloat7TelemetryDomains {
    [CmdletBinding()]
    [OutputType([string[]])]
    param()
    
    return $Script:TelemetryDomains
}

#endregion

Export-ModuleMember -Function @(
    'Backup-HostsFile',
    'Add-WinDebloat7HostsBlock',
    'Remove-WinDebloat7HostsBlock',
    'Get-WinDebloat7HostsStatus',
    'Get-WinDebloat7TelemetryDomains'
)


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\src\modules\Privacy\Privacy.psm1
================================================================================

<#
.SYNOPSIS
    Privacy optimization module for Win-Debloat7
    
.DESCRIPTION
    Manages Windows privacy settings, telemetry, and data collection.
    Uses PowerShell 7.5 best practices with proper error handling.
    
.NOTES
    Module: Win-Debloat7.Modules.Privacy
    Version: 1.1.0
    
.LINK
    https://learn.microsoft.com/en-us/powershell/scripting/whats-new/what-s-new-in-powershell-75
#>

#Requires -Version 7.5
#Requires -RunAsAdministrator

using namespace System.Management.Automation

Import-Module "$PSScriptRoot\..\..\core\Logger.psm1" -Force
Import-Module "$PSScriptRoot\..\..\core\Registry.psm1" -Force

<#
.SYNOPSIS
    Applies privacy settings based on configuration profile.
    
.DESCRIPTION
    Configures Windows privacy settings including telemetry levels,
    advertising ID, activity history, location tracking, Copilot, and Recall.
    
.PARAMETER Config
    The configuration object loaded from a YAML profile.
    
.OUTPUTS
    [void]
    
.EXAMPLE
    Set-WinDebloat7Privacy -Config $config
#>
function Set-WinDebloat7Privacy {
    [CmdletBinding(SupportsShouldProcess, ConfirmImpact = 'High')]
    [OutputType([void])]
    param(
        [Parameter(Mandatory)]
        [ValidateNotNull()]
        [psobject]$Config
    )
    
    # Validate config has privacy section
    if (-not $Config.privacy) {
        Write-Log -Message "No privacy configuration found in profile." -Level Warning
        return
    }
    
    $level = $Config.privacy.telemetry_level
    Write-Log -Message "Applying Privacy Settings (Level: $level)" -Level Info
    
    $successCount = 0
    $failCount = 0
    $totalSteps = 5
    $currentStep = 0
    
    # 1. Advertising ID
    if ($Config.privacy.disable_advertising_id) {
        $currentStep++
        Write-Progress -Activity "Applying Privacy Settings" -Status "Disabling Advertising ID" -PercentComplete (($currentStep / $totalSteps) * 100)
        Write-Log -Message "Disabling Advertising ID" -Level Info
        
        $results = @(
            (Set-RegistryKey -Path "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\AdvertisingInfo" -Name "Enabled" -Value 0),
            (Set-RegistryKey -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\AdvertisingInfo" -Name "DisabledByGroupPolicy" -Value 1),
            (Set-RegistryKey -Path "HKCU:\Control Panel\International\User Profile" -Name "HttpAcceptLanguageOptOut" -Value 1)
        )
        
        $successCount += ($results | Where-Object { $_ }).Count
        $failCount += ($results | Where-Object { -not $_ }).Count
    }
    
    # 2. Activity History
    if ($Config.privacy.disable_activity_history) {
        $currentStep++
        Write-Progress -Activity "Applying Privacy Settings" -Status "Disabling Activity History" -PercentComplete (($currentStep / $totalSteps) * 100)
        Write-Log -Message "Disabling Activity History" -Level Info
        
        $results = @(
            (Set-RegistryKey -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\System" -Name "PublishUserActivities" -Value 0),
            (Set-RegistryKey -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\System" -Name "UploadUserActivities" -Value 0)
        )
        
        $successCount += ($results | Where-Object { $_ }).Count
        $failCount += ($results | Where-Object { -not $_ }).Count
    }
    
    # 3. Telemetry
    if ($level -eq "Security" -or $level -eq "Basic") {
        $currentStep++
        Write-Progress -Activity "Applying Privacy Settings" -Status "Restricting Telemetry to $level" -PercentComplete (($currentStep / $totalSteps) * 100)
        Write-Log -Message "Restricting Telemetry to '$level'" -Level Info
        # AllowTelemetry: 0 = Security, 1 = Basic, 3 = Full
        [int]$telemetryVal = if ($level -eq "Security") { 0 } else { 1 }
        
        $results = @(
            (Set-RegistryKey -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\DataCollection" -Name "AllowTelemetry" -Value $telemetryVal),
            (Set-RegistryKey -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\DataCollection" -Name "AllowTelemetry" -Value $telemetryVal)
        )
        
        $successCount += ($results | Where-Object { $_ }).Count
        $failCount += ($results | Where-Object { -not $_ }).Count
        
        # Disable DiagTrack service with proper error handling
        try {
            if ($PSCmdlet.ShouldProcess("DiagTrack", "Disable and Stop Service")) {
                Set-Service -Name "DiagTrack" -StartupType Disabled -ErrorAction Stop
                Stop-Service -Name "DiagTrack" -Force -ErrorAction Stop
                Write-Log -Message "DiagTrack service disabled and stopped" -Level Success
                $successCount++
            }
        }
        catch {
            Write-Log -Message "Failed to disable DiagTrack: $($_.Exception.Message)" -Level Error
            $failCount++
        }
        
        # Disable Telemetry Tasks (Added in v1.1.0)
        try {
            Write-Log -Message "Disabling Telemetry Scheduled Tasks (Safe Mode)" -Level Info
            Disable-WinDebloat7TelemetryTasks -Mode Safe
            $successCount++
        }
        catch {
            Write-Log -Message "Failed to disable telemetry tasks: $($_.Exception.Message)" -Level Warning
        }
    }
    
    # 4. Location Tracking
    if ($Config.privacy.disable_location_tracking) {
        Write-Log -Message "Disabling Location Tracking" -Level Info
        
        if (Set-RegistryKey -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\location" -Name "Value" -Value "Deny" -Type String) {
            $successCount++
        }
        else {
            $failCount++
        }
    }
    
    # 5. Copilot & Recall (25H2 Readiness)
    if ($Config.privacy.disable_copilot) {
        $currentStep++
        Write-Progress -Activity "Applying Privacy Settings" -Status "Disabling Windows Copilot" -PercentComplete (($currentStep / $totalSteps) * 100)
        Write-Log -Message "Disabling Windows Copilot" -Level Info
        
        $results = @(
            (Set-RegistryKey -Path "HKCU:\Software\Policies\Microsoft\Windows\WindowsCopilot" -Name "TurnOffWindowsCopilot" -Value 1),
            (Set-RegistryKey -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsCopilot" -Name "TurnOffWindowsCopilot" -Value 1)
        )
        
        $successCount += ($results | Where-Object { $_ }).Count
        $failCount += ($results | Where-Object { -not $_ }).Count
    }
    
    if ($Config.privacy.disable_recall) {
        Write-Log -Message "Disabling Windows Recall (AI Analysis)" -Level Info
        
        if (Set-RegistryKey -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsAI" -Name "DisableAIDataAnalysis" -Value 1) {
            $successCount++
        }
        else {
            $failCount++
        }
    }
    
    Write-Progress -Activity "Applying Privacy Settings" -Completed
    
    # Summary
    Write-Log -Message "Privacy settings applied: $successCount succeeded, $failCount failed" -Level $(if ($failCount -eq 0) { "Success" } else { "Warning" })
}

Export-ModuleMember -Function Set-WinDebloat7Privacy


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\src\modules\Privacy\Tasks.psm1
================================================================================

<#
.SYNOPSIS
    Scheduled task cleanup module for Win-Debloat7
    
.DESCRIPTION
    Identifies and disables telemetry-related scheduled tasks that can
    respawn tracking services even after they're disabled.
    
.NOTES
    Module: Win-Debloat7.Modules.Privacy.Tasks
    Version: 1.0.0
    
.LINK
    https://learn.microsoft.com/powershell/scripting/whats-new/what-s-new-in-powershell-75
#>

#Requires -Version 7.5
#Requires -RunAsAdministrator

using namespace System.Management.Automation

Import-Module "$PSScriptRoot\..\..\core\Logger.psm1" -Force

#region Telemetry Task Definitions

# Tasks to disable - organized by category
$Script:TelemetryTasks = @{
    # Safe to disable - no impact on core Windows functionality
    Safe       = @(
        # Application Experience
        @{ Path = "\Microsoft\Windows\Application Experience"; Name = "Microsoft Compatibility Appraiser" }
        @{ Path = "\Microsoft\Windows\Application Experience"; Name = "ProgramDataUpdater" }
        @{ Path = "\Microsoft\Windows\Application Experience"; Name = "StartupAppTask" }
        
        # Customer Experience Improvement Program
        @{ Path = "\Microsoft\Windows\Customer Experience Improvement Program"; Name = "Consolidator" }
        @{ Path = "\Microsoft\Windows\Customer Experience Improvement Program"; Name = "UsbCeip" }
        
        # Feedback
        @{ Path = "\Microsoft\Windows\Feedback\Siuf"; Name = "DmClient" }
        @{ Path = "\Microsoft\Windows\Feedback\Siuf"; Name = "DmClientOnScenarioDownload" }
        
        # Windows Error Reporting
        @{ Path = "\Microsoft\Windows\Windows Error Reporting"; Name = "QueueReporting" }
        
        # Disk Diagnostics
        @{ Path = "\Microsoft\Windows\DiskDiagnostic"; Name = "Microsoft-Windows-DiskDiagnosticDataCollector" }
        
        # Maps (if not using Windows Maps)
        @{ Path = "\Microsoft\Windows\Maps"; Name = "MapsToastTask" }
        @{ Path = "\Microsoft\Windows\Maps"; Name = "MapsUpdateTask" }
        
        # Cloud Experience
        @{ Path = "\Microsoft\Windows\CloudExperienceHost"; Name = "CreateObjectTask" }
    )
    
    # Aggressive - may impact some features
    Aggressive = @(
        # Autochk (proxy data collection)
        @{ Path = "\Microsoft\Windows\Autochk"; Name = "Proxy" }
        
        # Device Information
        @{ Path = "\Microsoft\Windows\Device Information"; Name = "Device" }
        @{ Path = "\Microsoft\Windows\Device Information"; Name = "Device User" }
        
        # License Validation (may impact Store apps - use with caution)
        @{ Path = "\Microsoft\Windows\License Manager"; Name = "TempSignedLicenseExchange" }
        
        # Maintenance (may impact Windows maintenance)
        @{ Path = "\Microsoft\Windows\Diagnosis"; Name = "Scheduled" }
        
        # PI (Privacy Intelligence)
        @{ Path = "\Microsoft\Windows\PI"; Name = "Sqm-Tasks" }
        
        # NetTrace 
        @{ Path = "\Microsoft\Windows\NetTrace"; Name = "GatherNetworkInfo" }
        
        # Power Efficiency Diagnostics
        @{ Path = "\Microsoft\Windows\Power Efficiency Diagnostics"; Name = "AnalyzeSystem" }
        
        # Shell (some edge cases)
        @{ Path = "\Microsoft\Windows\Shell"; Name = "FamilySafetyMonitor" }
        @{ Path = "\Microsoft\Windows\Shell"; Name = "FamilySafetyRefreshTask" }
        
        # Xbox (if not gaming)
        @{ Path = "\Microsoft\XblGameSave"; Name = "XblGameSaveTask" }
    )
}

#endregion

#region Task Functions

<#
.SYNOPSIS
    Gets telemetry-related scheduled tasks.
    
.PARAMETER Mode
    Which set of tasks to return: Safe, Aggressive, or All.
    
.OUTPUTS
    [psobject[]] Array of task objects with current state.
#>
function Get-WinDebloat7TelemetryTasks {
    [CmdletBinding()]
    [OutputType([psobject[]])]
    param(
        [ValidateSet("Safe", "Aggressive", "All")]
        [string]$Mode = "All"
    )
    
    Write-Log -Message "Scanning telemetry scheduled tasks..." -Level Info
    
    $taskDefs = switch ($Mode) {
        "Safe" { $Script:TelemetryTasks.Safe }
        "Aggressive" { $Script:TelemetryTasks.Aggressive }
        "All" { $Script:TelemetryTasks.Safe + $Script:TelemetryTasks.Aggressive }
    }
    
    $results = @()
    
    foreach ($taskDef in $taskDefs) {
        try {
            $fullPath = "$($taskDef.Path)\$($taskDef.Name)"
            $task = Get-ScheduledTask -TaskPath "$($taskDef.Path)\" -TaskName $taskDef.Name -ErrorAction SilentlyContinue
            
            if ($task) {
                $results += [pscustomobject]@{
                    TaskName = $taskDef.Name
                    TaskPath = $taskDef.Path
                    FullPath = $fullPath
                    State    = $task.State
                    Enabled  = ($task.State -ne "Disabled")
                    Category = if ($taskDef -in $Script:TelemetryTasks.Safe) { "Safe" } else { "Aggressive" }
                }
            }
        }
        catch {
            # Task doesn't exist - skip
        }
    }
    
    $enabledCount = ($results | Where-Object { $_.Enabled }).Count
    Write-Log -Message "Found $($results.Count) telemetry tasks ($enabledCount currently enabled)" -Level Info
    
    return $results
}

<#
.SYNOPSIS
    Disables telemetry scheduled tasks.
    
.PARAMETER Mode
    Which set of tasks to disable: Safe (recommended), Aggressive, or All.
    
.EXAMPLE
    Disable-WinDebloat7TelemetryTasks -Mode Safe
#>
function Disable-WinDebloat7TelemetryTasks {
    [CmdletBinding(SupportsShouldProcess, ConfirmImpact = 'Medium')]
    [OutputType([void])]
    param(
        [ValidateSet("Safe", "Aggressive", "All")]
        [string]$Mode = "Safe"
    )
    
    Write-Log -Message "Disabling telemetry tasks (Mode: $Mode)..." -Level Info
    
    $tasks = Get-WinDebloat7TelemetryTasks -Mode $Mode | Where-Object { $_.Enabled }
    
    if ($tasks.Count -eq 0) {
        Write-Log -Message "No enabled telemetry tasks to disable." -Level Info
        return
    }
    
    $successCount = 0
    $failCount = 0
    $total = $tasks.Count
    $current = 0
    
    foreach ($task in $tasks) {
        $current++
        $percent = [math]::Round(($current / $total) * 100)
        Write-Progress -Activity "Disabling Telemetry Tasks" -Status "[$current/$total] $($task.TaskName)" -PercentComplete $percent
        
        if ($PSCmdlet.ShouldProcess($task.FullPath, "Disable Scheduled Task")) {
            try {
                Disable-ScheduledTask -TaskPath "$($task.TaskPath)\" -TaskName $task.TaskName -ErrorAction Stop | Out-Null
                Write-Log -Message "Disabled: $($task.TaskName)" -Level Success
                $successCount++
            }
            catch {
                Write-Log -Message "Failed to disable $($task.TaskName): $($_.Exception.Message)" -Level Warning
                $failCount++
            }
        }
    }
    
    Write-Progress -Activity "Disabling Telemetry Tasks" -Completed
    Write-Log -Message "Task cleanup complete: $successCount disabled, $failCount failed" -Level $(if ($failCount -eq 0) { "Success" } else { "Warning" })
}

<#
.SYNOPSIS
    Re-enables previously disabled telemetry tasks.
    
.PARAMETER Mode
    Which set of tasks to enable: Safe, Aggressive, or All.
#>
function Enable-WinDebloat7TelemetryTasks {
    [CmdletBinding(SupportsShouldProcess)]
    [OutputType([void])]
    param(
        [ValidateSet("Safe", "Aggressive", "All")]
        [string]$Mode = "All"
    )
    
    Write-Log -Message "Re-enabling telemetry tasks (Mode: $Mode)..." -Level Info
    
    $tasks = Get-WinDebloat7TelemetryTasks -Mode $Mode | Where-Object { -not $_.Enabled }
    
    if ($tasks.Count -eq 0) {
        Write-Log -Message "No disabled telemetry tasks to enable." -Level Info
        return
    }
    
    foreach ($task in $tasks) {
        if ($PSCmdlet.ShouldProcess($task.FullPath, "Enable Scheduled Task")) {
            try {
                Enable-ScheduledTask -TaskPath "$($task.TaskPath)\" -TaskName $task.TaskName -ErrorAction Stop | Out-Null
                Write-Log -Message "Enabled: $($task.TaskName)" -Level Success
            }
            catch {
                Write-Log -Message "Failed to enable $($task.TaskName): $($_.Exception.Message)" -Level Warning
            }
        }
    }
}

#endregion

Export-ModuleMember -Function @(
    'Get-WinDebloat7TelemetryTasks',
    'Disable-WinDebloat7TelemetryTasks',
    'Enable-WinDebloat7TelemetryTasks'
)


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\src\modules\Software\Software.psm1
================================================================================

<#
.SYNOPSIS
    Software and package management module for Win-Debloat7
    
.DESCRIPTION
    Handles Winget and Chocolatey package installation with a comprehensive
    curated essentials list. Supports both package managers with auto-detection.
    
.NOTES
    Module: Win-Debloat7.Modules.Software
    Version: 1.0.0
    
.LINK
    https://learn.microsoft.com/powershell/scripting/whats-new/what-s-new-in-powershell-75
#>

#Requires -Version 7.5

using namespace System.Management.Automation
using namespace System.Collections.Generic

Import-Module "$PSScriptRoot\..\..\core\Logger.psm1" -Force

#region Package Manager Detection

<#
.SYNOPSIS
    Tests if a package manager is installed.
    
.PARAMETER Name
    The package manager to check: Winget or Chocolatey.
    
.OUTPUTS
    [bool] True if installed.
#>
function Test-PackageManager {
    [CmdletBinding()]
    [OutputType([bool])]
    param(
        [Parameter(Mandatory)]
        [ValidateSet("Winget", "Chocolatey")]
        [string]$Name
    )
    
    switch ($Name) {
        "Winget" {
            try {
                $null = Get-Command winget -ErrorAction Stop
                return $true
            }
            catch {
                return $false
            }
        }
        "Chocolatey" {
            try {
                $null = Get-Command choco -ErrorAction Stop
                return $true
            }
            catch {
                return $false
            }
        }
    }
    return $false
}

<#
.SYNOPSIS
    Installs a package manager if not present.
    
.PARAMETER Name
    Package manager to install: Winget or Chocolatey.
    
.PARAMETER Force
    Skip confirmation prompt.
#>
function Install-PackageManager {
    [CmdletBinding(SupportsShouldProcess)]
    [OutputType([bool])]
    param(
        [Parameter(Mandatory)]
        [ValidateSet("Winget", "Chocolatey")]
        [string]$Name,
        
        [switch]$Force
    )
    
    if (Test-PackageManager -Name $Name) {
        Write-Log -Message "$Name is already installed." -Level Info
        return $true
    }
    
    if (-not $Force) {
        $response = Read-Host "Install $Name? [Y/N]"
        if ($response -notmatch '^[Yy]') {
            Write-Log -Message "User declined $Name installation." -Level Warning
            return $false
        }
    }
    
    switch ($Name) {
        "Winget" {
            Write-Log -Message "Installing Winget via Microsoft Store..." -Level Info
            try {
                # Winget comes with App Installer - trigger store update
                if ($PSCmdlet.ShouldProcess("Winget", "Install via Add-AppxPackage")) {
                    # Download latest release from GitHub
                    $apiUrl = "https://api.github.com/repos/microsoft/winget-cli/releases/latest"
                    $release = Invoke-RestMethod -Uri $apiUrl -ErrorAction Stop
                    $msixUrl = $release.assets | Where-Object { $_.name -like "*.msixbundle" } | Select-Object -First 1 -ExpandProperty browser_download_url
                    
                    $tempPath = "$env:TEMP\winget.msixbundle"
                    Invoke-WebRequest -Uri $msixUrl -OutFile $tempPath -ErrorAction Stop
                    Add-AppxPackage -Path $tempPath -ErrorAction Stop
                    Remove-Item $tempPath -Force -ErrorAction SilentlyContinue
                    
                    Write-Log -Message "Winget installed successfully." -Level Success
                    return $true
                }
            }
            catch {
                Write-Log -Message "Failed to install Winget: $($_.Exception.Message)" -Level Error
                return $false
            }
        }
        "Chocolatey" {
            Write-Log -Message "Installing Chocolatey..." -Level Info
            try {
                if ($PSCmdlet.ShouldProcess("Chocolatey", "Install via official script")) {
                    Set-ExecutionPolicy Bypass -Scope Process -Force
                    [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072
                    Invoke-Expression ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))
                    
                    Write-Log -Message "Chocolatey installed successfully." -Level Success
                    return $true
                }
            }
            catch {
                Write-Log -Message "Failed to install Chocolatey: $($_.Exception.Message)" -Level Error
                return $false
            }
        }
    }
    
    return $false
}

#endregion

#region Essentials List

# Comprehensive curated app list by category
$Script:EssentialsApps = @{
    # === BROWSERS ===
    Browsers      = @{
        DisplayName = "Web Browsers"
        Apps        = @(
            @{ Name = "Mozilla Firefox"; Winget = "Mozilla.Firefox"; Choco = "firefox" }
            @{ Name = "Google Chrome"; Winget = "Google.Chrome"; Choco = "googlechrome" }
            @{ Name = "Brave Browser"; Winget = "Brave.Brave"; Choco = "brave" }
            @{ Name = "Microsoft Edge"; Winget = "Microsoft.Edge"; Choco = "microsoft-edge" }
            @{ Name = "Vivaldi"; Winget = "Vivaldi.Vivaldi"; Choco = "vivaldi" }
            @{ Name = "Opera GX"; Winget = "Opera.OperaGX"; Choco = "opera-gx" }
            @{ Name = "LibreWolf"; Winget = "LibreWolf.LibreWolf"; Choco = "librewolf" }
            @{ Name = "Tor Browser"; Winget = "TorProject.TorBrowser"; Choco = "tor-browser" }
        )
    }
    
    # === RUNTIMES ===
    Runtimes      = @{
        DisplayName = "Runtimes & Frameworks"
        Apps        = @(
            @{ Name = ".NET 8 Desktop Runtime"; Winget = "Microsoft.DotNet.DesktopRuntime.8"; Choco = "dotnet-8.0-desktopruntime" }
            @{ Name = ".NET 9 Desktop Runtime"; Winget = "Microsoft.DotNet.DesktopRuntime.9"; Choco = "dotnet-9.0-desktopruntime" }
            @{ Name = "VC++ 2015-2022 Redist"; Winget = "Microsoft.VCRedist.2015+.x64"; Choco = "vcredist140" }
            @{ Name = "VC++ 2015-2022 Redist (x86)"; Winget = "Microsoft.VCRedist.2015+.x86"; Choco = "vcredist140" }
            @{ Name = "Java Runtime (Temurin)"; Winget = "EclipseAdoptium.Temurin.21.JRE"; Choco = "temurin21jre" }
            @{ Name = "Java Development Kit"; Winget = "EclipseAdoptium.Temurin.21.JDK"; Choco = "temurin21" }
            @{ Name = "Node.js LTS"; Winget = "OpenJS.NodeJS.LTS"; Choco = "nodejs-lts" }
            @{ Name = "Python 3.12"; Winget = "Python.Python.3.12"; Choco = "python312" }
            @{ Name = "DirectX Runtime"; Winget = "Microsoft.DirectX"; Choco = "directx" }
        )
    }
    
    # === UTILITIES ===
    Utilities     = @{
        DisplayName = "System Utilities"
        Apps        = @(
            @{ Name = "7-Zip"; Winget = "7zip.7zip"; Choco = "7zip" }
            @{ Name = "WinRAR"; Winget = "RARLab.WinRAR"; Choco = "winrar" }
            @{ Name = "Everything Search"; Winget = "voidtools.Everything"; Choco = "everything" }
            @{ Name = "PowerToys"; Winget = "Microsoft.PowerToys"; Choco = "powertoys" }
            @{ Name = "Sysinternals Suite"; Winget = "Microsoft.Sysinternals"; Choco = "sysinternals" }
            @{ Name = "Process Explorer"; Winget = "Microsoft.Sysinternals.ProcessExplorer"; Choco = "procexp" }
            @{ Name = "HWiNFO"; Winget = "REALiX.HWiNFO"; Choco = "hwinfo" }
            @{ Name = "CPU-Z"; Winget = "CPUID.CPU-Z"; Choco = "cpu-z" }
            @{ Name = "GPU-Z"; Winget = "TechPowerUp.GPU-Z"; Choco = "gpu-z" }
            @{ Name = "CrystalDiskInfo"; Winget = "CrystalDewWorld.CrystalDiskInfo"; Choco = "crystaldiskinfo" }
            @{ Name = "TreeSize Free"; Winget = "JAMSoftware.TreeSizeFree"; Choco = "treesizefree" }
            @{ Name = "WizTree"; Winget = "NimbleWorks.WizTree"; Choco = "wiztree" }
            @{ Name = "Revo Uninstaller"; Winget = "RevoUninstaller.RevoUninstaller"; Choco = "revo-uninstaller" }
            @{ Name = "BleachBit"; Winget = "BleachBit.BleachBit"; Choco = "bleachbit" }
        )
    }
    
    # === MEDIA ===
    Media         = @{
        DisplayName = "Media & Graphics"
        Apps        = @(
            @{ Name = "VLC Media Player"; Winget = "VideoLAN.VLC"; Choco = "vlc" }
            @{ Name = "MPC-HC"; Winget = "clsid2.mpc-hc"; Choco = "mpc-hc" }
            @{ Name = "mpv"; Winget = "mpv.net"; Choco = "mpv" }
            @{ Name = "Spotify"; Winget = "Spotify.Spotify"; Choco = "spotify" }
            @{ Name = "foobar2000"; Winget = "PeterPawlowski.foobar2000"; Choco = "foobar2000" }
            @{ Name = "ImageGlass"; Winget = "DuongDieuPhap.ImageGlass"; Choco = "imageglass" }
            @{ Name = "IrfanView"; Winget = "IrfanSkiljan.IrfanView"; Choco = "irfanview" }
            @{ Name = "ShareX"; Winget = "ShareX.ShareX"; Choco = "sharex" }
            @{ Name = "OBS Studio"; Winget = "OBSProject.OBSStudio"; Choco = "obs-studio" }
            @{ Name = "HandBrake"; Winget = "HandBrake.HandBrake"; Choco = "handbrake" }
            @{ Name = "Audacity"; Winget = "Audacity.Audacity"; Choco = "audacity" }
            @{ Name = "GIMP"; Winget = "GIMP.GIMP"; Choco = "gimp" }
            @{ Name = "Krita"; Winget = "KDE.Krita"; Choco = "krita" }
            @{ Name = "Inkscape"; Winget = "Inkscape.Inkscape"; Choco = "inkscape" }
            @{ Name = "Blender"; Winget = "BlenderFoundation.Blender"; Choco = "blender" }
        )
    }
    
    # === COMMUNICATION ===
    Communication = @{
        DisplayName = "Communication & Social"
        Apps        = @(
            @{ Name = "Discord"; Winget = "Discord.Discord"; Choco = "discord" }
            @{ Name = "Slack"; Winget = "SlackTechnologies.Slack"; Choco = "slack" }
            @{ Name = "Microsoft Teams (Work)"; Winget = "Microsoft.Teams"; Choco = "microsoft-teams" }
            @{ Name = "Microsoft Teams (Classic)"; Winget = "Microsoft.Teams.Classic"; Choco = "microsoft-teams" }
            @{ Name = "Zoom"; Winget = "Zoom.Zoom"; Choco = "zoom" }
            @{ Name = "Telegram"; Winget = "Telegram.TelegramDesktop"; Choco = "telegram" }
            @{ Name = "Signal"; Winget = "OpenWhisperSystems.Signal"; Choco = "signal" }
            @{ Name = "WhatsApp"; Winget = "WhatsApp.WhatsApp"; Choco = "whatsapp" }
            @{ Name = "Thunderbird"; Winget = "Mozilla.Thunderbird"; Choco = "thunderbird" }
        )
    }
    
    # === SECURITY ===
    Security      = @{
        DisplayName = "Security & Privacy"
        Apps        = @(
            @{ Name = "Bitwarden"; Winget = "Bitwarden.Bitwarden"; Choco = "bitwarden" }
            @{ Name = "KeePassXC"; Winget = "KeePassXCTeam.KeePassXC"; Choco = "keepassxc" }
            @{ Name = "Malwarebytes"; Winget = "Malwarebytes.Malwarebytes"; Choco = "malwarebytes" }
            @{ Name = "ProtonVPN"; Winget = "ProtonTechnologies.ProtonVPN"; Choco = "protonvpn" }
            @{ Name = "Mullvad VPN"; Winget = "MullvadVPN.MullvadVPN"; Choco = "mullvad-vpn" }
            @{ Name = "WireGuard"; Winget = "WireGuard.WireGuard"; Choco = "wireguard" }
            @{ Name = "VeraCrypt"; Winget = "IDRIX.VeraCrypt"; Choco = "veracrypt" }
            @{ Name = "Gpg4win"; Winget = "GnuPG.Gpg4win"; Choco = "gpg4win" }
        )
    }
    
    # === DEV TOOLS ===
    DevTools      = @{
        DisplayName = "Developer Tools"
        Apps        = @(
            @{ Name = "Visual Studio Code"; Winget = "Microsoft.VisualStudioCode"; Choco = "vscode" }
            @{ Name = "Visual Studio 2022 Community"; Winget = "Microsoft.VisualStudio.2022.Community"; Choco = "visualstudio2022community" }

            @{ Name = "JetBrains Toolbox"; Winget = "JetBrains.Toolbox"; Choco = "jetbrainstoolbox" }
            @{ Name = "Sublime Text"; Winget = "SublimeHQ.SublimeText.4"; Choco = "sublimetext4" }
            @{ Name = "Notepad++"; Winget = "Notepad++.Notepad++"; Choco = "notepadplusplus" }
            @{ Name = "Git"; Winget = "Git.Git"; Choco = "git" }
            @{ Name = "GitHub Desktop"; Winget = "GitHub.GitHubDesktop"; Choco = "github-desktop" }
            @{ Name = "Windows Terminal"; Winget = "Microsoft.WindowsTerminal"; Choco = "microsoft-windows-terminal" }
            @{ Name = "PowerShell 7"; Winget = "Microsoft.PowerShell"; Choco = "powershell-core" }
            @{ Name = "Docker Desktop"; Winget = "Docker.DockerDesktop"; Choco = "docker-desktop" }
            @{ Name = "Postman"; Winget = "Postman.Postman"; Choco = "postman" }
            @{ Name = "HeidiSQL"; Winget = "HeidiSQL.HeidiSQL"; Choco = "heidisql" }
            @{ Name = "DBeaver"; Winget = "dbeaver.dbeaver"; Choco = "dbeaver" }
            @{ Name = "WinSCP"; Winget = "WinSCP.WinSCP"; Choco = "winscp" }
            @{ Name = "PuTTY"; Winget = "PuTTY.PuTTY"; Choco = "putty" }
            @{ Name = "FileZilla"; Winget = "TimKosse.FileZilla.Client"; Choco = "filezilla" }
        )
    }
    
    # === GAMING ===
    Gaming        = @{
        DisplayName = "Gaming & Game Launchers"
        Apps        = @(
            @{ Name = "Steam"; Winget = "Valve.Steam"; Choco = "steam" }
            @{ Name = "Epic Games Launcher"; Winget = "EpicGames.EpicGamesLauncher"; Choco = "epicgameslauncher" }
            @{ Name = "GOG Galaxy"; Winget = "GOG.Galaxy"; Choco = "goggalaxy" }
            @{ Name = "EA App"; Winget = "ElectronicArts.EADesktop"; Choco = "ea-app" }
            @{ Name = "Ubisoft Connect"; Winget = "Ubisoft.Connect"; Choco = "ubisoft-connect" }
            @{ Name = "Battle.net"; Winget = "Blizzard.BattleNet"; Choco = "battle.net" }
            @{ Name = "Playnite"; Winget = "Playnite.Playnite"; Choco = "playnite" }
            @{ Name = "Heroic Games Launcher"; Winget = "HeroicGamesLauncher.HeroicGamesLauncher"; Choco = "heroic" }
            @{ Name = "MSI Afterburner"; Winget = "Guru3D.Afterburner"; Choco = "msiafterburner" }
            @{ Name = "RTSS"; Winget = "Guru3D.RTSS"; Choco = "rtss" }
        )
    }
    
    # === PRODUCTIVITY ===
    Productivity  = @{
        DisplayName = "Productivity & Office"
        Apps        = @(
            @{ Name = "Microsoft Office 365 (Online)"; Winget = "Microsoft.Office"; Choco = "office365business" }
            @{ Name = "LibreOffice"; Winget = "TheDocumentFoundation.LibreOffice"; Choco = "libreoffice-fresh" }
            @{ Name = "ONLYOFFICE"; Winget = "ONLYOFFICE.DesktopEditors"; Choco = "onlyoffice" }
            @{ Name = "Notion"; Winget = "Notion.Notion"; Choco = "notion" }
            @{ Name = "Obsidian"; Winget = "Obsidian.Obsidian"; Choco = "obsidian" }
            @{ Name = "Evernote"; Winget = "Evernote.Evernote"; Choco = "evernote" }
            @{ Name = "Adobe Reader DC"; Winget = "Adobe.Acrobat.Reader.64-bit"; Choco = "adobereader" }
            @{ Name = "Foxit Reader"; Winget = "Foxit.FoxitReader"; Choco = "foxitreader" }
            @{ Name = "SumatraPDF"; Winget = "SumatraPDF.SumatraPDF"; Choco = "sumatrapdf" }
            @{ Name = "Calibre"; Winget = "calibre.calibre"; Choco = "calibre" }
        )
    }
    
    # === NETWORK ===
    Network       = @{
        DisplayName = "Network & Download Tools"
        Apps        = @(
            @{ Name = "qBittorrent"; Winget = "qBittorrent.qBittorrent"; Choco = "qbittorrent" }
            @{ Name = "Free Download Manager"; Winget = "SoftDeluxe.FreeDownloadManager"; Choco = "freedownloadmanager" }
            @{ Name = "JDownloader"; Winget = "AppWork.JDownloader"; Choco = "jdownloader" }
            @{ Name = "Wireshark"; Winget = "WiresharkFoundation.Wireshark"; Choco = "wireshark" }
            @{ Name = "Nmap"; Winget = "Insecure.Nmap"; Choco = "nmap" }
            @{ Name = "Advanced IP Scanner"; Winget = "Famatech.AdvancedIPScanner"; Choco = "advanced-ip-scanner" }
            @{ Name = "Angry IP Scanner"; Winget = "angryziber.AngryIPScanner"; Choco = "angryip" }
        )
    }
    
    # === DRIVERS ===
    Drivers       = @{
        DisplayName = "GPU Drivers & Tools"
        Apps        = @(
            @{ Name = "NVIDIA GeForce Experience"; Winget = "NVIDIA.GeForceExperience"; Choco = "geforce-experience" }
            @{ Name = "AMD Radeon Software"; Winget = "AMD.RyzenMaster"; Choco = "amd-ryzen-master" }
            @{ Name = "Intel Graphics Command Center"; Winget = "Intel.IntelDriverAndSupportAssistant"; Choco = "intel-dsa" }
            @{ Name = "DDU (Display Driver Uninstaller)"; Winget = "Wagnardsoft.DisplayDriverUninstaller"; Choco = "ddu" }
            @{ Name = "NVCleanstall"; Winget = "TechPowerUp.NVCleanstall"; Choco = "nvcleanstall" }
            @{ Name = "Snappy Driver Installer Origin"; Winget = "GlennDelahoy.SnappyDriverInstallerOrigin"; Choco = "sdio" }
        )
    }
}

<#
.SYNOPSIS
    Gets the complete list of essential apps organized by category.
    
.OUTPUTS
    [hashtable] The essentials app dictionary.
#>
function Get-WinDebloat7EssentialsList {
    [CmdletBinding()]
    [OutputType([hashtable])]
    param()
    
    return $Script:EssentialsApps
}

#endregion

#region Installation Functions

<#
.SYNOPSIS
    Installs software packages using Winget or Chocolatey.
    
.PARAMETER Packages
    Array of package IDs to install (Winget format: "Publisher.Package").
    
.PARAMETER PackageManager
    Which package manager to use. Default: Auto-detect (Winget preferred).
    
.PARAMETER Quiet
    Suppress installation prompts where possible.
    
.OUTPUTS
    [psobject] Installation results summary.
#>
function Install-WinDebloat7Software {
    [CmdletBinding(SupportsShouldProcess, ConfirmImpact = 'Medium')]
    [OutputType([psobject])]
    param(
        [Parameter(Mandatory)]
        [ValidateNotNullOrEmpty()]
        [string[]]$Packages,
        
        [ValidateSet("Winget", "Chocolatey", "Auto")]
        [string]$PackageManager = "Auto",
        
        [switch]$Quiet
    )
    
    # Auto-detect package manager
    if ($PackageManager -eq "Auto") {
        if (Test-PackageManager -Name "Winget") {
            $PackageManager = "Winget"
        }
        elseif (Test-PackageManager -Name "Chocolatey") {
            $PackageManager = "Chocolatey"
        }
        else {
            Write-Log -Message "No package manager found. Installing Winget..." -Level Warning
            if (-not (Install-PackageManager -Name "Winget" -Force)) {
                throw "Failed to install package manager"
            }
            $PackageManager = "Winget"
        }
    }
    
    Write-Log -Message "Installing $($Packages.Count) packages via $PackageManager" -Level Info
    
    $results = @{
        PackageManager = $PackageManager
        TotalRequested = $Packages.Count
        Successful     = 0
        Failed         = 0
        Skipped        = 0
        Details        = [System.Collections.Generic.List[hashtable]]::new()
    }
    
    $current = 0
    foreach ($pkg in $Packages) {
        $current++
        $percent = [math]::Round(($current / $Packages.Count) * 100)
        Write-Progress -Activity "Installing Software" -Status "[$current/$($Packages.Count)] $pkg" -PercentComplete $percent
        
        try {
            if ($PSCmdlet.ShouldProcess($pkg, "Install via $PackageManager")) {
                $output = switch ($PackageManager) {
                    "Winget" {
                        $cmdArgs = @("install", $pkg, "--accept-source-agreements", "--accept-package-agreements")
                        if ($Quiet) { $cmdArgs += "--silent" }
                        & winget @cmdArgs 2>&1
                    }
                    "Chocolatey" {
                        $cmdArgs = @("install", $pkg, "-y")
                        if ($Quiet) { $cmdArgs += "--no-progress" }
                        & choco @cmdArgs 2>&1
                    }
                }
                
                if ($LASTEXITCODE -eq 0) {
                    Write-Log -Message "Installed: $pkg" -Level Success
                    $results.Successful++
                    $results.Details.Add(@{ Package = $pkg; Status = "Success" })
                }
                elseif ($output -match "already installed|No applicable|No available upgrade") {
                    Write-Log -Message "Already installed: $pkg" -Level Info
                    $results.Skipped++
                    $results.Details.Add(@{ Package = $pkg; Status = "Skipped (Already Installed)" })
                }
                else {
                    Write-Log -Message "Failed to install: $pkg - Exit code: $LASTEXITCODE" -Level Warning
                    $results.Failed++
                    $results.Details.Add(@{ Package = $pkg; Status = "Failed"; ExitCode = $LASTEXITCODE })
                }
            }
        }
        catch {
            Write-Log -Message "Error installing $pkg`: $($_.Exception.Message)" -Level Error
            $results.Failed++
            $results.Details.Add(@{ Package = $pkg; Status = "Error"; Error = $_.Exception.Message })
        }
    }
    
    Write-Progress -Activity "Installing Software" -Completed
    
    Write-Log -Message "Installation complete: $($results.Successful) installed, $($results.Skipped) skipped, $($results.Failed) failed" -Level $(if ($results.Failed -eq 0) { "Success" } else { "Warning" })
    
    return [pscustomobject]$results
}

<#
.SYNOPSIS
    Installs essential apps by category with interactive selection.
    
.PARAMETER Categories
    Array of category names to install. If omitted, shows interactive menu.
    
.PARAMETER PackageManager
    Which package manager to use.
    
.PARAMETER InstallAll
    Install all apps from selected categories without prompting.
    
.EXAMPLE
    Install-WinDebloat7Essentials -Categories Browsers, Utilities
    
.EXAMPLE
    Install-WinDebloat7Essentials -InstallAll
#>
function Install-WinDebloat7Essentials {
    [CmdletBinding(SupportsShouldProcess)]
    [OutputType([void])]
    param(
        [ValidateSet("Browsers", "Runtimes", "Utilities", "Media", "Communication", 
            "Security", "DevTools", "Gaming", "Productivity", "Network", "Drivers")]
        [string[]]$Categories,
        
        [ValidateSet("Winget", "Chocolatey", "Auto")]
        [string]$PackageManager = "Auto",
        
        [switch]$InstallAll
    )
    
    $essentials = Get-WinDebloat7EssentialsList
    
    # Determine package manager
    if ($PackageManager -eq "Auto") {
        $PackageManager = if (Test-PackageManager -Name "Winget") { "Winget" } else { "Chocolatey" }
    }
    
    # If no categories specified, show interactive menu
    if (-not $Categories) {
        Write-Host "`n" -ForegroundColor Cyan
        Write-Host "       Essential Apps Installer            " -ForegroundColor Cyan
        Write-Host "" -ForegroundColor Cyan
        Write-Host "Using: $PackageManager`n" -ForegroundColor Gray
        
        $i = 1
        $categoryMap = @{}
        foreach ($cat in $essentials.Keys | Sort-Object) {
            $count = $essentials[$cat].Apps.Count
            Write-Host "  [$i] $($essentials[$cat].DisplayName) ($count apps)" -ForegroundColor White
            $categoryMap[$i] = $cat
            $i++
        }
        Write-Host "  [A] Install ALL Categories" -ForegroundColor Yellow
        Write-Host "  [Q] Cancel`n" -ForegroundColor Gray
        
        $selection = Read-Host "Select categories (comma-separated, e.g., 1,3,5)"
        
        if ($selection -match '^[Qq]$') { return }
        
        if ($selection -match '^[Aa]$') {
            $Categories = $essentials.Keys
        }
        else {
            $Categories = @()
            foreach ($num in ($selection -split ',')) {
                $num = $num.Trim()
                if ($categoryMap.ContainsKey([int]$num)) {
                    $Categories += $categoryMap[[int]$num]
                }
            }
        }
    }
    
    if ($Categories.Count -eq 0) {
        Write-Log -Message "No categories selected." -Level Warning
        return
    }
    
    # Collect packages from selected categories
    $packagesToInstall = [System.Collections.Generic.List[string]]::new()
    
    foreach ($cat in $Categories) {
        if (-not $essentials.ContainsKey($cat)) { continue }
        
        $catData = $essentials[$cat]
        Write-Host "`n$($catData.DisplayName):" -ForegroundColor Cyan
        
        if ($InstallAll) {
            foreach ($app in $catData.Apps) {
                $pkgId = if ($PackageManager -eq "Winget") { $app.Winget } else { $app.Choco }
                $packagesToInstall.Add($pkgId)
                Write-Host "  [+] $($app.Name)" -ForegroundColor Green
            }
        }
        else {
            # Show individual app selection
            $j = 1
            $appMap = @{}
            foreach ($app in $catData.Apps) {
                Write-Host "  [$j] $($app.Name)" -ForegroundColor White
                $appMap[$j] = $app
                $j++
            }
            Write-Host "  [A] All in category  [S] Skip category" -ForegroundColor Gray
            
            $appSel = Read-Host "Select apps (comma-separated)"
            
            if ($appSel -match '^[Ss]$') { continue }
            
            if ($appSel -match '^[Aa]$') {
                foreach ($app in $catData.Apps) {
                    $pkgId = if ($PackageManager -eq "Winget") { $app.Winget } else { $app.Choco }
                    $packagesToInstall.Add($pkgId)
                }
            }
            else {
                foreach ($num in ($appSel -split ',')) {
                    $num = $num.Trim()
                    if ($appMap.ContainsKey([int]$num)) {
                        $app = $appMap[[int]$num]
                        $pkgId = if ($PackageManager -eq "Winget") { $app.Winget } else { $app.Choco }
                        $packagesToInstall.Add($pkgId)
                    }
                }
            }
        }
    }
    
    if ($packagesToInstall.Count -eq 0) {
        Write-Log -Message "No packages selected for installation." -Level Warning
        return
    }
    
    Write-Host "`nInstalling $($packagesToInstall.Count) packages..." -ForegroundColor Cyan
    
    $result = Install-WinDebloat7Software -Packages $packagesToInstall.ToArray() -PackageManager $PackageManager -Quiet
    
    Write-Host "`n" -ForegroundColor Green
    Write-Host "         Installation Complete             " -ForegroundColor Green
    Write-Host "" -ForegroundColor Green
    Write-Host "  Installed: $($result.Successful)" -ForegroundColor Green
    Write-Host "  Skipped:   $($result.Skipped)" -ForegroundColor Yellow
    Write-Host "  Failed:    $($result.Failed)" -ForegroundColor $(if ($result.Failed -gt 0) { "Red" } else { "Gray" })
}

<#
.SYNOPSIS
    Installs packages from a profile configuration.
    
.PARAMETER Config
    The configuration object loaded from a YAML profile.
#>
function Install-WinDebloat7ProfileSoftware {
    [CmdletBinding(SupportsShouldProcess)]
    [OutputType([void])]
    param(
        [Parameter(Mandatory)]
        [psobject]$Config
    )
    
    if (-not $Config.software) {
        Write-Log -Message "No software configuration in profile." -Level Info
        return
    }
    
    $pkgMgr = $Config.software.package_manager ?? "Winget"
    $installList = $Config.software.install_list ?? @()
    
    if ($installList.Count -eq 0) {
        Write-Log -Message "No packages specified in profile install_list." -Level Info
        return
    }
    
    Write-Log -Message "Installing profile software via $pkgMgr..." -Level Info
    Install-WinDebloat7Software -Packages $installList -PackageManager $pkgMgr
}

#endregion

Export-ModuleMember -Function @(
    'Test-PackageManager',
    'Install-PackageManager',
    'Get-WinDebloat7EssentialsList',
    'Install-WinDebloat7Software',
    'Install-WinDebloat7Essentials',
    'Install-WinDebloat7ProfileSoftware'
)


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\src\modules\Windows11\Version-Detection.psm1
================================================================================

<#
.SYNOPSIS
    Version detection for Windows 11 and 25H2 support.
    
.DESCRIPTION
    Provides functions to detect specific Windows 11 versions and feature updates.
    Includes result caching to prevent repeated CIM queries (PERF-001 fix).
    
.NOTES
    Module: Win-Debloat7.Modules.Windows11.VersionDetection
    Version: 1.1.0
    
.LINK
    https://learn.microsoft.com/en-us/powershell/scripting/whats-new/what-s-new-in-powershell-75
#>

#Requires -Version 7.5

using namespace System.Management.Automation

class WindowsVersionInfo {
    [string]$ProductName
    [string]$DisplayVersion
    [int]$BuildNumber
    [string]$FriendlyName
    [bool]$IsWindows11
}

# Cache to prevent repeated CIM queries (PERF-001 fix)
$Script:CachedVersionInfo = $null
$Script:CacheTimestamp = [datetime]::MinValue
$Script:CacheLifetimeMinutes = 5

<#
.SYNOPSIS
    Gets information about the current Windows version.
    
.DESCRIPTION
    Returns a WindowsVersionInfo object containing OS details.
    Results are cached for 5 minutes to improve performance.
    
.PARAMETER Force
    Forces a fresh query, bypassing the cache.
    
.OUTPUTS
    [WindowsVersionInfo]
    
.EXAMPLE
    $ver = Get-WindowsVersionInfo
    Write-Host "Running $($ver.FriendlyName)"
#>
function Get-WindowsVersionInfo {
    [CmdletBinding()]
    [OutputType([WindowsVersionInfo])]
    param(
        [switch]$Force
    )
    
    # PERF-001 fix: Return cached result if valid
    $now = Get-Date
    if (-not $Force -and $Script:CachedVersionInfo -and 
        ($now - $Script:CacheTimestamp).TotalMinutes -lt $Script:CacheLifetimeMinutes) {
        return $Script:CachedVersionInfo
    }
    
    $os = Get-CimInstance Win32_OperatingSystem
    $build = [int]$os.BuildNumber
    
    $info = [WindowsVersionInfo]::new()
    $info.ProductName = $os.Caption
    $info.BuildNumber = $build
    $info.IsWindows11 = $build -ge 22000
    
    # Try to get DisplayVersion from registry
    try {
        $info.DisplayVersion = Get-ItemPropertyValue -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion" -Name "DisplayVersion" -ErrorAction Stop
    }
    catch {
        $info.DisplayVersion = "Unknown"
    }
    
    # Determine Friendly Name based on build number
    $info.FriendlyName = switch ($build) {
        { $_ -ge 27000 } { "25H2 (Preview)" }
        { $_ -ge 26100 } { "24H2" }
        { $_ -ge 22631 } { "23H2" }
        { $_ -ge 22621 } { "22H2" }
        { $_ -ge 22000 } { "21H2" }
        default { "Windows 10 / Older" }
    }
    
    # Update cache
    $Script:CachedVersionInfo = $info
    $Script:CacheTimestamp = $now
    
    return $info
}

<#
.SYNOPSIS
    Tests if the current Windows version meets a minimum requirement.
    
.PARAMETER MinimumVersion
    The minimum Windows 11 version to check for.
    
.OUTPUTS
    [bool] True if current version meets or exceeds minimum.
    
.EXAMPLE
    if (Test-Windows11Version -MinimumVersion "23H2") { ... }
#>
function Test-Windows11Version {
    [CmdletBinding()]
    [OutputType([bool])]
    param(
        [Parameter(Mandatory)]
        [ValidateSet("21H2", "22H2", "23H2", "24H2", "25H2")]
        [string]$MinimumVersion
    )
    
    $current = Get-WindowsVersionInfo
    if (-not $current.IsWindows11) { return $false }
    
    $minBuild = switch ($MinimumVersion) {
        "21H2" { 22000 }
        "22H2" { 22621 }
        "23H2" { 22631 }
        "24H2" { 26100 }
        "25H2" { 27000 }  # Placeholder for future
    }
    
    return $current.BuildNumber -ge $minBuild
}

<#
.SYNOPSIS
    Clears the version info cache.
#>
function Clear-WindowsVersionCache {
    [CmdletBinding()]
    [OutputType([void])]
    param()
    
    $Script:CachedVersionInfo = $null
    $Script:CacheTimestamp = [datetime]::MinValue
}

Export-ModuleMember -Function Get-WindowsVersionInfo, Test-Windows11Version, Clear-WindowsVersionCache


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\src\ui\gui\GUI.psm1
================================================================================

<#
.SYNOPSIS
    WPF GUI Controller for Win-Debloat7 (Premium Edition)
    
.DESCRIPTION
    Loads the XAML interface with sidebar navigation, binds event handlers,
    and bridges GUI actions to backend PowerShell modules.
    
.NOTES
    Module: Win-Debloat7.UI.GUI
    Version: 2.0.2 (Fixed version detection, Show Log, telemetry status)
#>

#Requires -Version 7.5
#Requires -RunAsAdministrator

# Import Backend Modules
$scriptRoot = $PSScriptRoot
Import-Module "$scriptRoot\..\..\core\Logger.psm1" -Force -ErrorAction SilentlyContinue
Import-Module "$scriptRoot\..\..\core\SystemState.psm1" -Force -ErrorAction SilentlyContinue
Import-Module "$scriptRoot\..\..\core\State.psm1" -Force -ErrorAction SilentlyContinue
Import-Module "$scriptRoot\..\..\modules\Bloatware\Bloatware.psm1" -Force -ErrorAction SilentlyContinue
Import-Module "$scriptRoot\..\..\modules\Privacy\Privacy.psm1" -Force -ErrorAction SilentlyContinue
Import-Module "$scriptRoot\..\..\modules\Performance\Performance.psm1" -Force -ErrorAction SilentlyContinue
Import-Module "$scriptRoot\..\..\modules\Performance\Gaming.psm1" -Force -ErrorAction SilentlyContinue
Import-Module "$scriptRoot\..\..\modules\Software\Software.psm1" -Force -ErrorAction SilentlyContinue
Import-Module "$scriptRoot\..\..\modules\Network\Network.psm1" -Force -ErrorAction SilentlyContinue
Import-Module "$scriptRoot\..\..\modules\Privacy\Tasks.psm1" -Force -ErrorAction SilentlyContinue
Import-Module "$scriptRoot\..\..\modules\Privacy\Hosts.psm1" -Force -ErrorAction SilentlyContinue
Import-Module "$scriptRoot\..\..\modules\Windows11\Version-Detection.psm1" -Force -ErrorAction SilentlyContinue

function Show-WinDebloat7GUI {
    [CmdletBinding()]
    param()
    
    Add-Type -AssemblyName PresentationFramework
    Add-Type -AssemblyName PresentationCore
    Add-Type -AssemblyName WindowsBase
    
    $xamlPath = Join-Path $PSScriptRoot "MainWindow.xaml"
    if (-not (Test-Path $xamlPath)) { 
        Write-Warning "MainWindow.xaml not found at $xamlPath"
        return 
    }
    
    try {
        [xml]$xaml = Get-Content $xamlPath -Raw
        $reader = (New-Object System.Xml.XmlNodeReader $xaml)
        $window = [Windows.Markup.XamlReader]::Load($reader)
        
        # Helper to get controls
        $getCtrl = { param($name) $window.FindName($name) }
        
        # Get controls
        $txtStatus = & $getCtrl "txtStatus"
        
        # 
        # SIDEBAR NAVIGATION
        # 
        $views = @{
            'navDashboard'   = 'viewDashboard'
            'navTweaks'      = 'viewTweaks'
            'navPrivacy'     = 'viewPrivacy'
            'navPerformance' = 'viewPerformance'
            'navSoftware'    = 'viewSoftware'
            'navNetwork'     = 'viewNetwork'
            'navSnapshots'   = 'viewSnapshots'
            'navSettings'    = 'viewSettings'
        }
        
        foreach ($navName in $views.Keys) {
            $nav = & $getCtrl $navName
            if ($nav) {
                # Removed unused viewName variable
                $nav.Add_Checked({
                        param($s, $e)
                        # Hide all views
                        foreach ($vn in @('viewDashboard', 'viewTweaks', 'viewPrivacy', 'viewPerformance', 'viewSoftware', 'viewNetwork', 'viewSnapshots', 'viewSettings')) {
                            $v = $window.FindName($vn)
                            if ($v) { $v.Visibility = 'Collapsed' }
                        }
                        # Show selected view
                        $targetMap = @{
                            'navDashboard' = 'viewDashboard'; 'navTweaks' = 'viewTweaks'; 'navPrivacy' = 'viewPrivacy';
                            'navPerformance' = 'viewPerformance'; 'navSoftware' = 'viewSoftware'; 'navNetwork' = 'viewNetwork';
                            'navSnapshots' = 'viewSnapshots'; 'navSettings' = 'viewSettings'
                        }
                        $targetView = $window.FindName($targetMap[$s.Name])
                        if ($targetView) { $targetView.Visibility = 'Visible' }
                    })
            }
        }
        
        # 
        # POPULATE DASHBOARD - Fixed version detection
        # 
        try {
            # OS Info - Auto-detect version
            $os = Get-CimInstance Win32_OperatingSystem
            $build = [int]$os.BuildNumber
            
            # Detect Windows version based on build number
            $verName = switch ($build) {
                { $_ -ge 26100 } { "24H2"; break }
                { $_ -ge 22631 } { "23H2"; break }
                { $_ -ge 22621 } { "22H2"; break }
                { $_ -ge 22000 } { "21H2"; break }
                { $_ -ge 19045 } { "22H2 (Win10)"; break }
                { $_ -ge 19044 } { "21H2 (Win10)"; break }
                default { "Build $build" }
            }
            
            $osName = if ($build -ge 22000) { "Windows 11" } else { "Windows 10" }
            
            (& $getCtrl "txtOSName").Text = $osName
            (& $getCtrl "txtOSVersion").Text = "$verName (Build $build)"
            
            # RAM
            $ram = [math]::Round((Get-CimInstance Win32_ComputerSystem).TotalPhysicalMemory / 1GB)
            (& $getCtrl "txtRAM").Text = $ram.ToString()
            
            # Bloatware count - count known bloatware apps
            $bloatwarePatterns = @(
                '*3DBuilder*', '*BingNews*', '*BingWeather*', '*Clipchamp*', '*Disney*',
                '*Duolingo*', '*Facebook*', '*Flipboard*', '*Spotify*', '*Twitter*',
                '*TikTok*', '*CandyCrush*', '*BubbleWitch*', '*MarchofEmpires*',
                '*Solitaire*', '*OfficeHub*', '*OneConnect*', '*People*', '*Skype*',
                '*Zune*', '*MixedReality*', '*Copilot*', '*LinkedInforWindows*'
            )
            $apps = Get-AppxPackage -AllUsers -ErrorAction SilentlyContinue
            $bloatCount = 0
            foreach ($pattern in $bloatwarePatterns) {
                $bloatCount += ($apps | Where-Object { $_.Name -like $pattern }).Count
            }
            (& $getCtrl "txtBloatwareCount").Text = $bloatCount.ToString()
            
            # Privacy score calculation
            $privacyScore = 100
            
            # Check telemetry
            $telemetryEnabled = $true
            try {
                $telemetryValue = Get-ItemPropertyValue -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\DataCollection" -Name "AllowTelemetry" -ErrorAction SilentlyContinue
                if ($telemetryValue -eq 0) { $telemetryEnabled = $false }
            }
            catch { }
            
            # Check Copilot
            $copilotEnabled = $true
            # Check Copilot (Check both User and Machine policies)
            $copilotEnabled = $true
            try {
                $cpUser = Get-ItemPropertyValue -Path "HKCU:\Software\Policies\Microsoft\Windows\WindowsCopilot" -Name "TurnOffWindowsCopilot" -ErrorAction SilentlyContinue
                $cpMachine = Get-ItemPropertyValue -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsCopilot" -Name "TurnOffWindowsCopilot" -ErrorAction SilentlyContinue
                
                # If either policy is set to 1 (Disabled), then it's disabled
                if (($cpUser -eq 1) -or ($cpMachine -eq 1)) { 
                    $copilotEnabled = $false 
                }
            }
            catch { }
            
            # Check Recall
            $recallEnabled = $true
            try {
                $recallValue = Get-ItemPropertyValue -Path "HKCU:\Software\Policies\Microsoft\Windows\WindowsAI" -Name "DisableAIDataAnalysis" -ErrorAction SilentlyContinue
                if ($recallValue -eq 1) { $recallEnabled = $false }
            }
            catch { }

            # Calculate Health Score & status
            if (-not $telemetryEnabled) { $privacyScore += 0 } else { $privacyScore -= 25 }
            if (-not $copilotEnabled) { $privacyScore += 0 } else { $privacyScore -= 15 }
            if (-not $recallEnabled) { $privacyScore += 0 } else { $privacyScore -= 10 }
            $privacyScore = [Math]::Max(0, [Math]::Min(100, $privacyScore))

            # Update score text
            (& $getCtrl "txtPrivacyScore").Text = "$privacyScore%"
            
            # Update health status text/color if it exists (assuming txtSystemStatus exists or we repurpose score label)
            # For now, we stick to updating the score prominently

            
            # Update status indicators
            (& $getCtrl "txtTelemetryStatus").Text = if ($telemetryEnabled) { "Enabled" } else { "Disabled" }
            (& $getCtrl "indicatorTelemetry").Fill = if ($telemetryEnabled) { 
                [System.Windows.Media.Brushes]::Orange 
            }
            else { 
                [System.Windows.Media.Brushes]::LimeGreen 
            }
            
            (& $getCtrl "txtCopilotStatus").Text = if ($copilotEnabled) { "Enabled" } else { "Disabled" }
            (& $getCtrl "indicatorCopilot").Fill = if ($copilotEnabled) { 
                [System.Windows.Media.Brushes]::Orange 
            }
            else { 
                [System.Windows.Media.Brushes]::LimeGreen 
            }
            
            (& $getCtrl "txtRecallStatus").Text = if ($recallEnabled) { "Enabled" } else { "Disabled" }
            (& $getCtrl "indicatorRecall").Fill = if ($recallEnabled) { 
                [System.Windows.Media.Brushes]::Orange 
            }
            else { 
                [System.Windows.Media.Brushes]::LimeGreen 
            }
            
        }
        catch {
            # Ignore dashboard population errors
        }
        
        # Helper to force UI update (fixes freezing feeling)
        $updateGui = {
            [System.Windows.Threading.DispatcherFrame]$frame = [System.Windows.Threading.DispatcherFrame]::new()
            [System.Windows.Threading.Dispatcher]::CurrentDispatcher.BeginInvoke(
                [System.Windows.Threading.DispatcherPriority]::Background,
                [Action[System.Windows.Threading.DispatcherFrame]] { param($f) $f.Continue = $false },
                $frame
            ) | Out-Null
            [System.Windows.Threading.Dispatcher]::PushFrame($frame)
        }
        
        # 
        # DASHBOARD BUTTONS
        # 
        (& $getCtrl "btnQuickOptimize").Add_Click({
                $txtStatus.Text = "Creating Safety Snapshot..."
                & $updateGui
                try {
                    # 1. Safety Snapshot
                    New-WinDebloat7Snapshot -Name "Auto-QuickOptimize" -Description "Created before Quick Optimize"
                    
                    # 2. Apply Profile
                    $txtStatus.Text = "Applying Optimization Profile..."
                    & $updateGui
                    
                    $profilePath = Join-Path $scriptRoot "..\..\..\profiles\moderate.yaml"
                    if (Test-Path $profilePath) {
                        $config = Import-WinDebloat7Config -Path $profilePath -SkipDependencyCheck
                        Remove-WinDebloat7Bloatware -Config $config -Confirm:$false
                        Set-WinDebloat7Privacy -Config $config -Confirm:$false
                        Set-WinDebloat7Performance -Config $config -Confirm:$false
                    }
                    $txtStatus.Text = "Quick Optimization Complete!"
                }
                catch {
                    $txtStatus.Text = "Error: $($_.Exception.Message)"
                }
            })
        
        (& $getCtrl "btnRemoveBloatware").Add_Click({
                $txtStatus.Text = "Removing Bloatware..."
                & $updateGui
                try {
                    $config = [pscustomobject]@{ bloatware = @{ removal_mode = "Moderate" } }
                    Remove-WinDebloat7Bloatware -Config $config -Confirm:$false
                    $txtStatus.Text = "Bloatware Removed!"
                }
                catch {
                    $txtStatus.Text = "Error: $($_.Exception.Message)"
                }
            })
        
        (& $getCtrl "btnInstallEssentials").Add_Click({
                (& $getCtrl "navSoftware").IsChecked = $true
            })
        
        # 
        # TWEAKS BUTTONS
        # 
        (& $getCtrl "btnApplyTweaks").Add_Click({
                $txtStatus.Text = "Applying Tweaks..."
                & $updateGui
                try {
                    $config = [pscustomobject]@{
                        privacy     = [pscustomobject]@{
                            telemetry_level           = "Security"
                            disable_activity_history  = $true
                            disable_location_tracking = $true
                            disable_copilot           = $true
                            disable_recall            = $true
                            disable_advertising_id    = $true
                        }
                        performance = [pscustomobject]@{
                            power_plan              = "HighPerformance"
                            disable_background_apps = $true
                        }
                    }
                    Set-WinDebloat7Privacy -Config $config -Confirm:$false
                    Set-WinDebloat7Performance -Config $config -Confirm:$false
                    $txtStatus.Text = "Tweaks Applied!"
                }
                catch {
                    $txtStatus.Text = "Error: $($_.Exception.Message)"
                }
            })
        
        # 
        # PRIVACY BUTTONS
        # 
        (& $getCtrl "btnBlockTelemetry").Add_Click({
                $txtStatus.Text = "Blocking Telemetry..."
                & $updateGui
                try {
                    Add-WinDebloat7HostsBlock -Confirm:$false
                    $txtStatus.Text = "Telemetry Blocked!"
                }
                catch {
                    $txtStatus.Text = "Error: $($_.Exception.Message)"
                }
            })
        
        (& $getCtrl "btnDisableTasks").Add_Click({
                $txtStatus.Text = "Disabling Tasks (Safe)..."
                & $updateGui
                try {
                    Disable-WinDebloat7TelemetryTasks -Mode Safe -Confirm:$false
                    $txtStatus.Text = "Safe Tasks Disabled!"
                }
                catch {
                    $txtStatus.Text = "Error: $($_.Exception.Message)"
                }
            })
        
        (& $getCtrl "btnAggressiveTasks").Add_Click({
                $txtStatus.Text = "Disabling Tasks (Aggressive)..."
                & $updateGui
                try {
                    Disable-WinDebloat7TelemetryTasks -Mode Aggressive -Confirm:$false
                    $txtStatus.Text = "Aggressive Tasks Disabled!"
                }
                catch {
                    $txtStatus.Text = "Error: $($_.Exception.Message)"
                }
            })
        
        # 
        # SOFTWARE TAB
        # 
        try {
            $icSoftware = & $getCtrl "icSoftwareCategories"
            $essentials = Get-WinDebloat7EssentialsList
            $categoriesList = [System.Collections.ArrayList]@()
            
            foreach ($catKey in $essentials.Keys) {
                $appsList = [System.Collections.ArrayList]@()
                foreach ($appDef in $essentials[$catKey].Apps) {
                    $appsList.Add([pscustomobject]@{
                            Name       = $appDef.Name
                            PackageId  = $appDef.Winget
                            IsSelected = $false 
                        }) | Out-Null
                }
                $categoriesList.Add([pscustomobject]@{
                        CategoryName = $essentials[$catKey].DisplayName
                        Apps         = $appsList 
                    }) | Out-Null
            }
            $icSoftware.ItemsSource = $categoriesList
        }
        catch {
            # Software list failed to load
        }
        
        (& $getCtrl "btnInstallSoftware").Add_Click({
                $icSoftware = $window.FindName("icSoftwareCategories")
                $selectedApps = [System.Collections.Generic.List[string]]::new()
                foreach ($cat in $icSoftware.ItemsSource) {
                    foreach ($app in $cat.Apps) {
                        if ($app.IsSelected) { $selectedApps.Add($app.PackageId) }
                    }
                }
            
                if ($selectedApps.Count -eq 0) {
                    $txtStatus.Text = "No apps selected."
                    return
                }
            
                $txtStatus.Text = "Installing $($selectedApps.Count) apps..."
                & $updateGui
                try {
                    Install-WinDebloat7Software -Packages $selectedApps.ToArray() -Quiet
                    $txtStatus.Text = "Installation Complete!"
                }
                catch {
                    $txtStatus.Text = "Error: $($_.Exception.Message)"
                }
            })
        
        # 
        # NETWORK TAB
        # 
        (& $getCtrl "btnApplyDNS").Add_Click({
                $cmbDns = $window.FindName("cmbDnsProvider")
                $provider = switch ($cmbDns.SelectedIndex) {
                    0 { "Reset" }
                    1 { "Cloudflare" }
                    2 { "Google" }
                    3 { "Quad9" }
                    4 { "AdGuard" }
                    5 { "OpenDNS" }
                    default { "Reset" }
                }
            
                $txtStatus.Text = "Applying DNS: $provider..."
                & $updateGui
                try {
                    Set-WinDebloat7DNS -Provider $provider
                
                    $chkIPv6 = $window.FindName("chkDisableIPv6")
                    if ($chkIPv6.IsChecked) {
                        Disable-WinDebloat7IPv6 -Confirm:$false
                    }
                    $txtStatus.Text = "DNS Settings Applied!"
                }
                catch {
                    $txtStatus.Text = "Error: $($_.Exception.Message)"
                }
            })
        
        # 
        # SNAPSHOTS TAB
        # 
        (& $getCtrl "btnCreateSnapshot").Add_Click({
                $txtStatus.Text = "Creating Snapshot..."
                & $updateGui
                try {
                    New-WinDebloat7Snapshot -Name "GUI-Snapshot" -Description "Created via GUI"
                    $txtStatus.Text = "Snapshot Created!"
                
                    # Refresh list
                    $lstSnapshots = $window.FindName("lstSnapshots")
                    $snaps = Get-WinDebloat7Snapshot
                    $lstSnapshots.Items.Clear()
                    foreach ($snap in $snaps) {
                        $lstSnapshots.Items.Add("$($snap.Timestamp) - $($snap.Name)")
                    }
                }
                catch {
                    $txtStatus.Text = "Error: $($_.Exception.Message)"
                }
            })
        
        # 
        # SETTINGS TAB - Fixed Show Log
        # 
        (& $getCtrl "btnViewLogs").Add_Click({
                $logPath = "$env:ProgramData\Win-Debloat7\Logs"
            
                # Create logs directory if it doesn't exist
                if (-not (Test-Path $logPath)) {
                    New-Item -Path $logPath -ItemType Directory -Force | Out-Null
                    $txtStatus.Text = "Log directory created: $logPath"
                }
            
                # Try to open the folder
                try {
                    Start-Process "explorer.exe" -ArgumentList $logPath
                    $txtStatus.Text = "Opened log folder"
                }
                catch {
                    $txtStatus.Text = "Error opening logs: $($_.Exception.Message)"
                }
            })
        
        (& $getCtrl "btnCheckUpdates").Add_Click({
                $txtStatus.Text = "Checking for updates..."
                try {
                    Start-Process "https://github.com/tomytate/Win-Debloat7/releases"
                    $txtStatus.Text = "Opened releases page"
                }
                catch {
                    $txtStatus.Text = "Error: $($_.Exception.Message)"
                }
            })
        
        # Show window
        $window.ShowDialog() | Out-Null
    }
    catch {
        Write-Warning "Failed to load GUI: $($_.Exception.Message)"
        throw
    }
}

Export-ModuleMember -Function Show-WinDebloat7GUI


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\src\ui\gui\MainWindow.xaml
================================================================================

<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Win-Debloat7 | Ultimate System Optimizer" Height="850" Width="1400"
        WindowStartupLocation="CenterScreen" ResizeMode="CanResize"
        Background="#0D0D0D" Foreground="White" FontFamily="Segoe UI"
        MinHeight="700" MinWidth="1100">

    <Window.Resources>
        <!-- COLORS -->
        <SolidColorBrush x:Key="BackgroundBrush" Color="#0D0D0D"/>
        <SolidColorBrush x:Key="SurfaceBrush" Color="#1A1A2E"/>
        <SolidColorBrush x:Key="CardBrush" Color="#16213E"/>
        <SolidColorBrush x:Key="BorderBrush" Color="#2D3A5F"/>
        <SolidColorBrush x:Key="AccentBrush" Color="#00D4FF"/>
        <SolidColorBrush x:Key="SecondaryBrush" Color="#7B2CBF"/>
        <SolidColorBrush x:Key="SuccessBrush" Color="#00FF88"/>
        <SolidColorBrush x:Key="WarningBrush" Color="#FFB800"/>
        <SolidColorBrush x:Key="ErrorBrush" Color="#FF3366"/>
        <SolidColorBrush x:Key="TextPrimaryBrush" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="TextSecondaryBrush" Color="#A0A0B0"/>

        <!-- STYLES -->
        <Style x:Key="NavButtonStyle" TargetType="RadioButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
            <Setter Property="Padding" Value="16,12"/>
            <Setter Property="Margin" Value="0,2"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                CornerRadius="8">
                            <ContentPresenter HorizontalAlignment="Left" VerticalAlignment="Center" Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="Background" Value="#252535"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter Property="Foreground" Value="{StaticResource AccentBrush}"/>
                                <Setter Property="Background" Value="#1A2A45"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="260"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- SIDEBAR -->
        <Border Grid.Column="0" Background="{StaticResource SurfaceBrush}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Logo -->
                <StackPanel Grid.Row="0" Margin="24,24,24,30">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="" FontSize="28" Foreground="{StaticResource AccentBrush}" VerticalAlignment="Center"/>
                        <StackPanel Margin="12,0,0,0">
                            <TextBlock Text="Win-Debloat7" FontSize="20" FontWeight="Bold" Foreground="White"/>
                            <TextBlock Text="Ultimate System Optimizer" FontSize="11" 
                                       Foreground="{StaticResource TextSecondaryBrush}"/>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>

                <!-- Navigation -->
                <StackPanel Grid.Row="1" Margin="8,0,8,20">
                    <TextBlock Text="MAIN MENU" FontSize="11" FontWeight="SemiBold" 
                               Foreground="{StaticResource TextSecondaryBrush}" Margin="16,0,0,10"/>
                    
                    <RadioButton x:Name="navDashboard" IsChecked="True" GroupName="nav" Style="{StaticResource NavButtonStyle}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="" FontSize="16" Margin="0,0,12,0" VerticalAlignment="Center"/>
                            <TextBlock Text="Dashboard" VerticalAlignment="Center"/>
                        </StackPanel>
                    </RadioButton>
                    <RadioButton x:Name="navTweaks" GroupName="nav" Style="{StaticResource NavButtonStyle}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="" FontSize="16" Margin="0,0,12,0" VerticalAlignment="Center"/>
                            <TextBlock Text="System Tweaks" VerticalAlignment="Center"/>
                        </StackPanel>
                    </RadioButton>
                    <RadioButton x:Name="navPrivacy" GroupName="nav" Style="{StaticResource NavButtonStyle}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="" FontSize="16" Margin="0,0,12,0" VerticalAlignment="Center"/>
                            <TextBlock Text="Privacy" VerticalAlignment="Center"/>
                        </StackPanel>
                    </RadioButton>
                    <RadioButton x:Name="navPerformance" GroupName="nav" Style="{StaticResource NavButtonStyle}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="" FontSize="16" Margin="0,0,12,0" VerticalAlignment="Center"/>
                            <TextBlock Text="Performance" VerticalAlignment="Center"/>
                        </StackPanel>
                    </RadioButton>
                    <RadioButton x:Name="navSoftware" GroupName="nav" Style="{StaticResource NavButtonStyle}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="" FontSize="16" Margin="0,0,12,0" VerticalAlignment="Center"/>
                            <TextBlock Text="Software" VerticalAlignment="Center"/>
                        </StackPanel>
                    </RadioButton>
                    <RadioButton x:Name="navNetwork" GroupName="nav" Style="{StaticResource NavButtonStyle}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="" FontSize="16" Margin="0,0,12,0" VerticalAlignment="Center"/>
                            <TextBlock Text="Network" VerticalAlignment="Center"/>
                        </StackPanel>
                    </RadioButton>
                    
                    <TextBlock Text="SYSTEM" FontSize="11" FontWeight="SemiBold" 
                               Foreground="{StaticResource TextSecondaryBrush}" Margin="16,20,0,10"/>
                    
                    <RadioButton x:Name="navSnapshots" GroupName="nav" Style="{StaticResource NavButtonStyle}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="" FontSize="16" Margin="0,0,12,0" VerticalAlignment="Center"/>
                            <TextBlock Text="Backups" VerticalAlignment="Center"/>
                        </StackPanel>
                    </RadioButton>
                    <RadioButton x:Name="navSettings" GroupName="nav" Style="{StaticResource NavButtonStyle}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="" FontSize="16" Margin="0,0,12,0" VerticalAlignment="Center"/>
                            <TextBlock Text="Settings" VerticalAlignment="Center"/>
                        </StackPanel>
                    </RadioButton>
                </StackPanel>

                <!-- Footer -->
                <Border Grid.Row="2" Background="#151525" Padding="16" CornerRadius="12" Margin="12,0,12,16">
                    <StackPanel>
                        <TextBlock Text="v1.1.0 | PowerShell 7.5+" FontSize="11" 
                                   Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Center"/>
                        <TextBlock Text="Windows 11 25H2 Ready" FontSize="10" 
                                   Foreground="{StaticResource SuccessBrush}" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- MAIN CONTENT -->
        <Grid Grid.Column="1" Background="{StaticResource BackgroundBrush}">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto" Padding="24">
                <Grid x:Name="contentArea">
                    
                    <!-- DASHBOARD -->
                    <StackPanel x:Name="viewDashboard">
                        <TextBlock Text="Dashboard" FontSize="28" FontWeight="Bold" Foreground="White" Margin="0,0,0,8"/>
                        <TextBlock Text="System overview and quick actions" FontSize="14" 
                                   Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,24"/>

                        <!-- Stats Row -->
                        <UniformGrid Rows="1" Columns="4" Margin="0,0,0,24">
                            <!-- OS Card -->
                            <Border Background="{StaticResource CardBrush}" CornerRadius="16" Padding="20" Margin="0,0,8,0">
                                <StackPanel>
                                    <TextBlock Text="" FontSize="24" Margin="0,0,0,12"/>
                                    <TextBlock Name="txtOSName" Text="Windows 11" FontSize="16" FontWeight="SemiBold" Foreground="White"/>
                                    <TextBlock Name="txtOSVersion" Text="Detecting..." FontSize="12" Foreground="{StaticResource TextSecondaryBrush}"/>
                                </StackPanel>
                            </Border>
                            <!-- Privacy Score -->
                            <Border Background="{StaticResource CardBrush}" CornerRadius="16" Padding="20" Margin="4,0">
                                <StackPanel>
                                    <TextBlock Text="" FontSize="24" Margin="0,0,0,12"/>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Name="txtPrivacyScore" Text="--" FontSize="28" FontWeight="Bold" 
                                                   Foreground="{StaticResource SuccessBrush}"/>
                                        <TextBlock Text="/100" FontSize="14" Foreground="{StaticResource TextSecondaryBrush}" 
                                                   VerticalAlignment="Bottom" Margin="2,0,0,4"/>
                                    </StackPanel>
                                    <TextBlock Text="Privacy Score" FontSize="12" Foreground="{StaticResource TextSecondaryBrush}"/>
                                </StackPanel>
                            </Border>
                            <!-- Bloatware -->
                            <Border Background="{StaticResource CardBrush}" CornerRadius="16" Padding="20" Margin="4,0">
                                <StackPanel>
                                    <TextBlock Text="" FontSize="24" Margin="0,0,0,12"/>
                                    <TextBlock Name="txtBloatwareCount" Text="--" FontSize="28" FontWeight="Bold" Foreground="White"/>
                                    <TextBlock Text="Bloatware Detected" FontSize="12" Foreground="{StaticResource TextSecondaryBrush}"/>
                                </StackPanel>
                            </Border>
                            <!-- RAM -->
                            <Border Background="{StaticResource CardBrush}" CornerRadius="16" Padding="20" Margin="8,0,0,0">
                                <StackPanel>
                                    <TextBlock Text="" FontSize="24" Margin="0,0,0,12"/>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Name="txtRAM" Text="--" FontSize="28" FontWeight="Bold" Foreground="White"/>
                                        <TextBlock Text=" GB" FontSize="14" Foreground="{StaticResource TextSecondaryBrush}" 
                                                   VerticalAlignment="Bottom" Margin="0,0,0,4"/>
                                    </StackPanel>
                                    <TextBlock Text="System RAM" FontSize="12" Foreground="{StaticResource TextSecondaryBrush}"/>
                                </StackPanel>
                            </Border>
                        </UniformGrid>

                        <!-- Quick Actions -->
                        <TextBlock Text="Quick Actions" FontSize="18" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,16"/>
                        <UniformGrid Rows="1" Columns="3" Margin="0,0,0,24">
                            <Border Background="{StaticResource CardBrush}" CornerRadius="16" Padding="24" Margin="0,0,8,0">
                                <StackPanel>
                                    <TextBlock Text="" FontSize="32" Foreground="{StaticResource AccentBrush}" Margin="0,0,0,16"/>
                                    <TextBlock Text="Quick Optimize" FontSize="16" FontWeight="SemiBold" Foreground="White"/>
                                    <TextBlock Text="Apply recommended tweaks" FontSize="12" 
                                               Foreground="{StaticResource TextSecondaryBrush}" Margin="0,8,0,16"/>
                                    <Button Name="btnQuickOptimize" Content="Run Now" Background="{StaticResource AccentBrush}" 
                                            Foreground="#0D0D0D" FontWeight="SemiBold" Padding="20,10" BorderThickness="0"/>
                                </StackPanel>
                            </Border>
                            <Border Background="{StaticResource CardBrush}" CornerRadius="16" Padding="24" Margin="4,0">
                                <StackPanel>
                                    <TextBlock Text="" FontSize="32" Foreground="{StaticResource SecondaryBrush}" Margin="0,0,0,16"/>
                                    <TextBlock Text="Remove Bloatware" FontSize="16" FontWeight="SemiBold" Foreground="White"/>
                                    <TextBlock Text="Uninstall unwanted apps" FontSize="12" 
                                               Foreground="{StaticResource TextSecondaryBrush}" Margin="0,8,0,16"/>
                                    <Button Name="btnRemoveBloatware" Content="Clean Now" Background="Transparent" 
                                            Foreground="{StaticResource AccentBrush}" BorderBrush="{StaticResource AccentBrush}"
                                            FontWeight="SemiBold" Padding="20,10" BorderThickness="2"/>
                                </StackPanel>
                            </Border>
                            <Border Background="{StaticResource CardBrush}" CornerRadius="16" Padding="24" Margin="8,0,0,0">
                                <StackPanel>
                                    <TextBlock Text="" FontSize="32" Foreground="{StaticResource SuccessBrush}" Margin="0,0,0,16"/>
                                    <TextBlock Text="Install Apps" FontSize="16" FontWeight="SemiBold" Foreground="White"/>
                                    <TextBlock Text="Get essential software" FontSize="12" 
                                               Foreground="{StaticResource TextSecondaryBrush}" Margin="0,8,0,16"/>
                                    <Button Name="btnInstallEssentials" Content="Browse" Background="Transparent" 
                                            Foreground="{StaticResource AccentBrush}" BorderBrush="{StaticResource AccentBrush}"
                                            FontWeight="SemiBold" Padding="20,10" BorderThickness="2"/>
                                </StackPanel>
                            </Border>
                        </UniformGrid>

                        <!-- Status -->
                        <TextBlock Text="System Status" FontSize="18" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,16"/>
                        <Border Background="{StaticResource CardBrush}" CornerRadius="16" Padding="24">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Telemetry" FontSize="14" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,8"/>
                                    <StackPanel Orientation="Horizontal">
                                        <Ellipse Name="indicatorTelemetry" Width="10" Height="10" Fill="{StaticResource WarningBrush}" Margin="0,0,8,0"/>
                                        <TextBlock Name="txtTelemetryStatus" Text="Checking..." FontSize="13" 
                                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                                    </StackPanel>
                                </StackPanel>
                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="Windows Copilot" FontSize="14" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,8"/>
                                    <StackPanel Orientation="Horizontal">
                                        <Ellipse Name="indicatorCopilot" Width="10" Height="10" Fill="{StaticResource SuccessBrush}" Margin="0,0,8,0"/>
                                        <TextBlock Name="txtCopilotStatus" Text="Checking..." FontSize="13" 
                                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                                    </StackPanel>
                                </StackPanel>
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Windows Recall" FontSize="14" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,8"/>
                                    <StackPanel Orientation="Horizontal">
                                        <Ellipse Name="indicatorRecall" Width="10" Height="10" Fill="{StaticResource SuccessBrush}" Margin="0,0,8,0"/>
                                        <TextBlock Name="txtRecallStatus" Text="Checking..." FontSize="13" 
                                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </StackPanel>

                    <!-- TWEAKS VIEW -->
                    <StackPanel x:Name="viewTweaks" Visibility="Collapsed">
                        <TextBlock Text="System Tweaks" FontSize="28" FontWeight="Bold" Foreground="White" Margin="0,0,0,8"/>
                        <TextBlock Text="Customize Windows behavior" FontSize="14" 
                                   Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,24"/>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <Border Grid.Column="0" Background="{StaticResource CardBrush}" CornerRadius="16" Padding="24" Margin="0,0,8,0">
                                <StackPanel>
                                    <TextBlock Text="System Features" FontSize="16" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,16"/>
                                    <CheckBox Name="chkDarkTheme" Content=" Dark Theme" Foreground="White" Margin="0,8"/>
                                    <CheckBox Name="chkActivityHistory" Content=" Activity History" Foreground="White" Margin="0,8"/>
                                    <CheckBox Name="chkBackgroundApps" Content=" Background Apps" Foreground="White" Margin="0,8"/>
                                    <CheckBox Name="chkClipboardHistory" Content=" Clipboard History" Foreground="White" Margin="0,8"/>
                                    <CheckBox Name="chkHibernate" Content=" Hibernate Mode" Foreground="White" Margin="0,8"/>
                                    <CheckBox Name="chkLocation" Content=" Location Tracking" Foreground="White" Margin="0,8"/>
                                </StackPanel>
                            </Border>
                            
                            <Border Grid.Column="1" Background="{StaticResource CardBrush}" CornerRadius="16" Padding="24" Margin="8,0,0,0">
                                <StackPanel>
                                    <TextBlock Text="AI &amp; Privacy" FontSize="16" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,16"/>
                                    <CheckBox Name="chkTelemetry" Content=" Telemetry Collection" Foreground="White" Margin="0,8"/>
                                    <CheckBox Name="chkCopilot" Content=" Windows Copilot" Foreground="White" Margin="0,8"/>
                                    <CheckBox Name="chkRecall" Content=" Windows Recall (AI)" Foreground="White" Margin="0,8"/>
                                    <CheckBox Name="chkWindowsUpdate" Content=" Automatic Updates" Foreground="White" Margin="0,8"/>
                                    
                                    <Border Height="1" Background="{StaticResource BorderBrush}" Margin="0,16"/>
                                    
                                    <Button Name="btnApplyTweaks" Content="Apply Tweaks" Background="{StaticResource AccentBrush}" 
                                            Foreground="#0D0D0D" FontWeight="SemiBold" Padding="20,12" BorderThickness="0" Margin="0,8"/>
                                    <Button Name="btnUndoTweaks" Content="Restore Defaults" Background="Transparent" 
                                            Foreground="{StaticResource ErrorBrush}" BorderBrush="{StaticResource ErrorBrush}"
                                            FontWeight="SemiBold" Padding="20,12" BorderThickness="2" Margin="0,8"/>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </StackPanel>

                    <!-- PRIVACY VIEW -->
                    <StackPanel x:Name="viewPrivacy" Visibility="Collapsed">
                        <TextBlock Text="Privacy &amp; Security" FontSize="28" FontWeight="Bold" Foreground="White" Margin="0,0,0,8"/>
                        <TextBlock Text="Take control of your data" FontSize="14" 
                                   Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,24"/>
                        
                        <Border Background="{StaticResource CardBrush}" CornerRadius="16" Padding="24">
                            <StackPanel>
                                <TextBlock Text="Telemetry Controls" FontSize="16" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,16"/>
                                <Button Name="btnBlockTelemetry" Content=" Block Telemetry Domains" Background="{StaticResource AccentBrush}" 
                                        Foreground="#0D0D0D" FontWeight="SemiBold" Padding="20,12" BorderThickness="0" 
                                        HorizontalAlignment="Left" Margin="0,8"/>
                                <Button Name="btnDisableTasks" Content=" Disable Tasks (Safe)" Background="Transparent" 
                                        Foreground="{StaticResource AccentBrush}" BorderBrush="{StaticResource AccentBrush}"
                                        FontWeight="SemiBold" Padding="20,12" BorderThickness="2" HorizontalAlignment="Left" Margin="0,8"/>
                                <Button Name="btnAggressiveTasks" Content=" Disable Tasks (Aggressive)" Background="Transparent" 
                                        Foreground="{StaticResource ErrorBrush}" BorderBrush="{StaticResource ErrorBrush}"
                                        FontWeight="SemiBold" Padding="20,12" BorderThickness="2" HorizontalAlignment="Left" Margin="0,8"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- PERFORMANCE VIEW -->
                    <StackPanel x:Name="viewPerformance" Visibility="Collapsed">
                        <TextBlock Text="Performance" FontSize="28" FontWeight="Bold" Foreground="White" Margin="0,0,0,8"/>
                        <TextBlock Text="Optimize for maximum performance" FontSize="14" 
                                   Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,24"/>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <Border Grid.Column="0" Background="{StaticResource CardBrush}" CornerRadius="16" Padding="24" Margin="0,0,8,0">
                                <StackPanel>
                                    <TextBlock Text="Power Plan" FontSize="16" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,16"/>
                                    <RadioButton Name="radBalanced" Content=" Balanced" GroupName="power" IsChecked="True" 
                                                 Foreground="White" Margin="0,8"/>
                                    <RadioButton Name="radHighPerf" Content=" High Performance" GroupName="power" 
                                                 Foreground="White" Margin="0,8"/>
                                    <RadioButton Name="radUltimate" Content=" Ultimate Performance" GroupName="power" 
                                                 Foreground="{StaticResource AccentBrush}" FontWeight="SemiBold" Margin="0,8"/>
                                </StackPanel>
                            </Border>
                            
                            <Border Grid.Column="1" Background="{StaticResource CardBrush}" CornerRadius="16" Padding="24" Margin="8,0,0,0">
                                <StackPanel>
                                    <TextBlock Text="Gaming Optimizations" FontSize="16" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,16"/>
                                    <CheckBox Name="chkGamingNetwork" Content=" Network (TCPNoDelay)" Foreground="White" Margin="0,8"/>
                                    <CheckBox Name="chkGamingInput" Content=" Raw Input (No Accel)" Foreground="White" Margin="0,8"/>
                                    <CheckBox Name="chkGamingMMCSS" Content=" System Priority (MMCSS)" Foreground="White" Margin="0,8"/>
                                    <CheckBox Name="chkUltimatePlan" Content=" Ultimate Power Plan" Foreground="White" Margin="0,8"/>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </StackPanel>

                    <!-- SOFTWARE VIEW -->
                    <StackPanel x:Name="viewSoftware" Visibility="Collapsed">
                        <TextBlock Text="Software Install" FontSize="28" FontWeight="Bold" Foreground="White" Margin="0,0,0,8"/>
                        <TextBlock Text="Install apps via Winget" FontSize="14" 
                                   Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,24"/>
                        
                        <Border Background="{StaticResource CardBrush}" CornerRadius="16" Padding="24">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                    <Button Name="btnSelectAllApps" Content="Select All" Background="Transparent" 
                                            Foreground="{StaticResource AccentBrush}" BorderBrush="{StaticResource AccentBrush}"
                                            Padding="16,8" BorderThickness="2"/>
                                    <Button Name="btnDeselectAllApps" Content="Deselect All" Background="Transparent" 
                                            Foreground="{StaticResource AccentBrush}" BorderBrush="{StaticResource AccentBrush}"
                                            Padding="16,8" BorderThickness="2" Margin="8,0,0,0"/>
                                </StackPanel>
                                
                                <ItemsControl Name="icSoftwareCategories">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#1A1A2E" CornerRadius="12" Padding="16" Margin="0,8">
                                                <StackPanel>
                                                    <TextBlock Text="{Binding CategoryName}" FontSize="15" FontWeight="SemiBold" 
                                                               Foreground="{StaticResource AccentBrush}" Margin="0,0,0,12"/>
                                                    <ItemsControl ItemsSource="{Binding Apps}">
                                                        <ItemsControl.ItemsPanel>
                                                            <ItemsPanelTemplate>
                                                                <WrapPanel/>
                                                            </ItemsPanelTemplate>
                                                        </ItemsControl.ItemsPanel>
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <CheckBox Content="{Binding Name}" Tag="{Binding PackageId}" 
                                                                          IsChecked="{Binding IsSelected}" Width="200" Margin="0,4"
                                                                          Foreground="White"/>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>
                                                </StackPanel>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                                
                                <Button Name="btnInstallSoftware" Content=" Install Selected" Background="{StaticResource AccentBrush}" 
                                        Foreground="#0D0D0D" FontWeight="SemiBold" Padding="24,14" BorderThickness="0" Margin="0,16,0,0"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- NETWORK VIEW -->
                    <StackPanel x:Name="viewNetwork" Visibility="Collapsed">
                        <TextBlock Text="Network" FontSize="28" FontWeight="Bold" Foreground="White" Margin="0,0,0,8"/>
                        <TextBlock Text="Configure DNS and network" FontSize="14" 
                                   Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,24"/>
                        
                        <Border Background="{StaticResource CardBrush}" CornerRadius="16" Padding="24">
                            <StackPanel>
                                <TextBlock Text="DNS Provider" FontSize="16" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,12"/>
                                <ComboBox Name="cmbDnsProvider" Width="300" HorizontalAlignment="Left" Margin="0,0,0,16">
                                    <ComboBoxItem Content="DHCP (Default)" IsSelected="True"/>
                                    <ComboBoxItem Content="Cloudflare (1.1.1.1)"/>
                                    <ComboBoxItem Content="Google (8.8.8.8)"/>
                                    <ComboBoxItem Content="Quad9 (9.9.9.9)"/>
                                    <ComboBoxItem Content="AdGuard"/>
                                    <ComboBoxItem Content="OpenDNS"/>
                                </ComboBox>
                                
                                <CheckBox Name="chkDisableIPv6" Content=" Disable IPv6" Foreground="White" Margin="0,8"/>
                                
                                <Button Name="btnApplyDNS" Content=" Apply DNS" Background="{StaticResource AccentBrush}" 
                                        Foreground="#0D0D0D" FontWeight="SemiBold" Padding="20,12" BorderThickness="0" 
                                        HorizontalAlignment="Left" Margin="0,16,0,0"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- SNAPSHOTS VIEW -->
                    <StackPanel x:Name="viewSnapshots" Visibility="Collapsed">
                        <TextBlock Text="Backup &amp; Restore" FontSize="28" FontWeight="Bold" Foreground="White" Margin="0,0,0,8"/>
                        <TextBlock Text="Manage system snapshots" FontSize="14" 
                                   Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,24"/>
                        
                        <Border Background="{StaticResource CardBrush}" CornerRadius="16" Padding="24">
                            <StackPanel>
                                <Button Name="btnCreateSnapshot" Content=" Create Snapshot" Background="{StaticResource AccentBrush}" 
                                        Foreground="#0D0D0D" FontWeight="SemiBold" Padding="20,12" BorderThickness="0" 
                                        HorizontalAlignment="Left" Margin="0,0,0,16"/>
                                
                                <TextBlock Text="Available Snapshots" FontSize="16" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,12"/>
                                <ListBox Name="lstSnapshots" Background="#1A1A2E" BorderThickness="0" 
                                         Foreground="White" MinHeight="100" Padding="8"/>
                                
                                <Button Name="btnRestoreSnapshot" Content=" Restore Selected" Background="Transparent" 
                                        Foreground="{StaticResource ErrorBrush}" BorderBrush="{StaticResource ErrorBrush}"
                                        FontWeight="SemiBold" Padding="20,12" BorderThickness="2" 
                                        HorizontalAlignment="Left" Margin="0,16,0,0"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- SETTINGS VIEW -->
                    <StackPanel x:Name="viewSettings" Visibility="Collapsed">
                        <TextBlock Text="Settings" FontSize="28" FontWeight="Bold" Foreground="White" Margin="0,0,0,8"/>
                        <TextBlock Text="Application settings" FontSize="14" 
                                   Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,24"/>
                        
                        <Border Background="{StaticResource CardBrush}" CornerRadius="16" Padding="24">
                            <StackPanel>
                                <Button Name="btnViewLogs" Content=" View Logs" Background="Transparent" 
                                        Foreground="{StaticResource AccentBrush}" BorderBrush="{StaticResource AccentBrush}"
                                        FontWeight="SemiBold" Padding="20,12" BorderThickness="2" 
                                        HorizontalAlignment="Left" Margin="0,8"/>
                                <Button Name="btnCheckUpdates" Content=" Check Updates" Background="Transparent" 
                                        Foreground="{StaticResource AccentBrush}" BorderBrush="{StaticResource AccentBrush}"
                                        FontWeight="SemiBold" Padding="20,12" BorderThickness="2" 
                                        HorizontalAlignment="Left" Margin="0,8"/>
                                
                                <Border Height="1" Background="{StaticResource BorderBrush}" Margin="0,20"/>
                                
                                <TextBlock Text="About" FontSize="16" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,12"/>
                                <TextBlock Text="Win-Debloat7 v1.1.0" FontSize="14" Foreground="White" Margin="0,4"/>
                                <TextBlock Text="Created by Tomy Tolledo" FontSize="13" 
                                           Foreground="{StaticResource TextSecondaryBrush}" Margin="0,4"/>
                                <TextBlock Text="PowerShell 7.5+ | Windows 11 25H2 Ready" FontSize="12" 
                                           Foreground="{StaticResource AccentBrush}" Margin="0,8"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>
            </ScrollViewer>

            <!-- STATUS BAR -->
            <Border Grid.Row="1" Background="{StaticResource SurfaceBrush}" Padding="20,12">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <Ellipse Width="8" Height="8" Fill="{StaticResource SuccessBrush}" Margin="0,0,10,0"/>
                        <TextBlock Name="txtStatus" Text="Ready" Foreground="{StaticResource TextSecondaryBrush}" FontSize="13"/>
                    </StackPanel>
                    
                    <Button Grid.Column="1" Name="btnShowLog" Content=" Show Log" Background="Transparent" 
                            Foreground="{StaticResource AccentBrush}" BorderBrush="{StaticResource AccentBrush}"
                            Padding="16,8" BorderThickness="2"/>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Window>


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\src\ui\Colors.psm1
================================================================================

<#
.SYNOPSIS
    Premium color scheme and branding for Win-Debloat7 TUI
    
.DESCRIPTION
    Defines the "Neon Cyber" color palette with premium aesthetics.
    
.NOTES
    Module: Win-Debloat7.UI.Colors
    Version: 2.0.0 (Premium Edition)
#>

#Requires -Version 7.5

# Premium Color Scheme - Neon Cyber Dark
$Script:WD7Colors = @{
    # Primary Palette
    Primary    = "Cyan"           # #00D4FF - Main accent
    Secondary  = "Magenta"        # #7B2CBF - Secondary accent
    
    # Status Colors
    Success    = "Green"          # #00FF88 - Neon Green
    Warning    = "Yellow"         # #FFB800 - Amber
    Error      = "Red"            # #FF3366 - Coral Red
    
    # Text Colors
    Info       = "Gray"           # #A0A0B0 - Secondary text
    Dark       = "DarkGray"       # #606070 - Muted text
    White      = "White"          # #FFFFFF - Primary text
    
    # Background (Console limitation - display only)
    Background = "Black"          # #0D0D0D - True dark
}

# Premium ASCII Art Header
$Script:WD7Header = @"

                                                                               
                          
                    
                    
                 
            
                   
                                                                               
                     Ultimate System Optimizer v1.1.0                          
                  PowerShell 7.5+ | Windows 11 24H2 Ready                     

"@

$Script:WD7HeaderCompact = @"

             Win-Debloat7                         
              Ultimate System Optimizer                       

"@

function Write-WD7Host {
    [CmdletBinding()]
    param(
        [Parameter(Mandatory, Position = 0)]
        [string]$Message,
        
        [ValidateSet("Primary", "Secondary", "Success", "Warning", "Error", "Info", "Dark", "White")]
        [string]$Color = "Info",
        
        [switch]$NoNewline,
        
        [switch]$Bold
    )
    
    $consoleColor = $Script:WD7Colors[$Color]
    
    # Apply formatting
    if ($Bold -and $Color -eq "Primary") {
        $consoleColor = "Cyan"
    }
    
    if ($NoNewline) {
        Write-Host $Message -ForegroundColor $consoleColor -NoNewline
    }
    else {
        Write-Host $Message -ForegroundColor $consoleColor
    }
}

function Show-WD7Header {
    [CmdletBinding()]
    param(
        [switch]$Compact
    )
    
    Clear-Host
    
    if ($Compact) {
        Write-Host $Script:WD7HeaderCompact -ForegroundColor Cyan
    }
    else {
        # Full premium header with gradient effect
        $lines = $Script:WD7Header -split "`n"
        $colors = @("DarkCyan", "Cyan", "Cyan", "Cyan", "Cyan", "Cyan", "Cyan", "Cyan", "DarkCyan", "DarkCyan", "DarkCyan", "DarkCyan")
        
        for ($i = 0; $i -lt $lines.Count; $i++) {
            $c = if ($i -lt $colors.Count) { $colors[$i] } else { "DarkCyan" }
            Write-Host $lines[$i] -ForegroundColor $c
        }
    }
    
    Write-Host ""
}

function Show-WD7Separator {
    [CmdletBinding()]
    param(
        [string]$Title = "",
        [string]$Color = "Primary"
    )
    
    $consoleWidth = 60
    
    if ([string]::IsNullOrEmpty($Title)) {
        Write-WD7Host ("" * $consoleWidth) -Color $Color
    }
    else {
        $padding = [math]::Max(0, ($consoleWidth - $Title.Length - 4) / 2)
        $line = ("" * [int]$padding) + "[ $Title ]" + ("" * [int]$padding)
        Write-WD7Host $line -Color $Color
    }
}

function Show-WD7Progress {
    [CmdletBinding()]
    param(
        [int]$Percent,
        [int]$Width = 40,
        [string]$Label = ""
    )
    
    $filled = [math]::Round($Width * $Percent / 100)
    $empty = $Width - $filled
    
    $bar = "" * $filled + "" * $empty
    $display = "[$bar] $Percent%"
    
    if ($Label) {
        $display = "$Label $display"
    }
    
    Write-Host "`r$display" -NoNewline -ForegroundColor Cyan
}

function Show-WD7StatusBadge {
    [CmdletBinding()]
    param(
        [string]$Label,
        [ValidateSet("Success", "Warning", "Error", "Info")]
        [string]$Status
    )
    
    $icon = switch ($Status) {
        "Success" { "" }
        "Warning" { "" }
        "Error" { "" }
        "Info" { "" }
    }
    
    Write-WD7Host "  $icon " -Color $Status -NoNewline
    Write-WD7Host $Label -Color White
}

Export-ModuleMember -Function Write-WD7Host, Show-WD7Header, Show-WD7Separator, Show-WD7Progress, Show-WD7StatusBadge -Variable WD7Colors


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\src\ui\Menu.psm1
================================================================================

<#
.SYNOPSIS
    Interactive Menu System for Win-Debloat7
    
.DESCRIPTION
    Provides the TUI for authenticating users and selecting profiles.
    
.NOTES
    Module: Win-Debloat7.UI.Menu
    Version: 1.0.0
#>

#Requires -Version 7.5

using namespace System.Management.Automation

Import-Module "$PSScriptRoot\Colors.psm1" -Force
Import-Module "$PSScriptRoot\..\core\Config.psm1" -Force
Import-Module "$PSScriptRoot\..\core\State.psm1" -Force
Import-Module "$PSScriptRoot\..\modules\Bloatware\Bloatware.psm1" -Force
Import-Module "$PSScriptRoot\..\modules\Privacy\Privacy.psm1" -Force
Import-Module "$PSScriptRoot\..\modules\Performance\Performance.psm1" -Force
Import-Module "$PSScriptRoot\..\modules\Windows11\Version-Detection.psm1" -Force
Import-Module "$PSScriptRoot\..\modules\Software\Software.psm1" -Force
Import-Module "$PSScriptRoot\..\modules\Drivers\Drivers.psm1" -Force
Import-Module "$PSScriptRoot\..\modules\Network\Network.psm1" -Force
Import-Module "$PSScriptRoot\..\modules\Privacy\Tasks.psm1" -Force
Import-Module "$PSScriptRoot\..\modules\Privacy\Hosts.psm1" -Force

function Show-MainMenu {
    while ($true) {
        Show-WD7Header
        
        Write-WD7Host "Choose an option:" -Color Info
        Write-WD7Host "  [1] Quick Debloat (Recommended)" -Color White
        Write-WD7Host "  [2] Launch Premium GUI" -Color Primary
        Write-WD7Host "  [3] Select Profile..." -Color White
        Write-WD7Host "  [4] Install Essential Apps" -Color White
        Write-WD7Host "  [5] Update Drivers" -Color White
        Write-WD7Host "  [6] Network & Privacy Settings" -Color White
        Write-WD7Host "  [7] System Info" -Color White
        Write-WD7Host "  [8] Snapshots / Restore" -Color White
        Write-WD7Host "  [9] Defender Remover (External)" -Color White
        Write-WD7Host "  [0] Windows Activation (MAS)" -Color White
        Write-WD7Host "  [Q] Quit" -Color Dark
        
        $choice = Read-Host "`nEnter selection"
        
        switch ($choice) {
            "1" { Invoke-Profile "$PSScriptRoot\..\..\profiles\moderate.yaml" }
            "2" { 
                try {
                    Import-Module "$PSScriptRoot\gui\GUI.psm1" -Force
                    Show-WinDebloat7GUI
                }
                catch {
                    Write-WD7Host "Failed to launch GUI: $($_.Exception.Message)" -Color Error
                    Start-Sleep -Seconds 2
                }
            }
            "3" { Show-ProfileSelection }
            "4" { Install-WinDebloat7Essentials }
            "5" { Update-WinDebloat7Drivers }
            "6" { Show-NetworkPrivacyMenu }
            "7" { Show-SystemInfo }
            "8" { Show-SnapshotMenu }
            "9" { Invoke-DefenderRemover }
            "0" { Invoke-WindowsActivation }
            "Q" { exit }
            "q" { exit }
            default { Write-WD7Host "Invalid selection." -Color Warning; Start-Sleep -Seconds 1 }
        }
    }
}


function Show-ProfileSelection {
    Show-WD7Header
    Write-WD7Host "Select a Profile to Apply:" -Color Secondary
    
    $profiles = Get-ChildItem "$PSScriptRoot\..\..\profiles\*.yaml"
    $i = 1
    $profileMap = @{}
    
    foreach ($p in $profiles) {
        Write-WD7Host "  [$i] $($p.BaseName)" -Color White
        $profileMap[$i] = $p.FullName
        $i++
    }
    
    Write-WD7Host "  [B] Back" -Color Dark
    $sel = Read-Host "`nSelect Profile number"
    
    if ($sel -match "^[Bb]$") { return }
    
    if ($profileMap.ContainsKey([int]$sel)) {
        Invoke-Profile $profileMap[[int]$sel]
    }
    else {
        Write-WD7Host "Invalid Profile." -Color Error; Start-Sleep -Seconds 1
    }
}

function Invoke-Profile {
    param($Path)
    
    try {
        Show-WD7Header
        Write-WD7Host "Loading Profile: $Path" -Color Info
        $config = Import-WinDebloat7Config -Path $Path
        
        Write-WD7Host "`nApplying Configuration..." -Color Primary
        
        # 1. Auto-Snapshot before changes
        Write-WD7Host "Creating safety snapshot..." -Color Info
        New-WinDebloat7Snapshot -Name "Pre-$($config.metadata.name)" -Description "Before applying profile" | Out-Null
        
        # 2. Modules
        Remove-WinDebloat7Bloatware -Config $config
        Set-WinDebloat7Privacy -Config $config
        Set-WinDebloat7Performance -Config $config
        
        Write-WD7Host "`n[] Optimization Complete!" -Color Success
        Read-Host "Press Enter to return to menu..."
        
    }
    catch {
        Write-WD7Host "Error: $($_.Exception.Message)" -Color Error
        Read-Host "Press Enter to continue..."
    }
}

function Show-SystemInfo {
    Show-WD7Header
    $ver = Get-WindowsVersionInfo
    
    Write-WD7Host "System Information" -Color Secondary
    Write-Host "  OS:       " -NoNewline; Write-WD7Host $ver.ProductName -Color White
    Write-Host "  Version:  " -NoNewline; Write-WD7Host "$($ver.DisplayVersion) ($($ver.FriendlyName))" -Color White
    Write-Host "  Build:    " -NoNewline; Write-WD7Host $ver.BuildNumber -Color White
    Write-Host "  Is Win11: " -NoNewline; Write-WD7Host $ver.IsWindows11 -Color White
    
    Read-Host "`nPress Enter to return..."
}

function Show-SnapshotMenu {
    Show-WD7Header
    Write-WD7Host "Snapshot Management" -Color Secondary
    
    $snaps = Get-WinDebloat7Snapshot
    if ($snaps.Count -eq 0) {
        Write-WD7Host "No snapshots found." -Color Info
    }
    else {
        $snaps | Format-Table Timestamp, Name, Id -AutoSize | Out-String | Write-Host
    }
    
    Write-WD7Host "`n [C] Create Snapshot  [R] Restore Snapshot  [B] Back" -Color Info
    $c = Read-Host "Select"
    
    switch ($c) {
        "C" { New-WinDebloat7Snapshot -Name "Manual-User" -Description "Created via Menu"; Start-Sleep -Seconds 1 }
        "c" { New-WinDebloat7Snapshot -Name "Manual-User" -Description "Created via Menu"; Start-Sleep -Seconds 1 }
        "R" { 
            $id = Read-Host "Enter Snapshot ID to restore"
            if ($id) { Restore-WinDebloat7Snapshot -SnapshotId $id }
            Read-Host "Press Enter..."
        }
    }
}

function Show-NetworkPrivacyMenu {
    Show-WD7Header
    Write-WD7Host "Network & Privacy Settings" -Color Secondary
    
    # Show current status
    $netStatus = Get-WinDebloat7NetworkStatus | Select-Object -First 1
    $hostsStatus = Get-WinDebloat7HostsStatus
    $tasks = Get-WinDebloat7TelemetryTasks -Mode All
    $enabledTasks = ($tasks | Where-Object { $_.Enabled }).Count
    
    Write-Host "`nCurrent Status:" -ForegroundColor Cyan
    Write-Host "  DNS Provider: $($netStatus.DNSProvider)" -ForegroundColor Gray
    Write-Host "  IPv6 Enabled: $($netStatus.IPv6Enabled)" -ForegroundColor Gray
    Write-Host "  Hosts Blocking: $(if ($hostsStatus.TelemetryBlocked) { 'Active' } else { 'Inactive' })" -ForegroundColor Gray
    Write-Host "  Telemetry Tasks: $enabledTasks enabled" -ForegroundColor Gray
    
    Write-Host "`nOptions:" -ForegroundColor Cyan
    Write-WD7Host "  [1] Change DNS Server" -Color White
    Write-WD7Host "  [2] Disable IPv6" -Color White
    Write-WD7Host "  [3] Block Telemetry Domains (Hosts)" -Color White
    Write-WD7Host "  [4] Disable Telemetry Tasks (Safe)" -Color White
    Write-WD7Host "  [5] Disable Telemetry Tasks (Aggressive)" -Color White
    Write-WD7Host "  [6] View Blocked Domains" -Color White
    Write-WD7Host "  [B] Back" -Color Dark
    
    $sel = Read-Host "`nSelect option"
    
    switch ($sel) {
        "1" {
            Write-Host "`nDNS Providers:" -ForegroundColor Cyan
            Write-Host "  [1] Cloudflare (Privacy)" -ForegroundColor White
            Write-Host "  [2] Google" -ForegroundColor White
            Write-Host "  [3] Quad9 (Security)" -ForegroundColor White
            Write-Host "  [4] AdGuard (Ad-Blocking)" -ForegroundColor White
            Write-Host "  [5] OpenDNS" -ForegroundColor White
            Write-Host "  [6] Reset to DHCP" -ForegroundColor White
            $dns = Read-Host "Select"
            switch ($dns) {
                "1" { Set-WinDebloat7DNS -Provider Cloudflare }
                "2" { Set-WinDebloat7DNS -Provider Google }
                "3" { Set-WinDebloat7DNS -Provider Quad9 }
                "4" { Set-WinDebloat7DNS -Provider AdGuard }
                "5" { Set-WinDebloat7DNS -Provider OpenDNS }
                "6" { Set-WinDebloat7DNS -Provider Reset }
            }
            Read-Host "Press Enter..."
        }
        "2" { 
            Disable-WinDebloat7IPv6
            Read-Host "Press Enter..."
        }
        "3" { 
            Add-WinDebloat7HostsBlock
            Read-Host "Press Enter..."
        }
        "4" { 
            Disable-WinDebloat7TelemetryTasks -Mode Safe
            Read-Host "Press Enter..."
        }
        "5" { 
            Disable-WinDebloat7TelemetryTasks -Mode Aggressive
            Read-Host "Press Enter..."
        }
        "6" {
            $domains = Get-WinDebloat7TelemetryDomains
            Write-Host "`nTelemetry Domains to Block ($($domains.Count)):" -ForegroundColor Cyan
            $domains | ForEach-Object { Write-Host "  $_" -ForegroundColor Gray }
            Read-Host "`nPress Enter..."
        }
    }
}

function Invoke-DefenderRemover {
    Write-WD7Host "`n[Defender Remover]" -Color Secondary
    Write-Host "This will download and run the latest Defender Remover by ionuttbara." -ForegroundColor Gray
    Write-Host "Repo: https://github.com/ionuttbara/windows-defender-remover" -ForegroundColor Gray
    
    $confirm = Read-Host "`nDownload and run? [Y/N]"
    if ($confirm -notmatch '^[Yy]') { return }
    
    # Check valid connection
    if (-not (Test-Connection "api.github.com" -Count 1 -Quiet)) {
        Write-WD7Host "Error: Internet connection is required." -Color Error
        Write-Host "Please check your network settings." -ForegroundColor Gray
        Read-Host "Press Enter..."
        return
    }
    
    try {
        Write-Host "Fetching latest release..." -ForegroundColor Cyan
        $apiUrl = "https://api.github.com/repos/ionuttbara/windows-defender-remover/releases/latest"
        $release = Invoke-RestMethod -Uri $apiUrl -ErrorAction Stop
        
        # Find the .exe asset
        $asset = $release.assets | Where-Object { $_.name -like "*.exe" } | Select-Object -First 1
        if (-not $asset) {
            # Fallback to .bat or script if exe not found, or generic failure
            throw "Executable asset not found in latest release."
        }
        
        $dlUrl = $asset.browser_download_url
        $destPath = "$env:TEMP\$($asset.name)"
        
        Write-Host "Downloading $($asset.name)..." -ForegroundColor Cyan
        Invoke-WebRequest -Uri $dlUrl -OutFile $destPath -ErrorAction Stop
        
        Write-Host "Running Defender Remover..." -ForegroundColor Green
        Start-Process -FilePath $destPath -Wait
        
        Write-Host "Defender Remover execution finished." -ForegroundColor Green
    }
    catch {
        Write-WD7Host "Error launching Defender Remover: $($_.Exception.Message)" -Color Error
        Write-Host "Opening GitHub page instead..." -ForegroundColor Gray
        Start-Process "https://github.com/ionuttbara/windows-defender-remover/releases/latest"
    }
    Read-Host "Press Enter..."
}

function Invoke-WindowsActivation {
    Write-WD7Host "`n[Windows Activation]" -Color Secondary
    Write-Host "This will run the Microsoft Activation Scripts (MAS) via:" -ForegroundColor Gray
    Write-Host "irm https://get.activated.win | iex" -ForegroundColor DarkGray
    
    $confirm = Read-Host "`nRun Activation Script? [Y/N]"
    if ($confirm -notmatch '^[Yy]') { return }
    
    # Check valid connection
    if (-not (Test-Connection "get.activated.win" -Count 1 -Quiet)) {
        Write-WD7Host "Error: Internet connection is required." -Color Error
        Write-Host "Please check your network settings." -ForegroundColor Gray
        Read-Host "Press Enter..."
        return
    }
    
    try {
        Write-Host "Launching MAS..." -ForegroundColor Green
        Invoke-RestMethod https://get.activated.win | Invoke-Expression
    }
    catch {
        Write-WD7Host "Error: $($_.Exception.Message)" -Color Error
    }
    Read-Host "Press Enter..."
}

Export-ModuleMember -Function Show-MainMenu


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\CHANGELOG.md
================================================================================

# Changelog

All notable changes to this project will be documented in this file.

## [1.1.0] - 2026-01-23

###  New Features
- **Premium GUI**: A completely new WPF-based Graphical User Interface (`Press 2` in menu).
    - Dashboard with dynamic **System Health Score**.
    - Real-time status indicators for Telemetry, Copilot, and Recall.
    - Interactive Software installation tab.
- **Cliff Extras (CLI)**:
    - **[9] Defender Remover**: Integrated downloader for the external Defender Remover tool.
    - **[0] Windows Activation**: integrated launcher for Microsoft Activation Scripts (MAS).
- **Microsoft Office 365**: Added to the Software/Productivity list (Official Online Installer).

###  Improvements
- **PowerShell 7.5 Optimization**:
    - Replaced slow array `+=` operations with `System.Collections.Generic.List[T]` for significant performance gains.
    - Implemented `ConvertTo-CliXml` for robust system snapshots.
- **UI Responsiveness**: Added `Update-GUI` dispatcher helper to prevent "freezing" during long operations.
- **Copilot Detection**: Now checks both HKCU and HKLM registry keys for accurate status reporting.

###  Bug Fixes
- Fixed "Ambiguous Overload" error in GUI loading logic.
- Fixed Sidebar alignment issues in XAML.
- Fixed Version Detection to properly handle Windows 11 updates (e.g., "24H2").
- Fixed duplicate entries in the software catalog.

###  Dependencies
- **Mandatory Requirement**: PowerShell 7.5+ is now required.


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\CONTRIBUTING.md
================================================================================

# Contributing to Win-Debloat7

Thank you for your interest in improving **Win-Debloat7**! This project has moved to a modular, configuration-driven architecture with a WPF GUI.

##  Development Setup
1.  **Requirement**: PowerShell 7.5 or newer is **mandatory**.
2.  **Dependencies**: The project uses `PSResourceGet` to manage dependencies.
3.  **Editor**: VS Code with the PowerShell extension is recommended.

##  Architecture
The code is organized into modules in `src/`:
- **`src/core/`**: Core logic (Logger, Config, State). **Do not modify** unless you are changing the framework itself.
- **`src/modules/`**: Feature modules (Bloatware, Privacy, etc.). **Add new features here.**
- **`src/ui/gui/`**: WPF GUI logic (`GUI.psm1`) and markup (`MainWindow.xaml`).
- **`profiles/`**: YAML configuration files.

##  How to Add a Feature
1.  **Create a Module**: Create a new folder `src/modules/MyFeature/` and a `.psm1` file.
2.  **Implement Logic**: Write a function `Set-WinDebloat7MyFeature` that accepts a `$Config` object.
    ```powershell
    function Set-WinDebloat7MyFeature {
        param([Object]$Config)
        Write-Log -Message "Doing something..." -Level Info
    }
    ```
3.  **Update Schema**: Add relevant configuration keys to `profiles/schema.yaml` (if applicable).
4.  **Register**: Import your module in `Win-Debloat7.psd1`.

##  GUI Development
If modifying the GUI:
1.  **XAML**: Edit `src/ui/gui/MainWindow.xaml`. Keep styles consistent with `src/ui/Colors.psm1`.
2.  **Logic**: Edit `src/ui/gui/GUI.psm1`.
3.  **Responsiveness**: Always use the `$updateGui` helper in button handlers to prevent freezing.

##  Code Style
- **Typed Parameters**: Always use `[string]`, `[int]`, `[switch]`, etc.
- **Structured Logging**: Use `Write-Log` instead of `Write-Host`.
- **Classes**: Use PowerShell Classes for complex data structures.
- **Performance**: Use `[System.Collections.Generic.List[T]]` instead of array `+=`.

##  Pull Request Checklist
- [ ] Code runs on PowerShell 7.5.
- [ ] Logic respects the YAML configuration (no hardcoded actions).
- [ ] `Write-Log` is used for all output.
- [ ] GUI changes have been verified to not freeze the UI.


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\LICENSE
================================================================================

MIT License

Copyright (c) 2026 Tomy Tolledo

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\README.md
================================================================================

# Win-Debloat7 

<div align="center">

### **The Power User's Windows Optimization Framework**

*Take back control of your Windows experience*

![PowerShell 7.5](https://img.shields.io/badge/PowerShell-7.5+-5391FE?style=for-the-badge&logo=powershell&logoColor=white)
![Windows 11](https://img.shields.io/badge/Windows_11-25H2_Ready-0078D4?style=for-the-badge&logo=windows11&logoColor=white)
![License](https://img.shields.io/badge/License-MIT-brightgreen?style=for-the-badge)
![Stars](https://img.shields.io/github/stars/tomytate/Win-Debloat7?style=for-the-badge)

---

**Author:** [Tomy Tolledo](https://github.com/tomytate)  **Formerly:** Win-Debloat-Tools

[ Quick Start](#-quick-start)  [ Features](#-features)  [ Installation](#-installation)  [ Profiles](#-profiles)  [ Documentation](#-documentation)

</div>

---

##  Why Win-Debloat7?

> **Win-Debloat7** is a complete rewrite designed from the ground up for **Windows 11 25H2** and **PowerShell 7.5**. 
> Unlike traditional scripts, it's a modular framework with YAML-based profiles, encrypted snapshots, and a beautiful Steel Blue TUI.

### Before vs After

| Feature | Traditional Scripts | Win-Debloat7 |
|---------|---------------------|--------------|
| Configuration | Hardcoded |  YAML Profiles |
| Undo/Restore | None |  Encrypted Snapshots |
| Interface | Basic text |  Steel Blue TUI |
| Windows 11 25H2 | Partial |  Copilot, Recall, Widgets |
| Modern PowerShell | 5.1 |  7.5+ with classes |
| Error Handling | Basic |  Structured logging |

---

##  Features

<table>
<tr>
<td width="50%">

###  Bloatware Removal
- Remove 40+ pre-installed apps
- Target Microsoft & 3rd party bloat
- **25H2 Ready:** Copilot, Dev Home, Widgets
- Custom exclude lists

</td>
<td width="50%">

###  Privacy Hardening
- Telemetry (Security/Basic/Full)
- Disable Advertising ID
- Activity History controls
- **Windows Recall** disable
- **Copilot** disable

</td>
</tr>
<tr>
<td width="50%">

###  Performance Tuning
- Power Plans (Balanced/High/Ultimate)
- Visual Effects optimization
- Game Bar/DVR controls
- Background Apps management
- Network throttling removal

</td>
<td width="50%">

###  State Management
- System snapshots before changes
- Registry state backup
- Service state backup
- **DPAPI encrypted** snapshots
- One-click restore

</td>
</tr>
</table>

---

##  Quick Start

```powershell
# 1. Open PowerShell 7.5+ as Administrator
# 2. Clone and run
git clone https://github.com/tomytate/Win-Debloat7.git
cd Win-Debloat7
./Win-Debloat7.ps1
```

That's it! The interactive menu will guide you through the rest.

---

##  Installation

### Prerequisites
- **Windows 10/11** (Windows 11 25H2 recommended)
- **PowerShell 7.5+** ([Download](https://github.com/PowerShell/PowerShell/releases) or `winget install Microsoft.PowerShell`)
- **Administrator privileges**

### Option 1: Clone (Recommended)
```powershell
git clone https://github.com/tomytate/Win-Debloat7.git
cd Win-Debloat7
./Win-Debloat7.ps1
```

### Option 2: Download ZIP
1. Download the [latest release](https://github.com/tomytate/Win-Debloat7/releases)
2. Extract to a folder
3. Right-click `Win-Debloat7.ps1`  Run with PowerShell 7

---

##  Usage Modes

### Interactive Mode (TUI)
```powershell
./Win-Debloat7.ps1
```

Beautiful menu-driven interface:
```

         Win-Debloat7 - Power User        

   v1.1 | PowerShell 7.5 | 25H2 Ready

Choose an option:
  [1] Quick Debloat (Recommended)
  [2] Select Profile...
  [3] System Info
  [4] Snapshots / Restore
  [Q] Quit
```

### CLI / Unattended Mode
```powershell
# Apply a specific profile directly
./Win-Debloat7.ps1 -ProfileFile profiles/gaming.yaml

# For automation/deployment
./Win-Debloat7.ps1 -ProfileFile profiles/moderate.yaml -Unattended
```

---

##  Profiles

Pre-built profiles in the `profiles/` directory:

| Profile | Use Case | Bloatware | Telemetry | Power Plan |
|---------|----------|-----------|-----------|------------|
| **moderate.yaml** | Daily driver (recommended) | Moderate | Basic | Balanced |
| **gaming.yaml** | Maximum performance | Aggressive | Security | Ultimate |

### Custom Profiles

Create your own in `profiles/myprofile.yaml`:

```yaml
metadata:
  name: "MyProfile"
  version: "1.0.0"
  description: "My custom optimization profile"

bloatware:
  removal_mode: "Moderate"          # Conservative | Moderate | Aggressive
  exclude_list:
    - "Microsoft.WindowsStore"
    - "Microsoft.XboxApp"           # Keep Xbox if you game

privacy:
  telemetry_level: "Basic"          # Security | Basic | Full
  disable_copilot: true
  disable_recall: true
  disable_advertising_id: true
  disable_activity_history: true
  disable_location_tracking: false

performance:
  power_plan: "HighPerformance"     # Balanced | HighPerformance | Ultimate
  visual_effects: "Appearance"      # Appearance | Performance
  disable_game_bar: false
  disable_background_apps: true
```

See [`profiles/schema.yaml`](profiles/schema.yaml) for all available options.

---

##  Project Structure

```
Win-Debloat7/
  Win-Debloat7.ps1     # Entry point
  Win-Debloat7.psd1    # Module manifest
  src/
     core/            # Framework modules
       Logger.psm1     #   Structured logging with rotation
       Config.psm1     #   YAML parsing & validation
       State.psm1      #   Snapshot/restore management
       Registry.psm1   #   Safe registry operations
     modules/         # Feature modules
       Bloatware/      #   UWP app removal (40+ apps)
       Privacy/        #   Telemetry, Copilot, Recall
       Performance/    #   Power plans, visual effects
       Windows11/      #   Version detection, 25H2 support
     ui/              # Terminal UI
        Colors.psm1     #   Steel Blue theme
        Menu.psm1       #   Interactive menus
  profiles/            # YAML configurations
    moderate.yaml       #   Recommended default
    gaming.yaml         #   Maximum performance
    schema.yaml         #   Configuration schema
  build/               # Build scripts
     Build.ps1           #   Release packaging
     Sign-Scripts.ps1    #   Code signing
```

---

##  Snapshot & Restore

Win-Debloat7 automatically captures system state so you can always roll back.

### Creating a Snapshot
```powershell
# Via menu: [4] Snapshots  [C] Create
# Or programmatically:
New-WinDebloat7Snapshot -Name "Pre-Optimization"
```

### Restoring from Snapshot
```powershell
# Via menu: [4] Snapshots  [R] Restore
# Or programmatically:
Restore-WinDebloat7Snapshot -SnapshotId "<GUID>"
```

### Encrypted Snapshots
```powershell
# For sensitive environments - uses Windows DPAPI
New-WinDebloat7Snapshot -Name "Secure" -Encrypt
```

---

##  Documentation

### PowerShell 7.5 Features Used

This project leverages modern PowerShell 7.5 capabilities:

- `ConvertTo-CliXml` / `ConvertFrom-CliXml` for snapshot serialization
- `using namespace` declarations
- Null-coalescing operators (`??`)
- Ternary operators (`? :`)
- PowerShell classes for type safety
- `Install-PSResource` (PSResourceGet)
- Structured error handling

### Available Functions

```powershell
# Core
Start-WD7Logging              # Initialize logging
Write-Log                     # Structured logging
Import-WinDebloat7Config      # Load YAML profile

# Snapshots
New-WinDebloat7Snapshot       # Create snapshot
Restore-WinDebloat7Snapshot   # Restore snapshot
Get-WinDebloat7Snapshot       # List snapshots

# Modules
Remove-WinDebloat7Bloatware   # Remove bloatware
Set-WinDebloat7Privacy        # Apply privacy settings
Set-WinDebloat7Performance    # Apply performance settings
Get-WindowsVersionInfo        # Windows version detection
```

---

##  Security

- **No `Invoke-Expression`** - Zero code injection risk
- **No hardcoded credentials** - Clean codebase
- **YAML schema validation** - All input validated
- **DPAPI encryption** - Optional snapshot protection
- **ACL validation** - Registry permissions checked
- **No BinaryFormatter** - Modern serialization only

See [SECURITY.md](SECURITY.md) for vulnerability reporting.

---

##  Contributing

Contributions welcome! See [CONTRIBUTING.md](CONTRIBUTING.md) for guidelines.

```powershell
# Development setup
git clone https://github.com/tomytate/Win-Debloat7.git
cd Win-Debloat7

# Run tests (PowerShell 7.5 required)
Invoke-ScriptAnalyzer -Path . -Recurse -Settings PSGallery
```

---

##  Disclaimer

> **Use at your own risk.**
> 
> This tool modifies system configurations including registry keys and removes Windows applications. 
> While snapshots are provided for recovery, always create a **System Restore Point** before use.
> 
> The author is not responsible for any system issues resulting from the use of this tool.

---

##  License

MIT License - see [LICENSE](LICENSE) for details.

---

<div align="center">

**Made with  by [Tomy Tolledo](https://github.com/tomytate)**

 Star this project if you find it useful!

</div>


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\SECURITY.md
================================================================================

# Security Policy

## Supported Versions

| Version | Supported          |
| ------- | ------------------ |
| 1.1.x   | :white_check_mark: |
| 1.0.x   | :x:                |

## Reporting a Vulnerability

We take the security of **Win-Debloat7** seriously. If you discover a security vulnerability, please follow these steps:

1.  **Do not open a public issue.**
2.  Email details to the maintainers (or open a Draft Security Advisory if on GitHub).
3.  Provide steps to reproduce the issue.

## Safe Mode
Consider using the "Safe" profiles or `Safe` modes in functions (e.g., `Disable-WinDebloat7TelemetryTasks -Mode Safe`) if you are concerned about system stability or security implications of aggressive debloating.


================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\Win-Debloat7.ps1
================================================================================

#!/usr/bin/env pwsh
<#
.SYNOPSIS
    Win-Debloat7 - The Power User's Windows Optimization Platform
    
.DESCRIPTION
    Entry point for the Win-Debloat7 framework.
    Loads core modules and launches the interactive TUI or applies profiles in CLI mode.
    
.PARAMETER ProfileFile
    Path to a YAML profile to apply. When specified, skips the interactive menu.
    
.PARAMETER Unattended
    Suppresses confirmation prompts. Use with -ProfileFile for automation.
    
.PARAMETER Verbose
    Enables verbose output for debugging.
    
.EXAMPLE
    ./Win-Debloat7.ps1
    Launches the interactive menu.
    
.EXAMPLE
    ./Win-Debloat7.ps1 -ProfileFile profiles/gaming.yaml
    Applies the gaming profile with confirmation prompts.
    
.EXAMPLE
    ./Win-Debloat7.ps1 -ProfileFile profiles/moderate.yaml -Unattended
    Applies the moderate profile without prompts (for automation).
    
.NOTES
    Version: 1.1.0
    Author: Tomy Tolledo
    License: MIT
    Requires: PowerShell 7.5+, Administrator privileges
    
.LINK
    https://github.com/tomytate/Win-Debloat7
#>

#Requires -Version 7.5
#Requires -RunAsAdministrator

[CmdletBinding(SupportsShouldProcess)]
param(
    [ValidateScript({ Test-Path $_ -PathType Leaf })]
    [string]$ProfileFile,
    
    [switch]$Unattended,
    
    [switch]$NoGui
)

$scriptPath = Split-Path $MyInvocation.MyCommand.Path -Parent

# Load Core Framework
try {
    Write-Host "Initializing Win-Debloat7 Premium Framework..." -ForegroundColor Cyan
    
    # Load the manifest which defines all nested modules and exports
    $manifestPath = Join-Path $scriptPath "Win-Debloat7.psd1"
    
    if (-not (Test-Path $manifestPath)) {
        throw "Module manifest not found at $manifestPath"
    }
    
    Import-Module $manifestPath -Force -ErrorAction Stop
    
    Start-WD7Logging
    Write-Log -Message "Win-Debloat7 initialized successfully." -Level Success
}
catch {
    Write-Host "CRITICAL ERROR: Failed to load framework." -ForegroundColor Red
    Write-Host $_.Exception.Message -ForegroundColor Red
    exit 1
}

# The manifest already loads UI modules, but we keep this block for safety if needed
# or we can remove it since Menu.psm1 is loaded by the manifest
Write-Host "Framework loaded." -ForegroundColor Gray

# Launch Application
if ($ProfileFile) {
    # CLI Mode
    # Modules are already loaded by the manifest
    Write-Log -Message "CLI Mode: Processing profile $ProfileFile" -Level Info
    
    $config = Import-WinDebloat7Config -Path $ProfileFile
    
    # Safety confirmation (unless -Unattended)
    if (-not $Unattended) {
        Write-Host ""
        Write-Host "" -ForegroundColor Yellow
        Write-Host "  WARNING: This will modify your system configuration.    " -ForegroundColor Yellow
        Write-Host "  Profile: $($config.metadata.name.PadRight(43))" -ForegroundColor Yellow
        Write-Host "" -ForegroundColor Yellow
        Write-Host ""
        
        $confirm = Read-Host "Continue? [Y/N]"
        if ($confirm -notmatch '^[Yy]') {
            Write-Log -Message "Operation cancelled by user." -Level Warning
            exit 0
        }
        
        # Create snapshot before changes
        Write-Log -Message "Creating pre-optimization snapshot..." -Level Info
        New-WinDebloat7Snapshot -Name "Pre-$($config.metadata.name)" -Description "Auto-created before $($config.metadata.name) profile"
    }
    else {
        Write-Log -Message "Unattended mode - skipping confirmation" -Level Info
    }
    
    # Apply modules
    Remove-WinDebloat7Bloatware -Config $config -Confirm:$false
    Set-WinDebloat7Privacy -Config $config -Confirm:$false
    Set-WinDebloat7Performance -Config $config -Confirm:$false
    
    Write-Log -Message "Profile '$($config.metadata.name)' applied successfully." -Level Success
    exit 0
}
else {
    # Interactive Mode (TUI Menu by default)
    # User can press 2 to launch Premium GUI
    Show-MainMenu
}



================================================================================
FILE: W:\Documents\Win-Debloat-Tools-main\Win-Debloat7.psd1
================================================================================

@{
    # Script module or binary module file associated with this manifest.
    # Script module or binary module file associated with this manifest.
    # RootModule        = ''

    # Version number of this module.
    ModuleVersion     = '1.1.0'

    # ID used to uniquely identify this module
    GUID              = 'a1b2c3d4-e5f6-7890-1234-567890abcdef'

    # Author of this module
    Author            = 'Tomy Tolledo'

    # Company or vendor of this module
    CompanyName       = 'Open Source'

    # Copyright statement for this module
    Copyright         = '(c) 2026 Tomy Tolledo. All rights reserved.'

    # Description of the functionality provided by this module
    Description       = 'Power User Windows Optimization Framework (PowerShell 7.5+)'

    # Minimum version of the Windows PowerShell engine required by this module
    PowerShellVersion = '7.5'

    # Modules that must be imported into the global environment prior to importing this module
    RequiredModules   = @()

    # Modules to import as nested modules of the module specified in RootModule/ModuleToProcess
    NestedModules     = @(
        'src\core\Logger.psm1',
        'src\core\Config.psm1',
        'src\core\State.psm1',
        'src\core\SystemState.psm1',
        'src\core\Registry.psm1',
        'src\modules\Bloatware\Bloatware.psm1',
        'src\modules\Privacy\Privacy.psm1',
        'src\modules\Performance\Performance.psm1',
        'src\modules\Performance\Gaming.psm1',
        'src\modules\Windows11\Version-Detection.psm1',
        'src\modules\Software\Software.psm1',
        'src\modules\Drivers\Drivers.psm1',
        'src\modules\Network\Network.psm1',
        'src\modules\Privacy\Tasks.psm1',
        'src\modules\Privacy\Hosts.psm1',
        'src\ui\Colors.psm1',
        'src\ui\Menu.psm1',
        'src\ui\gui\GUI.psm1'
    )

    # Functions to export from this module (CQ-002 fix: Explicit exports instead of wildcards)
    FunctionsToExport = @(
        # Core
        'Start-WD7Logging', 'Write-Log', 'Get-WD7LogPath',
        'Import-WinDebloat7Config', 'Test-WinDebloat7Config',
        'New-WinDebloat7Snapshot', 'Restore-WinDebloat7Snapshot', 'Get-WinDebloat7Snapshot',
        'Set-RegistryKey', 'Get-RegistryKey', 'Test-RegistryKey', 'Export-RegistryKey',
        # Modules
        'Get-WinDebloat7BloatwareList', 'Remove-WinDebloat7Bloatware',
        'Set-WinDebloat7Privacy',
        'Set-WinDebloat7Performance',
        'Set-WinDebloat7Gaming',
        'Get-WindowsVersionInfo', 'Test-Windows11Version', 'Clear-WindowsVersionCache',
        # Software
        'Test-PackageManager', 'Install-PackageManager', 'Get-WinDebloat7EssentialsList',
        'Install-WinDebloat7Software', 'Install-WinDebloat7Essentials', 'Install-WinDebloat7ProfileSoftware',
        # Drivers
        'Get-WinDebloat7DriverStatus', 'Get-WinDebloat7GPUInfo', 'Update-WinDebloat7Drivers',
        # Network
        'Set-WinDebloat7DNS', 'Get-WinDebloat7DNSProviders', 'Disable-WinDebloat7IPv6', 'Enable-WinDebloat7IPv6',
        'Get-WinDebloat7NetworkStatus', 'Set-WinDebloat7Network',
        # Privacy Tasks
        'Get-WinDebloat7TelemetryTasks', 'Disable-WinDebloat7TelemetryTasks', 'Enable-WinDebloat7TelemetryTasks',
        # Hosts Blocking
        'Backup-HostsFile', 'Add-WinDebloat7HostsBlock', 'Remove-WinDebloat7HostsBlock',
        'Get-WinDebloat7HostsStatus', 'Get-WinDebloat7TelemetryDomains',
        # UI
        'Show-MainMenu', 'Show-WinDebloat7GUI'
    )

    # Cmdlets to export from this module
    CmdletsToExport   = @()

    # Variables to export from this module
    VariablesToExport = @()

    # Aliases to export from this module
    AliasesToExport   = @()

    # Private data to pass to the module specified in RootModule/ModuleToProcess
    PrivateData       = @{
        PSData = @{
            # Tags applied to this module. These help with module discovery in online galleries.
            Tags         = @('Optimization', 'Debloat', 'Windows11', 'PowerShell7.5', 'Privacy', 'Performance')
            
            # Project URI
            ProjectUri   = 'https://github.com/tomytate/Win-Debloat7'
            
            # License URI
            LicenseUri   = 'https://github.com/tomytate/Win-Debloat7/blob/main/LICENSE'
            
            # Release Notes
            ReleaseNotes = @'
## v1.1.0 (2026-01-23)
- NEW: Premium WPF GUI (Press 2) with System Health Dashboard
- NEW: Defender Remover & Windows Activation (CLI Extras)
- NEW: Microsoft Office 365 (Online Installer) support
- IMPROVED: PowerShell 7.5 optimizations (List[T], CliXml)
- FIXED: Copilot detection & UI freezing issues
'@
        }
    }
}


